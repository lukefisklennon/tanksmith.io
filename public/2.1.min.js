io=null;var go=function(t){try{var e,i,o=!0,a=!1,n=document.getElementById("canvas"),l=n.getContext("2d"),s="localhost"==window.location.hostname,r=0,c=0,h=0,d=0,m=!1,y=0,g=0,v=0,w=0;if(mobile){var x=5;Wt=window.devicePixelRatio||1;var S=!1,T=0,k=0,P=T,M=k,U={x:T,y:k},$=0,I=0,A=0,F=0,W=0,z=60*gameScale,B=0,L=!1,C=0,D=0,R=0,H=0,E=0,N=0,O=0,_=0,Y=20*gameScale,j=1.5,X=0}for(var q=100,V=3,G=!1,J=null,K=!1,Q=0,Z=[87,38,65,37,83,40,68,39,1,2],tt={},et=!1,it=!1,ot=0,at=0,nt=0,lt=0,st=ot,rt=at,ct={},ht={},ut={},pt={},ft=[],dt=1,mt=2,yt=4,gt=4,bt=1,vt=null,wt=0,xt=0,St=0,Tt=y/2,kt=g/2,Pt=1,Mt=1,Ut=Mt,$t=50,It=1040,At=590,Ft=It/At,Wt=1,zt=15,Bt=.1,Lt=4,Ct="Unknown",Dt=!1,Rt=0,Ht=0,Et=0,Nt=0,Ot=!1,_t=null,Yt=4e3,jt=8e3,Xt=.13,qt=Xt*bt,Vt=-.3,Gt=20,Jt=.5,Kt=70,Qt=Kt,Zt=0,te=0,ee=!1,ie=15,oe=6,ae=["Wood","Iron","Gold","Diamond","Amethyst","Onyx"],ne=[],le=22,se=le,re=4,ce=[],he=[],ue=[],pe=[],fe=0;fe<oe;fe++)ce[fe]=0,he[fe]=0,ue[fe]=0,pe[fe]=0;var de=0,me=0,ye=0,ge=0;try{1==performance.navigation.type&&(playCount=1)}catch(t){}var be={ready:1,key:2,play:3,mouse:4,build:5,upgrade:6,delete:7,move:8},ve={update:1,joined:2,info:3,stash:4,scale:5,leaderboard:6,die:7,kick:8,shake:9,kill:10,resize:11},we={core:0,basicUnit:1,basicTurret:2,sniperTurret:3,twinTurret:4,cannonTurret:5,healingUnit:6,alchemyLab:7,octaTurret:9,spike:9},xe={circle:0,triangle:1},Se={name:"",tutorialStage:0,socialTotal:0,socialButtons:[]},Te={wasd:0,click:1,shapes:2,saveUp:3,firstUnit:4,gotUnit:5},ke=2e3,Pe=!1,Me=["#790000","#888888","#efc000","#1bebff","#9400c0","#333333","#ff0000"],Ue="#bfbfbf",$e="#fa0028",Ie="#73eeff",Ae=Ue,Fe=40,We=2,ze="#595959",Be="#05d400",Le="#ffffff",Ce="#111111",De=0,Re=6,He=3,Ee=[],Ne=[{name:"Core",cost:0,size:1.2,mouse:!0,buildable:!0,shape:xe.circle,description:"",top:function(t,e,i,o,a,n,l){Ne[we.basicTurret].top(t,e,i,o,a,n,l)},bottom:function(t,e,i,o,a,n,l){Ne[we.basicUnit].bottom(t,e,i,o,a,n,l)}},{name:"Basic Unit",cost:0,size:1,mouse:!1,buildable:!0,shape:xe.circle,description:"A simple unit which can protect your core",top:function(t,e,i,o,a,n,l){},bottom:function(t,e,i,o,a,n,l){t.fillStyle=Me[l],t.strokeStyle=Xo(Me[l],Vt),t.beginPath(),t.arc(e,i,o-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()}},{name:"Basic Turret",cost:0,size:1,mouse:!0,buildable:!0,shape:xe.circle,description:"A regular turret with a single gun",top:function(t,e,i,o,a,n,l){var s=.6*o;t.beginPath(),t.fillStyle=Ue,t.strokeStyle=Xo(Ue,Vt),t.save(),t.translate(e,i),t.rotate(a),t.fillRect(-s/2,0,s,2*s),t.strokeRect(-s/2,0,s,2*s),t.restore(),t.arc(e,i,o/2-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},bottom:function(t,e,i,o,a,n,l){Ne[we.basicUnit].bottom(t,e,i,o,a,n,l)}},{name:"Sniper Turret",cost:0,size:1,mouse:!0,buildable:!0,shape:xe.circle,description:"A long-range gunner which shoots fast projectiles",top:function(t,e,i,o,a,n,l){var s=.4*o,r=3.5*s;t.beginPath(),t.fillStyle=Ue,t.strokeStyle=Xo(Ue,Vt),t.save(),t.translate(e,i),t.rotate(a),t.fillRect(-s/2,0,s,r),t.strokeRect(-s/2,0,s,r),t.restore(),t.arc(e,i,o/2-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},bottom:function(t,e,i,o,a,n,l){Ne[we.basicUnit].bottom(t,e,i,o,a,n,l)}},{name:"Twin Turret",cost:0,size:1,mouse:!0,buildable:!0,shape:xe.circle,description:"A turret with two guns, which fire small bullets",top:function(t,e,i,o,a,n,l){var s=o/2-t.lineWidth,r=.6*o*2;t.beginPath(),t.fillStyle=Ue,t.strokeStyle=Xo(Ue,Vt),t.save(),t.translate(e,i),t.rotate(a),t.fillRect(-s,0,s,r),t.strokeRect(-s,0,s,r),t.fillRect(0,0,s,r),t.strokeRect(0,0,s,r),t.restore(),t.arc(e,i,o/2-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},bottom:function(t,e,i,o,a,n,l){Ne[we.basicUnit].bottom(t,e,i,o,a,n,l)}},{name:"Cannon Turret",cost:0,size:1,mouse:!0,buildable:!0,shape:xe.circle,description:"A slow, but powerful gun capable of dealing hefty damage",top:function(t,e,i,o,a,n,l){var s=.6*o*1.4,r=.6*o*2;t.beginPath(),t.fillStyle=Ue,t.strokeStyle=Xo(Ue,Vt),t.save(),t.translate(e,i),t.rotate(a),t.fillRect(-s/2,0,s,r),t.strokeRect(-s/2,0,s,r),t.restore(),t.arc(e,i,o/2-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},bottom:function(t,e,i,o,a,n,l){Ne[we.basicUnit].bottom(t,e,i,o,a,n,l)}},{name:"Healing Unit",cost:0,size:1,mouse:!1,buildable:!0,shape:xe.circle,description:"A support unit which heals connected units over time",top:function(t,e,i,o,a,n,l){},bottom:function(t,e,i,o,a,n,l){Ne[we.basicUnit].bottom(t,e,i,o,a,n,l);var s=o-.35*o,r=.7*s/2;t.fillStyle=$e,t.strokeStyle=Xo($e,Vt),t.beginPath(),t.save(),t.translate(e,i),t.rotate(n),t.moveTo(-r,-s),t.lineTo(r,-s),t.lineTo(r,-r),t.lineTo(s,-r),t.lineTo(s,r),t.lineTo(r,r),t.lineTo(r,s),t.lineTo(-r,s),t.lineTo(-r,r),t.lineTo(-s,r),t.lineTo(-s,-r),t.lineTo(-r,-r),t.lineTo(-r,-s),t.restore(),t.closePath(),t.fill(),t.stroke()}},{name:"Alchemy Lab",cost:0,size:1,mouse:!1,buildable:!0,shape:xe.circle,description:"An experimental unit which converts one resource to another",top:function(t,e,i,o,a,n,l){},bottom:function(t,e,i,o,a,n,l){Ne[we.basicUnit].bottom(t,e,i,o,a,n,l),t.fillStyle=Ie,t.strokeStyle=Xo(Ie,Vt),t.save(),t.translate(e,i),t.rotate(n);for(var s=0;s<3;s++){t.beginPath();var r=Oo(0,0,2*Math.PI/3*s,.45*o);t.arc(r.x,r.y,o/3-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()}t.restore()}},{name:"Booster Unit",cost:0,size:1,mouse:!1,buildable:!0,shape:xe.circle,description:"A unit which increases your overall speed",top:function(t,e,i,o,a,n,l){},bottom:function(t,e,i,o,a,n,l){Ne[we.basicUnit].bottom(t,e,i,o,a,n,l);var s=.8*o;t.fillStyle=Ae,t.strokeStyle=Xo(Ae,Vt),t.save(),t.translate(e,i),t.rotate(a+n),t.beginPath(),t.arc(0,0,s/3-t.lineWidth/2,0,2*Math.PI),t.moveTo(s-t.lineWidth/2,0);for(var r=2*Math.PI/10,c=0;c<10;c++){var h=0;c%2!=0&&(h=.2*o),t.arc(0,0,s-t.lineWidth/2-h,r*c,r*(c+1))}Oo(0,0,r,s-t.lineWidth/2-h);t.lineTo(s-t.lineWidth/2,0),t.fill(),t.stroke(),t.closePath(),t.fillStyle=Me[l],t.beginPath(),t.arc(0,0,s/3-t.lineWidth,0,2*Math.PI),t.fill(),t.closePath(),t.restore()}},{name:"Octa Turret",cost:0,size:1,mouse:!0,buildable:!0,shape:xe.circle,description:"A turret with eight guns, that fire slowly but in every direction",top:function(t,e,i,o,a,n,l){var s=.6*o;t.beginPath(),t.fillStyle=Ue,t.strokeStyle=Xo(Ue,Vt);for(var r=0;r<8;r++)t.save(),t.translate(e,i),t.rotate(a+2*Math.PI/8*r),t.fillRect(-s/4,0,s/2,2*s),t.strokeRect(-s/4,0,s/2,2*s),t.restore();t.arc(e,i,o/2-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},bottom:function(t,e,i,o,a,n,l){Ne[we.basicUnit].bottom(t,e,i,o,a,n,l)}},{name:"Spike",cost:0,size:.5,mouse:!1,buildable:!1,shape:xe.triangle,description:"A small appendage which deals significant collision damage",top:function(){},bottom:function(t,e,i,o,a,n,l){o/=2,t.fillStyle=Me[l],t.strokeStyle=Xo(Me[l],Vt),t.save(),t.translate(e,i),t.rotate(n),t.beginPath(),t.moveTo(0,-o*Pt+qt*Pt/2),t.lineTo(-o*Pt+qt*Pt/2,o*Pt-qt*Pt/2),t.lineTo(o*Pt-qt*Pt/2,o*Pt-qt*Pt/2),t.lineTo(0,-o*Pt+qt*Pt/2),t.closePath(),t.fill(),t.stroke(),t.restore()}}],Oe=qo("loading"),_e=qo("menu"),Ye=qo("middle-container"),je=(qo("overlay"),qo("main"),qo("title"),qo("play")),Xe=qo("name"),qe=qo("respawn-info"),Ve=qo("social"),Ge=qo("count"),Je=qo("version"),Ke=qo("links"),Qe=qo("party"),Ze=qo("apps"),ti=qo("help"),ei=qo("help-inner"),ii=qo("hud"),oi=qo("tip"),ai=qo("alerts"),ni=qo("store-toggle"),li=qo("toggle-arrow-wrapper"),si=qo("store"),ri=qo("store-scroll"),ci=qo("stash"),hi=qo("arrow-left"),ui=qo("arrow-right"),pi=qo("arrow-left-wrapper"),fi=qo("arrow-right-wrapper"),di=qo("stash-main"),mi=qo("stash-special"),yi=qo("score"),gi=qo("options"),bi=qo("options-heading"),vi=qo("options-close"),wi=qo("upgrade-button"),xi=qo("destroy-button"),Si=qo("leaderboard"),Ti=qo("scanner"),ki=Ti.getContext("2d"),Pi=qo("units"),Mi=qo("minimap");Mi.width=q,Mi.height=q;var Ui=Mi.getContext("2d"),$i=qo("tutorial-mobile"),Ii=qo("share-message"),Ai=qo("discord"),Fi=qo("share-progress-outer"),Wi=qo("share-progress-inner"),zi=qo("death"),Bi=function(){Wt=window.devicePixelRatio||1,n.style.width=window.innerWidth+"px",n.style.height=window.innerHeight+"px",n.width=window.innerWidth*Wt,n.height=window.innerHeight*Wt,l.scale(Wt,Wt),Qt=Kt*Wt,se=le*Wt,e=window.innerWidth,i=window.innerHeight,Li(),function(){calculateScale(),Ye.style.transform="translate(-50%, -50%) scale("+gameScale+")",Ze.style.transform="scale("+gameScale+")",Ze.style.margin=8*gameScale+"px",mobile?Ze.style.bottom=92*gameScale+10*gameScale+"px":Ze.style.bottom=92*gameScale+"px";Qe.style.transform="scale("+gameScale+")",Qe.style.margin=8*gameScale+"px",Qe.style.bottom=8*gameScale+"px",Ge.style.transform="scale("+gameScale+")",Ge.style.margin=8*gameScale+"px",Je.style.transform="scale("+gameScale+")",Je.style.margin=8*gameScale+"px",si.style.transform="translateX(-50%) scale("+gameScale+")",si.style.margin=8*gameScale+"px",ni.style.transform="translateX(-100%) scale("+gameScale+")",ni.style.margin=8*gameScale+"px",mobile?ni.style.left="calc(50% - "+292*gameScale+"px - "+8*gameScale+"px)":ni.style.left="calc(50% - "+460*gameScale+"px - "+8*gameScale+"px)";if(ci.style.transform="scale("+gameScale+")",ci.style.margin=8*gameScale+"px",di.style.margin="0px",mi.style.margin="0px",mi.style.marginBottom="8px",Pi.style.transform="scale("+gameScale+")",Pi.style.margin=8*gameScale+"px",Si.style.transform="scale("+gameScale+")",Si.style.margin=8*gameScale+"px",yi.style.transform="scale("+gameScale+")",yi.style.margin=8*gameScale+"px",ai.style.transform="translateX(-50%) scale("+gameScale+")",ai.style.bottom=156*gameScale+"px",gi.style.top=8*gameScale+"px",gi.style.transform="translateX(-50%) scale("+gameScale+")",Ke.style.transform="scale("+gameScale+")",Ke.style.margin=8*gameScale+"px",Ke.style.bottom=8*gameScale+"px",Ke.style.maxWidth="calc(50% - "+200*gameScale+"px)",Mi.style.transform="scale("+gameScale+")",Mi.style.margin=8*gameScale+"px",Mi.style.bottom=46*gameScale+"px","app"!=parse_query_string(window.location.search.substring(1)).source){if(mobile)qo("tanksmith-io_300x250").style.transform="scale("+gameScale+")",qo("tanksmith-io_300x250").style.left="auto",qo("tanksmith-io_300x250").style.right=8*gameScale+"px",qo("tanksmith-io_300x250").style.transformOrigin="100% 100%";else{var t=gameScale;window.innerHeight>800&&(gameScale=1),qo("tanksmith-io_300x250").style.transform="translateX(-50%) scale("+gameScale+")",gameScale=t}qo("tanksmith-io_300x250").style.bottom=8*gameScale+"px"}}(),l.lineCap="round",l.lineJoin="round",l.lineWidth=qt*Pt};ii.children;function Li(){Pt=e/i>=Ft?e/It:i/At,Pt*=Ut}window.onresize=Bi,Bi();Date.now();var Ci=50,Di=Ci,Ri=1/0,Hi=0,Ei=1,Ni=function(t,e){this.name=Vo(t),this.$score=e,this.score=e};Ni.prototype.update=function(){this.score=jo(this.score,this.$score,.1)};var Oi=function(t,e,i,o,a){this.id=t,this.$x=e,this.$ox=e,this.x=e,this.$y=i,this.$oy=i,this.y=i,this.size=o,this.material=a,this.dying=!1,this.alpha=1,this.scale=1};Oi.prototype.objUpdate=function(t){this.dying?(this.alpha-=.1,this.scale+=.2,this.x-=(this.$ox-this.$x)*t,this.y-=(this.$oy-this.$y)*t):(this.x=Yo(this.$ox,this.x,this.$x,t),this.y=Yo(this.$oy,this.y,this.$y,t))},Oi.prototype.renderHealthBar=function(){var t=0;this.hp<1&&(t=1),this.hpAlpha=jo(this.hpAlpha,t,.2),this.hpAlpha>.01&&function(t,e,i,o){o<1&&(l.globalAlpha=o);l.lineWidth=(qt+We)*Pt,l.beginPath(),l.strokeStyle=ze,l.moveTo(t-Fe*Pt/2,e),l.lineTo(t+Fe*Pt/2,e),l.stroke(),l.closePath(),l.beginPath(),l.lineWidth=qt*Pt,l.strokeStyle=Be,l.moveTo(t-Fe*Pt/2,e),i*=2,i-=1,i*=Fe*Pt/2,l.lineTo(t+i,e),l.stroke(),l.closePath(),o<1&&(l.globalAlpha=1)}(Wo(this.x),zo(this.y)+(this.size+12)*Pt,this.hp,this.alpha*this.hpAlpha)};var _i=function(t,e,i,o,a,n,l,s,r,c){Oi.call(this,t,e,i,o,a),this.type=n,this.owner=l,this.$angle=s,this.angle=s,this.$orotation=r,this.$rotation=r,this.rotation=r,this.$hp=c,this.hp=c,this.hpAlpha=0,this.mouse=Ne[this.type].mouse,this.buildable=Ne[this.type].buildable,this.deleteAmount=Math.floor(Uo(Ne[this.type].cost,this.material)/2)};_i.prototype=new Oi,_i.prototype.update=function(t){!m&&this.owner==J&&this.mouse||(Math.abs(this.$angle-this.angle)>Math.PI&&(this.$angle>this.angle?this.angle+=2*Math.PI:this.angle-=2*Math.PI),this.angle=jo(this.angle,this.$angle,t));if(this.rotation=Yo(this.$orotation,this.rotation,this.$rotation,t),this.hp=jo(this.hp,this.$hp,.1),this.alpha<=0){var e=ft.indexOf(ct[this.id]);e>-1&&ft.splice(e,1),delete ct[this.id]}},_i.prototype.renderBottom=function(){this.alpha<1&&(l.globalAlpha=this.alpha),Ne[this.type].bottom(l,Wo(this.x),zo(this.y),this.size*this.scale*Pt,this.angle,this.rotation,this.material),this.alpha<1&&(l.globalAlpha=1)},_i.prototype.renderTop=function(){this.alpha<1&&(l.globalAlpha=this.alpha),Ne[this.type].top(l,Wo(this.x),zo(this.y),this.size*this.scale*Pt,this.angle,this.rotation,this.material),this.alpha<1&&(l.globalAlpha=1),s&&(l.fillStyle="#f00",l.beginPath(),l.arc(Wo(this.$x),zo(this.$y),10*Pt,0,2*Math.PI),l.fill(),l.closePath())},_i.prototype.renderName=function(){var t=!0;if(this.owner==J){var e=Date.now()-De;e<4e3?e>2e3&&(l.globalAlpha=1-(e-2e3)/2e3):t=!1}else this.alpha<1&&(this.alpha>.01?l.globalAlpha=this.alpha:t=!1);if(t&&pt[this.owner]){l.fillStyle=Le,l.strokeStyle=Ce,l.lineWidth=2*Pt,l.textAlign="center",l.font="900 "+20*Pt+"px Ubuntu";var i=Wo(this.x),o=zo(this.y)-(this.size+15)*Pt;l.strokeText(pt[this.owner].name,i,o),l.fillText(pt[this.owner].name,i,o),l.font="900 "+10*Pt+"px Ubuntu",o+=10*Pt;var a=Ro(pt[this.owner].score);l.strokeText(a,i,o),l.fillText(a,i,o),l.lineWidth=qt*Pt,l.globalAlpha=1}};var Yi=function(t,e,i,o,a,n,l){Oi.call(this,t,e,i,o,a),this.$orotation=n,this.$rotation=n,this.rotation=n,this.$hp=l,this.hp=l,this.hpAlpha=0,this.active=!1};Yi.prototype=new Oi,Yi.prototype.update=function(t){this.alpha<=0?delete ht[this.id]:this.$x<-v/2||this.$x>v/2||this.$y<-w/2||this.$y>w/2?this.dying=!0:(this.rotation=Yo(this.$orotation,this.rotation,this.$rotation,t),this.active||this.$hp<1&&(this.$hp+=Hi*(zt/Ci)*Ei),this.hp=jo(this.hp,this.$hp,.1))},Yi.prototype.render=function(){this.alpha<1&&(l.globalAlpha=this.alpha),l.fillStyle=Me[this.material],l.strokeStyle=Xo(Me[this.material],Vt),l.save(),l.translate(Wo(this.x),zo(this.y)),l.rotate(this.rotation),l.beginPath(),l.moveTo(0,-this.size*this.scale*Pt+qt*Pt/2),l.lineTo(-this.size*this.scale*Pt+qt*Pt/2,this.size*this.scale*Pt-qt*Pt/2),l.lineTo(this.size*this.scale*Pt-qt*Pt/2,this.size*this.scale*Pt-qt*Pt/2),l.lineTo(0,-this.size*this.scale*Pt+qt*Pt/2),l.closePath(),l.fill(),l.stroke(),l.restore(),s&&(this.active?l.fillStyle="#f00":l.fillStyle="#00f",l.beginPath(),l.arc(Wo(this.$x),zo(this.$y),10*Pt,0,2*Math.PI),l.fill(),l.closePath()),this.alpha<1&&(l.globalAlpha=1)};var ji=function(t,e,i,o,a){Oi.call(this,t,e,i,o,a),this.firstFrame=!0};ji.prototype=new Oi,ji.prototype.update=function(){this.alpha<=0&&delete ut[this.id]},ji.prototype.render=function(){this.alpha<1&&(l.globalAlpha=this.alpha),l.fillStyle=Me[this.material],l.strokeStyle=Xo(Me[this.material],Vt),l.beginPath(),l.arc(Wo(this.x),zo(this.y),this.size*this.scale*Pt-l.lineWidth/2,0,2*Math.PI),l.closePath(),l.fill(),l.stroke(),s&&(l.fillStyle="#f00",l.beginPath(),l.arc(Wo(this.$x),zo(this.$y),10*Pt,0,2*Math.PI),l.fill(),l.closePath()),this.alpha<1&&(l.globalAlpha=1)};var Xi=null;function qi(){console.log("Disconnected!"),qe.style.display="none",n.style.opacity=0,yo(!1),Oe.style.visibility="visible",Oe.style.opacity="1",mo(),io=null,a=!1,o=!1,pt={},ct={},ut={},ht={},ft=[],zi.style.display="none",onDisconnect()}var Vi=function(t){if(G)if(Dt){if(Dt&&!Ot&&ft.length<=Ri&&Uo(Ne[Rt].cost,Ht)<=ce[Ht])if(ft.length<=Ri){et||(Dt=!1);var e=new ArrayBuffer(dt+mt+dt+dt+gt),i=new DataView(e,0);i.setUint8(0,be.build,!0),i.setUint16(dt,Et,!0),i.setUint8(dt+mt,Rt,!0),i.setUint8(dt+mt+dt,Ht,!0),i.setFloat32(dt+mt+dt+dt,Nt,!0),io.send(e)}else Do("You have built the maximum number of units",jt),Do("Delete existing units with the K key to build more",jt)}else _t=So(t.clientX,t.clientY),Ao()},Gi=!1;if(n.onmousedown=function(t){G&&!Dt&&po(1,1)},n.onmouseup=function(t){po(1,0)},mobile||(n.onclick=Vi),document.addEventListener("mousemove",function(t){ot=t.pageX,at=t.pageY,a&&G&&null!=vt&&!m&&$o(),Gi&&(oi.style.left=t.clientX,oi.style.top=t.clientY-10)},!0),mobile||(ri.onmouseleave=function(){oi.style.opacity="0",setTimeout(function(){"0"==oi.style.opacity&&(oi.style.display="none",Gi=!1)},200)}),window.oncontextmenu=function(t){},mobile){n.addEventListener("touchstart",function(t){for(var o=0;o<t.changedTouches.length;o++){var a=t.changedTouches[o],n=a.pageX,l=a.pageY;null==So(n,l)&&(n<e/2?(S=!0,U={x:P=T=n,y:M=k=l}):(L=!0,C=n,D=l,R=0,H=0,E=0,N=0,O=0,_=0,ot=e/2,at=i/2,Dt||po(1,1)))}return t.preventDefault(),!1},!1),n.addEventListener("touchmove",function(t){for(var i=0;i<t.changedTouches.length;i++){var o=t.changedTouches[i],a=o.pageX,n=o.pageY;a<e/2?S?($=No(T,k,P=a,M=n),I=_o(T,k,P,M),U=I>z?Oo(T,k,$,z):{x:P,y:M},(W=I/z)>1&&(W=1),Se.tutorialStage==Te.click&&(setTimeout(function(){Do("Touch the right side of the screen, and move to adjust your target",jt)},ke),Se.tutorialStage++,Go())):(L=!1,po(1,0)):L?(O=R,_=H,R=(a-C)*j,H=(n-D)*j):(S=!1,W=0)}return t.preventDefault(),!1},!1);var Ji=function(t){for(var i=0;i<t.changedTouches.length;i++){var o=t.changedTouches[i],a=o.pageX,n=o.pageY;a<e/2?(S=!1,$=0,W=0):(L=!1,po(1,0))}return Vi({clientX:a,clientY:n}),t.preventDefault(),!1};n.addEventListener("touchend",Ji,!1),n.addEventListener("touchcancel",Ji,!1),ri.style.overflowX="scroll",ri.onscroll=function(t){ee||(Zt=ri.scrollLeft,te=Zt),ee=!1},Xe.onclick=function(t){return Xe.value=prompt("Enter name"),t.preventDefault,!1};try{for(var Ki in document.styleSheets){var Qi=document.styleSheets[Ki];if(Qi.rules)for(var Zi=Qi.rules.length-1;Zi>=0;Zi--)Qi.rules[Zi].selectorText&&Qi.rules[Zi].selectorText.match(":hover")&&Qi.deleteRule(Zi)}}catch(t){}re*=Wt,Ke.style.display="none",Qe.style.fontSize="25px",Je.style.fontSize="25px",Ge.style.fontSize="25px",si.style.width="584px",ri.style.width="504px",app?Ze.style.display="none":(qo("app-android").style.height="54px",Ze.style.height="54px"),ti.style.position="fixed",ti.style.left="50%",ti.style.top="-200%",ti.style.transform="translate(-50%,-50%)",ti.style.zIndex="999",ti.style.width="374px",ti.style.height="294px",ti.style.fontSize="25px",ei.style.height="232px",qo("help-heading").style.fontSize="35px",qo("help-inner").innerHTML='Touch the left side of the screen, and move <span class="minor">to control your tank</span><br>Touch the right side of the screen, and move <span class="minor">to aim</span><br>Protect your core <span class="minor">to stay alive</span><br>Destroy shapes <span class="minor">to collect resources</span><br>Select a unit from the store <span class="minor">and tap to place it</span><br>Collect better resources <span class="minor">to build better units</span><br>Tap a unit in your tank <span class="minor">to upgrade or destroy it</span><br>Assemble your tank <span class="minor">to become powerful</span><br>Battle other players <span class="minor">and climb the leaderboard</span><div id="close-tutorial" style="width:100%;text-align:right"><a href="#">Close tutorial</a></div>',qo("social-column").remove(),$i.style.display="block",$i.onclick=function(){ei.scrollTop=0,ti.style.top="50%"},qo("close-tutorial").onclick=function(){ti.style.top="-200%"}}var to=168;function eo(t){var e=to;t<0&&(e*=-1),(Zt+=e)<0&&(Zt=0);var i=ri.scrollWidth-ri.clientWidth;Zt>i&&(Zt=i)}ri.onwheel=function(t){eo(t.deltaY)};var oo=!1,ao=!1,no=250,lo=function(){oo=!0,eo(-1),setTimeout(ho.bind(null,-1),no)},so=function(){ao=!0,eo(1),setTimeout(ho.bind(null,1),no)},ro=function(){oo=!1},co=function(){ao=!1};function ho(t){-1==t?oo&&uo(t):1==t&&ao&&uo(t)}function uo(t){eo(t),setTimeout(ho.bind(null,t),no)}function po(t,e,i){var o=0;if(null!=tt[t]&&(o=tt[t]),tt[t]=e,17==t)et=e;else if(27==t)Dt=!1;else if(69==t&&0==e)(it=!it)?po(1,1):po(1,0,1);else if((1!=t||0!=e||!it)&&a&&Z.indexOf(t)>-1&&(i||e!=o)){Se.tutorialStage==Te.click&&1!=t&&2!=t?(setTimeout(function(){Do("Left-mouse click to fire",jt)},ke),Se.tutorialStage++,Go()):Se.tutorialStage!=Te.shapes||1!=t&&2!=t||(setTimeout(function(){Do("Destroy shapes to gather resources",jt)},ke),Se.tutorialStage++,Go());var n=new ArrayBuffer(dt+dt+dt),l=new DataView(n,0);l.setUint8(0,be.key,!0),l.setUint8(1,t,!0),l.setUint8(2,e,!0),io.send(n)}}function fo(){io&&("app"==parse_query_string(window.location.search.substring(1)).source||s||(playCount-1)%3!=0?continueToPlay():(console.log("Calling video ad"),aiptag.cmd.player.push(function(){adplayer.startPreRoll()})),playCount++)}function mo(){G=!1,vt=null,!1,Q=0,oi.style.display="none",oi.style.opacity="0"}function yo(t){_e.style.opacity="0",Ye.style["transition-timing-function"]="ease-in",Ye.style.top="-50%",ii.style.opacity=t?"1":"0",setTimeout(function(){G&&"0"==_e.style.opacity&&(_e.style.display="none")},1500)}function go(){_e.style.display="block";_e.clientHeight;_e.style.opacity="1",Ye.style["transition-timing-function"]="ease-out",Ye.style.top="50%",ii.style.opacity="0"}mobile?(pi.ontouchstart=lo,fi.ontouchstart=so,pi.ontouchend=ro,fi.ontouchend=co,pi.ontouchcancel=ro,fi.ontouchcancel=co):(pi.onmousedown=lo,fi.onmousedown=so,pi.onmouseup=ro,fi.onmouseup=co),document.onkeydown=function(t){G&&po(t.keyCode,1)},document.onkeyup=function(t){G&&po(t.keyCode,0)},continueToPlay=function(){Se.name=Xe.value,Go();var t=btoa(unescape(encodeURIComponent(Xe.value))).substring(0,22).split(""),e=new ArrayBuffer(dt+dt+dt+t.length),i=new DataView(e,0);i.setUint8(0,be.play,!0),i.setUint8(1,t.length,!0),i.setUint8(2,Se.socialButtons.length,!0);for(var o=dt+dt+dt,a=0;a<t.length;a++)i.setUint8(o+a,t[a].charCodeAt(0),!0);io.send(e),pt[J].name=Vo(Xe.value),K=!0},l.lineCap="round",l.lineJoin="round",l.lineWidth=qt*Pt;var bo=Date.now(),vo=1,wo=(Date.now(),function(){var t,a=Date.now()-bo;for(u in zt=(zt+a)/2,(vo=a/Di)>1&&(vo=1),bo=Date.now(),ct)ct[u].objUpdate(vo),ct[u].update(vo);null!=vt&&(t=Bt*(a/zt),xt=jo(xt,vt.$ox-vt.$x,t),St=jo(St,vt.$oy-vt.$y,t),Tt=vt.x+xt*Lt,kt=vt.y+St*Lt,Ut=jo(Ut,Mt,t),Li(),function(){te=jo(te,Zt,.1),Math.abs(ri.scrollLeft-te)>1&&(ri.scrollLeft=te,ee=!0);ri.scrollLeft<=1?hi.style.opacity=.3:hi.style.opacity=1;ri.scrollLeft>=ri.scrollWidth-ri.clientWidth-1?ui.style.opacity=.3:ui.style.opacity=1}()),y=jo(y,v,.1),g=jo(g,w,.1),function(){l.fillStyle="#f2f2f2",l.fillRect(0,0,e,i),l.strokeStyle="#dddddd",l.lineWidth=Jt*Pt;for(var t=Wo(Math.ceil((Tt-e/2/Pt)/Gt)*Gt),o=-1;o<e/(Gt*Pt)+2;o++)l.beginPath(),l.moveTo(t+o*Gt*Pt,0),l.lineTo(t+o*Gt*Pt,i),l.stroke(),l.closePath();for(var a=zo(Math.ceil((kt-i/2/Pt)/Gt)*Gt),o=-1;o<i/(Gt*Pt)+2;o++)l.beginPath(),l.moveTo(0,a+o*Gt*Pt),l.lineTo(e,a+o*Gt*Pt),l.stroke(),l.closePath();l.lineWidth=qt*Pt,l.fillStyle="#000000",l.globalAlpha=.2,l.fillRect(Wo(-y/2)-e,0,e,i),l.fillRect(Wo(y/2),0,e,i),l.fillRect(Wo(-y/2),zo(-g/2)-i,y*Pt,i),l.fillRect(Wo(-y/2),zo(g/2),y*Pt,i),l.globalAlpha=1}(),ye=jo(ye,de,.1);for(var c=0;c<oe;c++)ue[c]=jo(ue[c],ce[c],.1);for(p in Po(),m||$o(),pt)pt[p].update();for(f in ht)ht[f].objUpdate(vo),ht[f].update(vo),null!=ht[f]&&Mo(ht[f])&&ht[f].render();for(u in ct)ct[u].renderBottom();for(b in ut)ut[b].objUpdate(vo),ut[b].update(),null==ut[b]||ut[b].firstFrame||ut[b].render();for(p in Dt?function(){for(var t=ot,e=at,i=0,o=-1,a=0,n=0;n<ft.length;n++)if(ft[n].buildable){var s=_o(ot,at,Wo(ft[n].x),zo(ft[n].y));(o<0||s<o)&&(o=s,a=n)}Et=ft[a].id,i=No(ot,at,Wo(ft[a].x),zo(ft[a].y))+Math.PI,Nt=i;var r=Ne[ft[a].type].size*Pt*bt;Ne[Rt].shape==xe.circle?r+=Ne[Rt].size*Pt*bt:Ne[Rt].shape==xe.triangle&&(r+=Ne[Rt].size/2*Pt*bt);var c=Oo(Wo(ft[a].x),zo(ft[a].y),i,r);t=c.x,e=c.y,Ot=!1;for(var h=Ht,n=0;n<ft.length;n++)if(n!=a&&_o(t,e,Wo(ft[n].x),zo(ft[n].y))<(Ne[Rt].size*bt+ft[n].size)*Pt){Ot=!0,h=oe;break}l.globalAlpha=.8,Ne[Rt].bottom(l,t,e,Ne[Rt].size*Pt*bt,i-Math.PI/2,i-Math.PI/2+Math.PI,h),Ne[Rt].top(l,t,e,Ne[Rt].size*Pt*bt,i-Math.PI/2,i-Math.PI/2+Math.PI,h),l.globalAlpha=1}():So(ot,at)?n.style.cursor="pointer":n.style.cursor="crosshair",ct)ct[p].renderTop();for(u in ct)ct[u].type==we.core&&ct[u].renderName();for(f in ht)ht[f].renderHealthBar();for(p in ct)ct[p].renderHealthBar();if(null!=vt&&(l.save(),l.translate(Wo(vt.x),zo(vt.y)),l.rotate(wt),l.beginPath(),l.setLineDash([10*Pt,10*Pt]),l.strokeStyle="#000000",l.globalAlpha=.2,l.lineWidth=3*Pt,l.arc(0,0,(vt.size+25)*Pt,0,2*Math.PI),l.stroke(),l.closePath(),l.restore(),l.lineWidth=qt*Pt,l.setLineDash([]),l.globalAlpha=1,wt+=.01,Ui.clearRect(0,0,q,q),Ui.fillStyle="#FFFFFF",Ui.beginPath(),Ui.arc(vt.x/y*(q-2*V)+q/2+V/4,vt.y/g*(q-2*V)+q/2+V/4,V,0,2*Math.PI),Ui.closePath(),Ui.fill()),mobile&&(S?(B+=.1)>1&&(B=1):(B-=.1)<0&&(B=0),L?(X+=.1)>1&&(X=1):(X-=.1)<0&&(X=0),B>0&&(l.globalAlpha=.25*B,l.fillStyle="#000",l.beginPath(),l.arc(T,k,z,0,2*Math.PI),l.fill(),l.closePath(),l.beginPath(),l.arc(U.x,U.y,z/2,0,2*Math.PI),l.fill(),l.closePath(),l.globalAlpha=1),X>0)){E=Yo(O,E,R,1/j),N=Yo(_,N,H,1/j),ot=e/2+E,at=i/2+N,l.lineCap="butt",l.globalAlpha=.5*X,l.strokeStyle="#000";var x=e/2+E,P=i/2+N;l.beginPath(),l.moveTo(x,P-Y),l.lineTo(x,P+Y),l.moveTo(x-Y,P),l.lineTo(x+Y,P),l.stroke(),l.closePath(),l.globalAlpha=1,l.lineCap="round"}if(s){l.fillStyle=Le,l.strokeStyle=Ce,l.lineWidth=2,l.textAlign="left",l.font="900 20px Ubuntu";x=5,P=20;var M="Data total: "+Ho(r);l.strokeText(M,x,P),l.fillText(M,x,P),P+=20;var $="Data per second: "+Ho(h);l.strokeText($,x,P),l.fillText($,x,P),P+=20;var I="Local FPS: "+d;l.strokeText(I,x,P),l.fillText(I,x,P),P+=20;var A="Server FPS: "+Math.round(1e3/Di);l.strokeText(A,x,P),l.fillText(A,x,P),l.lineWidth=qt*Pt}o?xo(wo):null!=io&&io.close()}),xo=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame;function So(t,e){for(var i=null,o=0;o<ft.length;o++)if(_o(t,e,Wo(ft[o].x),zo(ft[o].y))<ft[o].size*Pt){i=ft[o];break}return i}!function(){!function(){var t=se+re;Ti.width=t,Ti.height=t,ki.lineWidth=re,ki.lineCap="round",ki.lineJoin="round";for(var e=0;e<oe;e++){ki.clearRect(0,0,t,t),ki.fillStyle=Me[e],ki.strokeStyle=Xo(Me[e],Vt),ki.beginPath(),ki.moveTo(se/2+re/2,re),ki.lineTo(se,se),ki.lineTo(re,se),ki.lineTo(se/2+re/2,re),ki.closePath(),ki.fill(),ki.stroke();var i=Ti.toDataURL("image/png",1);ne[e]=i}}();for(var t="",e="",i=0;i<oe;i++){var o='<div id="so'+i+'" class="stash-item"><img src="'+ne[i]+'" width="'+le+'px" style="position:relative;top:1.5px;"> <span id="si'+i+'">0</span>';mobile||(o+=' <span class="minor">'+ae[i]+"</span>"),o+="</div>",i==oe-1?e+=o:t+=o}di.innerHTML=t,mi.innerHTML=e,yi.innerHTML='<div id="score-outer" class="stash-item"><span class="minor">Score</span> <span id="score-inner">0</span></div>'}(),wo(),je.onclick=fo,mouseInterval=setInterval(function(){G&&null!=vt&&(function(){if(nt=Math.round((ot-Wo(vt.x))/Pt),lt=Math.round((at-zo(vt.y))/Pt),null!=vt&&st!=nt&&rt!=lt){var t=new ArrayBuffer(dt+yt+yt),e=new DataView(t,0);e.setUint8(0,be.mouse,!0),e.setInt32(dt,nt,!0),e.setInt32(dt+yt,lt,!0),io.send(t),st=nt,rt=lt}}(),mobile&&function(){if(A!=$||F!=W){var t=new ArrayBuffer(dt+gt+gt),e=new DataView(t,0);e.setUint8(0,be.move,!0),e.setFloat32(dt,$,!0),e.setFloat32(dt+gt,W,!0),io.send(t),A=$,F=W}}())},30),s&&(debugInterval=setInterval(function(){h=c,c=0,d=Math.round(1e3/zt)},1e3)),ni.onclick=function(){var t=1;mobile&&(t=gameScale),-1==si.style.transform.indexOf("150%")?(si.style.transform="translateX(-50%) translateY(150%) scale("+t+")",li.style.top="12.5%",li.style.transform="scaleY(-1)"):(si.style.transform="translateX(-50%) translateY(0%) scale("+t+")",li.style.top="37.5%",li.style.transform="scaleY(1)")};var To=function(t){var e=this.id.split(":")[1].split(";");return Rt=Number(e[0]),Ht=Number(e[1]),Uo(Ne[Rt].cost,Ht)<=ce[Ht]?(Dt=!0,mobile&&(S=!1,L=!1)):Do("Gather "+(Uo(Ne[Rt].cost,Ht)-ce[Ht])+" more "+ae[Ht]+" first",jt),!1};function ko(t){var e=this.id.split(":")[1].split(";"),i=Number(e[0]),o=Number(e[1]);Gi=!0;var a=Ne[i].name+'<br><span class="minor">'+Ne[i].description+"<br>",n=Uo(Ne[i].cost,o)-ce[o];a+=n>0?"Gather</span> "+n+" "+ae[o]:"You have enough</span> "+ae[o],oi.innerHTML=a,oi.style.display="block";oi.clientHeight;oi.style.opacity="1"}function Po(){for(var t=!1,e=0;e<oe;e++){var i=qo("so"+e);Ro(ue[e])!=Ro(pe[e])&&(qo("si"+e).innerText=Ro(ue[e])),Ro(ce[e])!=Ro(he[e])&&(i.style.animationName="pulse",setTimeout(function(t){t.style.animationName=""}.bind(null,i),1e3),t=!0),he[e]=ce[e],pe[e]=ue[e],0==ce[e]?mi.style.opacity=0:mi.style.opacity=1}t&&Ao();i=qo("score-outer");Ro(ye)!=Ro(ge)&&(qo("score-inner").innerText=Ro(ye)),Ro(de)!=Ro(me)&&(i.style.animationName="pulse",setTimeout(function(t){t.style.animationName=""}.bind(null,i),1e3)),me=de,ge=ye}function Mo(t){var o=Wo(t.x),a=zo(t.y),n=t.size*Pt;return o>0-n-$t&&o<e+n+$t&&a>0-n-$t&&a<i+n+$t}function Uo(t,e){return t*(e+1)}function $o(){for(var t=0;t<ft.length;t++)ft[t].mouse&&(ft[t].angle=No(Wo(ft[t].x),zo(ft[t].y),ot,at)-Math.PI/2)}var Io=null;function Ao(){if(null!=_t){if(bi.innerHTML=Ne[_t.type].name+' <span class="minor">('+ae[_t.material]+")</span>",_t.material<oe-1){var t=Bo(_t);wi.innerHTML='<img style="height:22px;position:relative;top:4px;" src="'+ne[_t.material+1]+'"> Upgrade <span class="minor">-'+t+" "+ae[_t.material+1]+"</span>",t>ce[_t.material+1]||_t.material==oe-2&&_t.type==we.alchemyLab?wi.disabled=!0:wi.disabled=!1}else wi.innerHTML="Fully upgraded",wi.disabled=!0;_t.type!=we.core?(xi.style.display="inline-block",wi.style.width="calc(50% - 4px)",xi.innerHTML='<img style="height:22px;position:relative;top:4px;" src="'+ne[_t.material]+'"> Destroy <span class="minor">+'+_t.deleteAmount+" "+ae[_t.material]+"</span>"):(xi.style.display="none",wi.style.width="100%"),wi.disabled?wi.style.bottom="1px":wi.style.bottom="0px",clearTimeout(Io),Io=null,gi.style.display="block";gi.clientHeight;gi.style.opacity="1",qo("")}else Fo()}function Fo(){_t=null,gi.style.opacity="0",Io=setTimeout(function(){gi.style.display="none"},500)}function Wo(t){return(t-Tt)*Pt+e/2}function zo(t){return(t-kt)*Pt+i/2}function Bo(t){return Math.floor(Uo(Ne[t.type].cost,t.material+1)-Uo(Ne[t.type].cost,t.material)/4)}function Lo(){Pi.innerHTML=ft.length-1+'<span class="minor">/'+Ri+" units</span>"}wi.onclick=function(){if(Bo(_t)<=ce[_t.material+1]){var t=new ArrayBuffer(dt+mt),e=new DataView(t,0);e.setUint8(0,be.upgrade,!0),e.setUint16(dt,_t.id,!0),io.send(t)}else _t.material<oe-1?Do("Gather "+(Bo(_t)-ce[_t.material+1])+" more "+ae[_t.material+1]+" first",jt):Do("This unit has been upgraded to the limit",jt);Fo()},xi.onclick=function(){if(_t.type!=we.core){var t=new ArrayBuffer(dt+mt),e=new DataView(t,0);e.setUint8(0,be.delete,!0),e.setUint16(dt,_t.id,!0),io.send(t)}Fo()},vi.onclick=function(){Fo()};var Co=0;function Do(t,e){ai.innerHTML+='<div class="alert" id="m'+Co+'" style="opacity:0;margin-bottom:-24px;width:100%;"></div>';var i="m"+Co,o=document.getElementById(i);o.clientHeight;o.innerText=t,o.style.opacity=1,o.style.marginBottom="0px",Co++,setTimeout(function(){document.getElementById(i).style.opacity=0,setTimeout(function(){document.getElementById(i).remove()}.bind(null,i),500)}.bind(null,i),e)}function Ro(t){return(t=Math.round(t))>=1e3&&(t=(t/=1e3).toFixed(1),t+="k"),t}function Ho(t){return t>=1e3&&t<1e6?(t/=1e3,t=Math.round(t),t+="KB"):t>=1e6&&t<1e9?(t/=1e6,t=Math.round(t),t+="MB"):t>=1e9&&(t/=1e9,t=Math.round(t),t+="GB"),t}function Eo(t){t=Math.round(t/1e3);var e,i=Math.floor(t/3600),o=Math.floor((t-3600*i)/60),a=t-3600*i-60*o,n=[];return i>0&&(e=" hour",1!=i&&(e+="s"),n.push(i+e)),o>0&&(e=" minute",1!=o&&(e+="s"),n.push(o+e)),e=" second",1!=a&&(e+="s"),n.push(a+e),1==n.length?n[0]:2==n.length?n[0]+" and "+n[1]:3==n.length?n[0]+", "+n[1]+" and "+n[2]:void 0}function No(t,e,i,o){return Math.atan2(o-e,i-t)}function Oo(t,e,i,o){return{x:Math.cos(i)*o+t,y:Math.sin(i)*o+e}}function _o(t,e,i,o){return Math.sqrt((t-i)*(t-i)+(e-o)*(e-o))}function Yo(t,e,i,o){var a=(Math.abs(i-t)>=Math.abs(i-e)?i-t:i-e)*o;return e==i||e<i&&e+a>i||e>i&&e+a<i?i:e+a}function jo(t,e,i){return t*(1-i)+e*i}function Xo(t,e){var i=parseInt(t.slice(1),16),o=e<0?0:255,a=e<0?-1*e:e,n=i>>16,l=i>>8&255,s=255&i;return"#"+(16777216+65536*(Math.round((o-n)*a)+n)+256*(Math.round((o-l)*a)+l)+(Math.round((o-s)*a)+s)).toString(16).slice(1)}function qo(t){return document.getElementById(t)}function Vo(t){return profanityFilter.clean(t)}function Go(){localStorage.data=JSON.stringify(Se)}localStorage.data?Se=JSON.parse(localStorage.data):Go(),Xe.value=Se.name,mobile||Xe.focus();var Jo=function(){var t=btoa(unescape(encodeURIComponent(Xe.value))).substr(0,22);try{Xe.value=decodeURIComponent(escape(atob(t)))}catch(t){console.log("Error: "+t),Xe.value=Xe.value.substr(0,22)}};if(Xe.oninput=Jo,Xe.onpaste=Jo,Xe.onkeydown=function(t){"Enter"==t.key&&fo()},Ve){function Ko(t,e,i){var o=Se.socialButtons.indexOf(t);e?-1==o&&Se.socialButtons.push(t):-1!=o&&Se.socialButtons.splice(o,1),Se.socialTotal=Se.socialButtons.length*He,Go(),0!=i&&Qo()}function Qo(){Se.socialTotal>0&&Se.socialTotal<Re*He?Ii.innerHTML="Increase your bonus by clicking other social media buttons":Se.socialTotal>=Re*He?Ii.innerHTML="Thanks for your support!":Se.socialTotal<=0&&(Ii.innerHTML="Start with extra resources by supporting us on social media"),Se.socialTotal>0&&(Fi.style.display="block",Wi.style.width=Se.socialTotal/(Re*He)*100+"%",Wi.innerText="+"+Se.socialTotal),Ii.onclick=null}function Zo(t){setTimeout(function(){Ii.innerHTML='<a href="#">Click to redeem</a>',Ii.onclick=function(){Ii.onclick=null,Ko(t,!0,!0)}.bind(null,t)},3e3)}function ta(){"undefined"!=typeof FB&&(FB.Event.subscribe("edge.create",function(){Ko("facebook-like",!0,!0)}),FB.Event.subscribe("edge.remove",function(){Ko("facebook-like",!1,!0)})),twttr.events.bind("tweet",function(){Zo("twitter-tweet")}),twttr.events.bind("follow",function(){Zo("twitter-follow")})}"undefined"==typeof FB||"undefined"==typeof twttr?window.addEventListener("load",function(){ta()}):ta(),Ai.onclick=function(){Ko("discord-join",!0,!0)};var ea=!1,ia=qo("___ytsubscribe_0");ia.onmouseenter=function(){ea=!0},ia.onmouseleave=function(){ea=!1};var oa=!1,aa=document.getElementsByClassName("fb-share-button")[0];aa.onmouseenter=function(){oa=!0},aa.onmouseleave=function(){oa=!1},Qo()}window.onbeforeunload=function(){if(null!=io&&(io.onclose=function(){},io.close()),Ve&&ea&&Ko("youtube-subscribe",!0,!1),K&&"app"!=parse_query_string(window.location.search.substring(1)).source)return"Are you sure that you want to exit? You will lose your current progress in the game"},window.onblur=function(){Ve&&oa&&Zo("facebook-share");for(var t=0;t<Z.length;t++)po(Z[t],0)},document.onmouseout=function(){po(1,0)},na=t,console.log("Setting up the network for "+na),window.WebSocket=window.WebSocket||window.MozWebSocket,console.log(na),io=new WebSocket(na),io.binaryType="arraybuffer",io.onopen=function(){console.log("Connected!"),a=!0;var t=new ArrayBuffer(dt);new DataView(t,0).setUint8(0,be.ready,!0),io.send(t)},io.onclose=qi,io.onerror=qi,io.onmessage=function(t){try{var e=t.data,i=new DataView(t.data),o=i.getUint8(0,!0),a=dt;switch(r+=e.byteLength,c+=e.byteLength,o){case ve.update:null!=Xi&&(Di=jo(Di,Date.now()-Xi,.1)),Xi=Date.now();var h=[],u=[],p=[],f=i.getUint16(a,!0);a+=mt;var d=i.getUint16(a,!0);a+=mt;var b=i.getUint16(a,!0);a+=mt;var S=i.getUint16(a,!0);a+=mt;for(var T=0;T<f;T++){var k=i.getUint16(a,!0);a+=mt;var P=i.getFloat32(a,!0);a+=gt;var M=i.getFloat32(a,!0);a+=gt;var U=i.getFloat32(a,!0);a+=gt;var $=i.getFloat32(a,!0);a+=gt;var I=i.getUint8(a,!0);a+=dt;var A=i.getUint8(a,!0);a+=dt;var F=i.getUint16(a,!0);a+=mt,(z=i.getFloat32(a,!0))<0&&(z=0),a+=gt;var W=i.getFloat32(a,!0);a+=gt,h.push(k),Object.keys(ct).indexOf(String(k))>-1?(ct[k].$ox=ct[k].$x,ct[k].$oy=ct[k].$y,ct[k].$x=P*bt,ct[k].$y=M*bt,!m&&ct[k].owner==J&&ct[k].mouse||(ct[k].$angle=$),ct[k].$orotation=ct[k].$rotation,ct[k].$rotation=W,ct[k].material!=A&&(ct[k].deleteAmount=Math.floor(Uo(Ne[ct[k].type].cost,A)/2)),ct[k].material=A,ct[k].$hp=z,ct[k].owner==J&&ct[k].type==we.core&&(vt=ct[k]),ct[k].dying=!1,ct[k].alpha=1,ct[k].scale=1):(ct[k]=new _i(k,P*bt,M*bt,U*bt,A,I,F,$,W,z),ct[k].owner==J&&(ft.push(ct[k]),Se.tutorialStage==Te.gotUnit&&ct[k].type!=we.core&&(Pe=!0,Do("Awesome! You can now gather more resources to build your tank",jt),setTimeout(function(){var t="click";mobile&&(t="tap"),Do("Also, you can "+t+" one of your units to upgrade or destroy it",jt),setTimeout(function(){Do("Protect your core: if it gets destroyed, your whole tank will get demolished",jt),setTimeout(function(){Do("Good luck!",jt)},ke)},jt+ke)},ke),Se.tutorialStage++,Go())),Lo())}for(T=0;T<d;T++){var z;k=i.getUint16(a,!0),a+=mt,u.push(k),P=i.getFloat32(a,!0),a+=gt,-1!=P?(M=i.getFloat32(a,!0),a+=gt,U=i.getFloat32(a,!0),a+=gt,W=i.getFloat32(a,!0),a+=gt,A=i.getUint8(a,!0),a+=dt,(z=i.getFloat32(a,!0))<0&&(z=0),a+=gt,Object.keys(ht).indexOf(String(k))>-1?(ht[k].$ox=ht[k].$x,ht[k].$oy=ht[k].$y,ht[k].$x=P*bt,ht[k].$y=M*bt,ht[k].$orotation=ht[k].$rotation,ht[k].$rotation=W,ht[k].$hp=z,ht[k].dying=!1,ht[k].alpha=1,ht[k].scale=1):ht[k]=new Yi(k,P*bt,M*bt,U*bt,A,W,z),ht[k].active=!0):Mo(ht[k])?ht[k].dying=!0:delete ht[k]}for(T=0;T<b;T++)k=i.getUint16(a,!0),a+=mt,P=i.getFloat32(a,!0),a+=gt,M=i.getFloat32(a,!0),a+=gt,U=i.getFloat32(a,!0),a+=gt,A=i.getUint8(a,!0),a+=dt,p.push(k),Object.keys(ut).indexOf(String(k))>-1?(ut[k].$ox=ut[k].$x,ut[k].$oy=ut[k].$y,ut[k].$x=P*bt,ut[k].$y=M*bt,ut[k].dying=!1,ut[k].firstFrame=!1,ut[k].alpha=1,ut[k].scale=1):ut[k]=new ji(k,P*bt,M*bt,U*bt,A);for(T=0;T<S;T++){k=i.getUint16(a,!0),a+=mt;var B=i.getUint32(a,!0);a+=yt;var L=i.getUint8(a,!0);a+=dt;for(var C=[],D=0;D<L;D++)C.push(i.getInt8(a,!0)),a+=dt;var R=Ct;try{var H=String.fromCharCode.apply(null,C);R=decodeURIComponent(escape(atob(H)))}catch(t){}Object.keys(pt).indexOf(String(k))<0?pt[k]=new Ni(R,B):pt[k].$score=B}for(k in ct)if(h.indexOf(Number(k))<0)if(ct[k].owner==J&&Lo(),Mo(ct[k]))ct[k].dying=!0;else{var E=ft.indexOf(ct[k]);E>-1&&ft.splice(E,1),delete ct[k]}for(k in ht)u.indexOf(Number(k))<0&&(ht[k].active=!1);for(k in ut)p.indexOf(Number(k))<0&&(Mo(ut[k])?ut[k].dying=!0:delete ut[k]);break;case ve.joined:setTimeout(function(){removeBanner(),prepareInterstitial(),G=!0,De=Date.now(),Po(),Xi=null,Ut=.5,Se.first=!1,Go(),n.style.opacity=1,yo(!0),Se.tutorialStage==Te.wasd&&(setTimeout(function(){mobile?Do("Touch the left side of the screen, and move to control your tank",jt):Do("WASD or arrow keys to move",jt)},ke),Se.tutorialStage++,Go())},Ci);break;case ve.info:for(bt=i.getFloat32(a+gt+gt,!0),qt=Xt*bt,l.lineWidth=qt*Pt,v=i.getFloat32(a,!0)*bt,a+=gt,w=i.getFloat32(a,!0)*bt,Tt=(y=v)/2,kt=(g=w)/2,a+=gt+gt,J=i.getUint16(a,!0),a+=mt,Ci=i.getFloat32(a,!0),Di=Ci,a+=gt,Ri=i.getUint32(a,!0),a+=yt,Hi=i.getFloat32(a,!0),a+=gt,Ei=i.getUint8(a,!0),a+=dt,T=0;T<Ne.length;T++)Ne[T].cost=i.getInt32(a,!0),a+=yt;!function(){Ee=[];for(var t=0;t<Ne.length;t++)Ee[t]=t;Ee.sort(function(t,e){return Ne[t].cost-Ne[e].cost})}(),pt[J]=new Ni(Xe.value,0),function(){Ti.width=Qt+ie,Ti.height=Qt+ie,ki.lineWidth=qt*(Qt/(Ne[we.basicUnit].size*bt*2)),ki.lineCap="round",ki.lineJoin="round",ri.innerHTML="";var t=Pt;Pt=1;for(var e=0;e<oe-1;e++)for(var i=0;i<Ee.length;i++)if(Ee[i]!=we.core&&Ee[i]!=we.boosterUnit){var o="u:"+Ee[i]+";"+e;ki.clearRect(0,0,Ti.width,Ti.height),Ne[Ee[i]].bottom(ki,Ti.width/2,Ti.height/2,Qt/2,.75*Math.PI,0,e),Ne[Ee[i]].top(ki,Ti.width/2,Ti.height/2,Qt/2,.75*Math.PI,0,e);var a=Ti.toDataURL("image/png",1);ri.innerHTML+='<div id="'+o+'" class="item"><div class="item-inner"><img src="'+a+'" class="store-image" draggable="false" width="'+(Kt+ie)+'px"><br>'+Ne[Ee[i]].name+'<br><img style="height:18px;position:relative;top:2px;" src="'+ne[e]+'"> '+Uo(Ne[Ee[i]].cost,e)+' <span class="minor">'+ae[e]+"</span></div></div>"}Pt=t;for(var n=document.getElementsByClassName("item"),e=0;e<n.length;e++)n[e].onclick=To,mobile||(n[e].onmouseenter=ko),n[e].children[0].children[0].draggable=!1,n[e].ondragstart=To}(),console.log("Showing menu"),Oe.style.opacity="0",setTimeout(function(){Oe.style.visibility="hidden"},1500),go(),Xi=null;break;case ve.stash:var N=i.getUint8(a);for(N&&(N=!Pe,Pe=!1),a+=dt,T=0;T<oe;T++){var O=ce[T];if(ce[T]=i.getInt32(a+yt*T,!0),ce[T]!=O){if(N){var _=ce[T]-O;Do(_<0?Ro(_)+" "+ae[T]:"+"+Ro(_)+" "+ae[T],Yt)}Se.tutorialStage==Te.saveUp&&(Do("Well done! Next, save up some Wood",jt),setTimeout(function(){Do("Soon, you'll be able to start building units",jt),Pe=!0},ke),Se.tutorialStage++,Go())}}de=i.getInt32(a+yt*T,!0),function(){for(var t=0;t<oe;t++)for(var e=1;e<Ne.length;e++){var i=qo("u:"+e+";"+t).getElementsByClassName("item-inner")[0].getElementsByClassName("store-image")[0];Uo(Ne[e].cost,t)<=ce[t]?(i.style.opacity=1,Se.tutorialStage==Te.firstUnit&&(Do("Nice! You can now build your first unit",jt),setTimeout(function(){mobile?Do("Tap on the icon in the store, and use your target to place it",jt):Do("Click on the icon in the store, and click again where you want to place it",jt)},ke),Se.tutorialStage++,Go())):i.style.opacity=.4}}();break;case ve.scale:Mt=i.getFloat32(a,!0);case ve.leaderboard:var Y="<table>",j=i.getInt32(a,!0);a+=yt;var X=mt+yt+dt;for(mobile&&j>x&&(j=x),T=0;T<j;T++){for(k=i.getUint16(a,!0),B=i.getInt32(a+mt,!0),L=i.getUint8(a+mt+yt,!0),C=[],D=0;D<L;D++)C.push(i.getInt8(a+mt+yt+dt+D,!0));R=Ct;try{H=String.fromCharCode.apply(null,C),R=decodeURIComponent(escape(atob(H)))}catch(t){}""==R&&(R=Ct),a+=X+L,Y+="<tr",k==J&&(Y+=' class="me"'),Y+='><td class="left"><div class="truncate">'+(T+1)+". "+Vo(R)+'</div></td><td class="right">'+Ro(B)+"</td></tr>"}Y+="</table>",Si.innerHTML=Y,Si.style.opacity="1";break;case ve.die:for(showInterstitial(),createBanner(),s||"app"==parse_query_string(window.location.search.substring(1)).source||aiptag.cmd.display.push(function(){aipDisplayTag.refresh("tanksmith-io_300x250")}),L=i.getUint8(a,!0),a+=dt,C=[],D=0;D<L;D++)C.push(i.getInt8(a+D,!0));R=Ct;try{H=String.fromCharCode.apply(null,C),R=decodeURIComponent(escape(atob(H)))}catch(t){}""==R&&(R=Ct);var q="players";1==Q&&(q="player"),zi.innerHTML="<h3>Destroyed by "+R+'</h3><span class="minor">You achieved a </span>score of '+Ro(de)+'<span class="minor"> and </span>destroyed '+Q+" "+q+' <span class="minor">in </span>'+Eo(Date.now()-De)+'<span class="minor">.</span>',mobile||(zi.innerHTML+=' <a class="twitter-share-button" href="https://twitter.com/intent/tweet?original_referer=http%3A%2F%2Ftanksmith.io%2F&ref_src=twsrc%5Etfw&text=I%20played%20Tanksmith.io:%20achieved%20a%20score%20of%20'+Ro(de)+"%20and%20destroyed%20"+Q+"%20"+q+"%20in%20"+Eo(Date.now()-De)+'%20%23tanksmithio%20%23ioninja%20%23iogames%20via%20%40ioninja14">Tweet</a> this.');var V=[];for(T=0;T<ce.length;T++)if(ce[T]>0){var K=0,Z=Math.floor(Se.socialButtons.length*He/Math.pow(2,T));(K=ce[T]<=Z?Z:Math.floor((ce[T]-Z)/2)+Z)>0&&V.push(Ro(K)+'&nbsp;<span class="minor">'+ae[T]+"</span>")}if(0==V.length)qe.style.display="none";else{qe.style.display="block";var tt='<span class="minor">Respawn with</span> ';if(1==V.length)tt+=V[0];else if(2==V.length)tt+=V.join(' <span class="minor">and</span> ');else{var et=V.splice(V.length-1,1);tt+=V.join('<span class="minor">, </span>'),tt+=' <span class="minor">and</span> '+et}qe.innerHTML=tt}mo(),go();break;case ve.shake:break;case ve.kill:for(L=i.getUint8(a,!0),a+=dt,C=[],D=0;D<L;D++)C.push(i.getInt8(a+D,!0));R=Ct;try{H=String.fromCharCode.apply(null,C),R=decodeURIComponent(escape(atob(H)))}catch(t){}""==R&&(R=Ct),Q++,Do("You destroyed "+R,Yt);break;case ve.resize:v=i.getFloat32(a,!0)*bt,w=i.getFloat32(a+gt,!0)*bt}}catch(t){}}}catch(t){throw setTimeout(function(){onDisconnect()},1e3),t}var na};ready();