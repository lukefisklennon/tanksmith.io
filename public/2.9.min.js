scriptActive=!0;var go=function(t){try{var e,i,a=!0,o=!1,n=document.getElementById("canvas"),l=n.getContext("2d"),s=!1,r=0,c=0,h=0,d=0,m=!1,y=0,g=0,v=0,w=0;if(mobile){var x=5;Wt=window.devicePixelRatio||1;var S=!1,T=0,k=0,P=T,M=k,U={x:T,y:k},$=0,I=0,A=0,F=0,W=0,z=60*gameScale,B=0,L=!1,C=0,D=0,R=0,H=0,E=0,N=0,O=0,_=0,Y=20*gameScale,j=1.5,X=0}for(var V=100,q=3,G=!1,J=null,K=!1,Q=0,Z=[87,38,65,37,83,40,68,39,1,2],tt={},et=!1,it=!1,at=0,ot=0,nt=0,lt=0,st=at,rt=ot,ct={},ht={},ut={},pt={},ft=[],dt=1,mt=2,yt=4,gt=4,bt=1,vt=null,wt=0,xt=0,St=0,Tt=y/2,kt=g/2,Pt=1,Mt=1,Ut=Mt,$t=50,It=1040,At=590,Ft=It/At,Wt=1,zt=15,Bt=.1,Lt=4,Ct="Unknown",Dt=!1,Rt=0,Ht=0,Et=0,Nt=0,Ot=!1,_t=null,Yt=4e3,jt=8e3,Xt=.13,Vt=Xt*bt,qt=-.3,Gt=20,Jt=.5,Kt=70,Qt=Kt,Zt=0,te=0,ee=!1,ie=15,ae=6,oe=["Wood","Iron","Gold","Diamond","Amethyst","Onyx"],ne=[],le=22,se=le,re=4,ce=[],he=[],ue=[],pe=[],fe=0;fe<ae;fe++)ce[fe]=0,he[fe]=0,ue[fe]=0,pe[fe]=0;var de=0,me=0,ye=0,ge=0;try{1==performance.navigation.type&&(playCount=1)}catch(t){}var be={ready:1,key:2,play:3,mouse:4,build:5,upgrade:6,delete:7,move:8,ping:9},ve={update:1,joined:2,info:3,stash:4,scale:5,leaderboard:6,die:7,kick:8,shake:9,kill:10,resize:11},we={core:0,basicUnit:1,basicTurret:2,sniperTurret:3,twinTurret:4,cannonTurret:5,healingUnit:6,alchemyLab:7,boosterUnit:8,octaTurret:9,spike:10},xe={circle:0,triangle:1},Se={name:"",tutorialStage:0,socialTotal:0,socialButtons:[]},Te={wasd:0,click:1,shapes:2,saveUp:3,firstUnit:4,gotUnit:5},ke=2e3,Pe=!1,Me=["#790000","#888888","#efc000","#1bebff","#9400c0","#333333","#ff0000"],Ue="#bfbfbf",$e="#fa0028",Ie="#73eeff",Ae=Ue,Fe=40,We=2,ze="#595959",Be="#05d400",Le="#ffffff",Ce="#111111",De=0,Re=6,He=3,Ee=[],Ne=[{name:"Core",cost:0,size:1.2,mouse:!0,buildable:!0,shape:xe.circle,description:"",top:function(t,e,i,a,o,n,l){Ne[we.basicTurret].top(t,e,i,a,o,n,l)},bottom:function(t,e,i,a,o,n,l){Ne[we.basicUnit].bottom(t,e,i,a,o,n,l)}},{name:"Basic Unit",cost:0,size:1,mouse:!1,buildable:!0,shape:xe.circle,description:"A simple unit which can protect your core",top:function(t,e,i,a,o,n,l){},bottom:function(t,e,i,a,o,n,l){t.fillStyle=Me[l],t.strokeStyle=Ya(Me[l],qt),t.beginPath(),t.arc(e,i,a-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()}},{name:"Basic Turret",cost:0,size:1,mouse:!0,buildable:!0,shape:xe.circle,description:"A regular turret with a single gun",top:function(t,e,i,a,o,n,l){var s=.6*a;t.beginPath(),t.fillStyle=Ue,t.strokeStyle=Ya(Ue,qt),t.save(),t.translate(e,i),t.rotate(o),t.fillRect(-s/2,0,s,2*s),t.strokeRect(-s/2,0,s,2*s),t.restore(),t.arc(e,i,a/2-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},bottom:function(t,e,i,a,o,n,l){Ne[we.basicUnit].bottom(t,e,i,a,o,n,l)}},{name:"Sniper Turret",cost:0,size:1,mouse:!0,buildable:!0,shape:xe.circle,description:"A long-range gunner which shoots fast projectiles",top:function(t,e,i,a,o,n,l){var s=.4*a,r=3.5*s;t.beginPath(),t.fillStyle=Ue,t.strokeStyle=Ya(Ue,qt),t.save(),t.translate(e,i),t.rotate(o),t.fillRect(-s/2,0,s,r),t.strokeRect(-s/2,0,s,r),t.restore(),t.arc(e,i,a/2-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},bottom:function(t,e,i,a,o,n,l){Ne[we.basicUnit].bottom(t,e,i,a,o,n,l)}},{name:"Twin Turret",cost:0,size:1,mouse:!0,buildable:!0,shape:xe.circle,description:"A turret with two guns, which fire small bullets",top:function(t,e,i,a,o,n,l){var s=a/2-t.lineWidth,r=.6*a*2;t.beginPath(),t.fillStyle=Ue,t.strokeStyle=Ya(Ue,qt),t.save(),t.translate(e,i),t.rotate(o),t.fillRect(-s,0,s,r),t.strokeRect(-s,0,s,r),t.fillRect(0,0,s,r),t.strokeRect(0,0,s,r),t.restore(),t.arc(e,i,a/2-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},bottom:function(t,e,i,a,o,n,l){Ne[we.basicUnit].bottom(t,e,i,a,o,n,l)}},{name:"Cannon Turret",cost:0,size:1,mouse:!0,buildable:!0,shape:xe.circle,description:"A slow, but powerful gun capable of dealing hefty damage",top:function(t,e,i,a,o,n,l){var s=.6*a*1.4,r=.6*a*2;t.beginPath(),t.fillStyle=Ue,t.strokeStyle=Ya(Ue,qt),t.save(),t.translate(e,i),t.rotate(o),t.fillRect(-s/2,0,s,r),t.strokeRect(-s/2,0,s,r),t.restore(),t.arc(e,i,a/2-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},bottom:function(t,e,i,a,o,n,l){Ne[we.basicUnit].bottom(t,e,i,a,o,n,l)}},{name:"Healing Unit",cost:0,size:1,mouse:!1,buildable:!0,shape:xe.circle,description:"A support unit which heals connected units over time",top:function(t,e,i,a,o,n,l){},bottom:function(t,e,i,a,o,n,l){Ne[we.basicUnit].bottom(t,e,i,a,o,n,l);var s=a-.35*a,r=.7*s/2;t.fillStyle=$e,t.strokeStyle=Ya($e,qt),t.beginPath(),t.save(),t.translate(e,i),t.rotate(n),t.moveTo(-r,-s),t.lineTo(r,-s),t.lineTo(r,-r),t.lineTo(s,-r),t.lineTo(s,r),t.lineTo(r,r),t.lineTo(r,s),t.lineTo(-r,s),t.lineTo(-r,r),t.lineTo(-s,r),t.lineTo(-s,-r),t.lineTo(-r,-r),t.lineTo(-r,-s),t.restore(),t.closePath(),t.fill(),t.stroke()}},{name:"Alchemy Lab",cost:0,size:1,mouse:!1,buildable:!0,shape:xe.circle,description:"An experimental unit which converts one resource to another",top:function(t,e,i,a,o,n,l){},bottom:function(t,e,i,a,o,n,l){Ne[we.basicUnit].bottom(t,e,i,a,o,n,l),t.fillStyle=Ie,t.strokeStyle=Ya(Ie,qt),t.save(),t.translate(e,i),t.rotate(n);for(var s=0;s<3;s++){t.beginPath();var r=Ea(0,0,2*Math.PI/3*s,.45*a);t.arc(r.x,r.y,a/3-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()}t.restore()}},{name:"Booster Unit",cost:0,size:1,mouse:!1,buildable:!0,shape:xe.circle,description:"A unit which increases your overall speed",top:function(t,e,i,a,o,n,l){},bottom:function(t,e,i,a,o,n,l){Ne[we.basicUnit].bottom(t,e,i,a,o,n,l);var s=.8*a;t.fillStyle=Ae,t.strokeStyle=Ya(Ae,qt),t.save(),t.translate(e,i),t.rotate(o+n),t.beginPath(),t.arc(0,0,s/3-t.lineWidth/2,0,2*Math.PI),t.moveTo(s-t.lineWidth/2,0);for(var r=2*Math.PI/10,c=0;c<10;c++){var h=0;c%2!=0&&(h=.2*a),t.arc(0,0,s-t.lineWidth/2-h,r*c,r*(c+1))}Ea(0,0,r,s-t.lineWidth/2-h);t.lineTo(s-t.lineWidth/2,0),t.fill(),t.stroke(),t.closePath(),t.fillStyle=Me[l],t.beginPath(),t.arc(0,0,s/3-t.lineWidth,0,2*Math.PI),t.fill(),t.closePath(),t.restore()}},{name:"Octa Turret",cost:0,size:1,mouse:!0,buildable:!0,shape:xe.circle,description:"A turret with eight guns, that fire slowly but in every direction",top:function(t,e,i,a,o,n,l){var s=.6*a;t.beginPath(),t.fillStyle=Ue,t.strokeStyle=Ya(Ue,qt);for(var r=0;r<8;r++)t.save(),t.translate(e,i),t.rotate(o+2*Math.PI/8*r),t.fillRect(-s/4,0,s/2,2*s),t.strokeRect(-s/4,0,s/2,2*s),t.restore();t.arc(e,i,a/2-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},bottom:function(t,e,i,a,o,n,l){Ne[we.basicUnit].bottom(t,e,i,a,o,n,l)}},{name:"Spike",cost:0,size:.5,mouse:!1,buildable:!1,shape:xe.triangle,description:"A small appendage which deals significant collision damage",top:function(){},bottom:function(t,e,i,a,o,n,l){a*=.8,t.fillStyle=Me[l],t.strokeStyle=Ya(Me[l],qt),t.save(),t.translate(e,i),t.rotate(n),t.beginPath(),t.moveTo(0,Vt/2-a),t.lineTo(Vt/2-a,a-Vt/2),t.lineTo(a-Vt/2,a-Vt/2),t.lineTo(0,Vt/2-a),t.closePath(),t.fill(),t.stroke(),t.restore()}}],Oe=ja("loading"),_e=ja("menu"),Ye=ja("middle-container"),je=(ja("overlay"),ja("main"),ja("title"),ja("play")),Xe=ja("name"),Ve=ja("respawn-info"),qe=ja("social"),Ge=ja("count"),Je=ja("version"),Ke=ja("links"),Qe=ja("party"),Ze=ja("apps"),ti=ja("help"),ei=ja("help-inner"),ii=ja("hud"),ai=ja("tip"),oi=ja("alerts"),ni=ja("store-toggle"),li=ja("toggle-arrow-wrapper"),si=ja("store"),ri=ja("store-scroll"),ci=ja("stash"),hi=ja("arrow-left"),ui=ja("arrow-right"),pi=ja("arrow-left-wrapper"),fi=ja("arrow-right-wrapper"),di=ja("stash-main"),mi=ja("stash-special"),yi=ja("score"),gi=ja("options"),bi=ja("options-heading"),vi=ja("options-close"),wi=ja("upgrade-button"),xi=ja("destroy-button"),Si=ja("leaderboard"),Ti=ja("scanner"),ki=Ti.getContext("2d"),Pi=ja("units"),Mi=ja("minimap");Mi.width=V,Mi.height=V;var Ui=Mi.getContext("2d"),$i=ja("tutorial-mobile"),Ii=ja("share-message"),Ai=ja("discord"),Fi=ja("share-progress-outer"),Wi=ja("share-progress-inner"),zi=ja("death"),Bi=function(){Wt=window.devicePixelRatio||1,n.style.width=window.innerWidth+"px",n.style.height=window.innerHeight+"px",n.width=window.innerWidth*Wt,n.height=window.innerHeight*Wt,l.scale(Wt,Wt),Qt=Kt*Wt,se=le*Wt,e=window.innerWidth,i=window.innerHeight,Li(),function(){calculateScale(),Ye.style.transform="translate(-50%, -50%) scale("+gameScale+")",Ze.style.transform="scale("+gameScale+")",Ze.style.margin=8*gameScale+"px",mobile?Ze.style.bottom=92*gameScale+10*gameScale+"px":Ze.style.bottom=92*gameScale+"px";Qe.style.transform="scale("+gameScale+")",Qe.style.margin=8*gameScale+"px",Qe.style.bottom=8*gameScale+"px",Ge.style.transform="scale("+gameScale+")",Ge.style.margin=8*gameScale+"px",Je.style.transform="scale("+gameScale+")",Je.style.margin=8*gameScale+"px",si.style.transform="translateX(-50%) scale("+gameScale+")",si.style.margin=8*gameScale+"px",ni.style.transform="translateX(-100%) scale("+gameScale+")",ni.style.margin=8*gameScale+"px",mobile?ni.style.left="calc(50% - "+292*gameScale+"px - "+8*gameScale+"px)":ni.style.left="calc(50% - "+460*gameScale+"px - "+8*gameScale+"px)";if(ci.style.transform="scale("+gameScale+")",ci.style.margin=8*gameScale+"px",di.style.margin="0px",mi.style.margin="0px",mi.style.marginBottom="8px",Pi.style.transform="scale("+gameScale+")",Pi.style.margin=8*gameScale+"px",Si.style.transform="scale("+gameScale+")",Si.style.margin=8*gameScale+"px",yi.style.transform="scale("+gameScale+")",yi.style.margin=8*gameScale+"px",oi.style.transform="translateX(-50%) scale("+gameScale+")",oi.style.bottom=156*gameScale+"px",gi.style.top=8*gameScale+"px",gi.style.transform="translateX(-50%) scale("+gameScale+")",Ke.style.transform="scale("+gameScale+")",Ke.style.margin=8*gameScale+"px",Ke.style.bottom=8*gameScale+"px",Ke.style.maxWidth="calc(50% - "+200*gameScale+"px)",Mi.style.transform="scale("+gameScale+")",Mi.style.margin=8*gameScale+"px",Mi.style.bottom=46*gameScale+"px","app"!=parse_query_string(window.location.search.substring(1)).source){if(mobile)ja("tanksmith-io_300x250").style.transform="scale("+gameScale+")",ja("tanksmith-io_300x250").style.left="auto",ja("tanksmith-io_300x250").style.right=8*gameScale+"px",ja("tanksmith-io_300x250").style.transformOrigin="100% 100%";else{var t=gameScale;window.innerHeight>800&&(gameScale=1),ja("tanksmith-io_300x250").style.transform="translateX(-50%) scale("+gameScale+")",gameScale=t}ja("tanksmith-io_300x250").style.bottom=8*gameScale+"px"}}(),l.lineCap="round",l.lineJoin="round",l.lineWidth=Vt*Pt};ii.children;function Li(){Pt=e/i>=Ft?e/It:i/At,Pt*=Ut}window.onresize=Bi,Bi();Date.now();var Ci=50,Di=Ci,Ri=1/0,Hi=0,Ei=1,Ni=function(t,e){this.name=Xa(t),this.$score=e,this.score=e};Ni.prototype.update=function(){this.score=_a(this.score,this.$score,.1)};var Oi=function(t,e,i,a,o){this.id=t,this.$x=e,this.$ox=e,this.x=e,this.$y=i,this.$oy=i,this.y=i,this.size=a,this.material=o,this.dying=!1,this.alpha=1,this.scale=1};Oi.prototype.objUpdate=function(t){this.dying?(this.alpha-=.1,this.scale+=.2,this.x-=(this.$ox-this.$x)*t,this.y-=(this.$oy-this.$y)*t):(this.x=Oa(this.$ox,this.x,this.$x,t),this.y=Oa(this.$oy,this.y,this.$y,t))},Oi.prototype.renderHealthBar=function(){var t=0;this.hp<1&&(t=1),this.hpAlpha=_a(this.hpAlpha,t,.2),this.hpAlpha>.01&&function(t,e,i,a){a<1&&(l.globalAlpha=a);l.lineWidth=(Vt+We)*Pt,l.beginPath(),l.strokeStyle=ze,l.moveTo(t-Fe*Pt/2,e),l.lineTo(t+Fe*Pt/2,e),l.stroke(),l.closePath(),l.beginPath(),l.lineWidth=Vt*Pt,l.strokeStyle=Be,l.moveTo(t-Fe*Pt/2,e),i*=2,i-=1,i*=Fe*Pt/2,l.lineTo(t+i,e),l.stroke(),l.closePath(),a<1&&(l.globalAlpha=1)}(Aa(this.x),Fa(this.y)+(this.size+12)*Pt,this.hp,this.alpha*this.hpAlpha)};var _i=function(t,e,i,a,o,n,l,s,r,c){Oi.call(this,t,e,i,a,o),this.type=n,this.owner=l,this.$angle=s,this.angle=s,this.$orotation=r,this.$rotation=r,this.rotation=r,this.$hp=c,this.hp=c,this.hpAlpha=0,this.mouse=Ne[this.type].mouse,this.buildable=Ne[this.type].buildable,this.deleteAmount=Math.floor(Pa(Ne[this.type].cost,this.material)/2)};_i.prototype=new Oi,_i.prototype.update=function(t){!m&&this.owner==J&&this.mouse||(Math.abs(this.$angle-this.angle)>Math.PI&&(this.$angle>this.angle?this.angle+=2*Math.PI:this.angle-=2*Math.PI),this.angle=_a(this.angle,this.$angle,t));if(this.rotation=Oa(this.$orotation,this.rotation,this.$rotation,t),this.hp=_a(this.hp,this.$hp,.1),this.alpha<=0){var e=ft.indexOf(ct[this.id]);e>-1&&ft.splice(e,1),delete ct[this.id]}},_i.prototype.renderBottom=function(){this.alpha<1&&(l.globalAlpha=this.alpha),Ne[this.type].bottom(l,Aa(this.x),Fa(this.y),this.size*this.scale*Pt,this.angle,this.rotation,this.material),this.alpha<1&&(l.globalAlpha=1)},_i.prototype.renderTop=function(){this.alpha<1&&(l.globalAlpha=this.alpha),Ne[this.type].top(l,Aa(this.x),Fa(this.y),this.size*this.scale*Pt,this.angle,this.rotation,this.material),this.alpha<1&&(l.globalAlpha=1),s&&(l.fillStyle="#f00",l.beginPath(),l.arc(Aa(this.$x),Fa(this.$y),10*Pt,0,2*Math.PI),l.fill(),l.closePath())},_i.prototype.renderName=function(){var t=!0;if(this.owner==J){var e=Date.now()-De;e<4e3?e>2e3&&(l.globalAlpha=1-(e-2e3)/2e3):t=!1}else this.alpha<1&&(this.alpha>.01?l.globalAlpha=this.alpha:t=!1);if(t&&pt[this.owner]){l.fillStyle=Le,l.strokeStyle=Ce,l.lineWidth=2*Pt,l.textAlign="center",l.font="900 "+20*Pt+"px Ubuntu";var i=Aa(this.x),a=Fa(this.y)-(this.size+15)*Pt;l.strokeText(pt[this.owner].name,i,a),l.fillText(pt[this.owner].name,i,a),l.font="900 "+10*Pt+"px Ubuntu",a+=10*Pt;var o=Ca(pt[this.owner].score);l.strokeText(o,i,a),l.fillText(o,i,a),l.lineWidth=Vt*Pt,l.globalAlpha=1}};var Yi=function(t,e,i,a,o,n,l){Oi.call(this,t,e,i,a,o),this.$orotation=n,this.$rotation=n,this.rotation=n,this.$hp=l,this.hp=l,this.hpAlpha=0,this.active=!1};Yi.prototype=new Oi,Yi.prototype.update=function(t){this.alpha<=0?delete ht[this.id]:this.$x<-v/2||this.$x>v/2||this.$y<-w/2||this.$y>w/2?this.dying=!0:(this.rotation=Oa(this.$orotation,this.rotation,this.$rotation,t),this.active||this.$hp<1&&(this.$hp+=Hi*(zt/Ci)*Ei),this.hp=_a(this.hp,this.$hp,.1))},Yi.prototype.render=function(){this.alpha<1&&(l.globalAlpha=this.alpha),l.fillStyle=Me[this.material],l.strokeStyle=Ya(Me[this.material],qt),l.save(),l.translate(Aa(this.x),Fa(this.y)),l.rotate(this.rotation),l.beginPath(),l.moveTo(0,-this.size*this.scale*Pt+Vt*Pt/2),l.lineTo(-this.size*this.scale*Pt+Vt*Pt/2,this.size*this.scale*Pt-Vt*Pt/2),l.lineTo(this.size*this.scale*Pt-Vt*Pt/2,this.size*this.scale*Pt-Vt*Pt/2),l.lineTo(0,-this.size*this.scale*Pt+Vt*Pt/2),l.closePath(),l.fill(),l.stroke(),l.restore(),s&&(this.active?l.fillStyle="#f00":l.fillStyle="#00f",l.beginPath(),l.arc(Aa(this.$x),Fa(this.$y),10*Pt,0,2*Math.PI),l.fill(),l.closePath()),this.alpha<1&&(l.globalAlpha=1)};var ji=function(t,e,i,a,o){Oi.call(this,t,e,i,a,o),this.firstFrame=!0};ji.prototype=new Oi,ji.prototype.update=function(){this.alpha<=0&&delete ut[this.id]},ji.prototype.render=function(){this.alpha<1&&(l.globalAlpha=this.alpha),l.fillStyle=Me[this.material],l.strokeStyle=Ya(Me[this.material],qt),l.beginPath(),l.arc(Aa(this.x),Fa(this.y),this.size*this.scale*Pt-l.lineWidth/2,0,2*Math.PI),l.closePath(),l.fill(),l.stroke(),s&&(l.fillStyle="#f00",l.beginPath(),l.arc(Aa(this.$x),Fa(this.$y),10*Pt,0,2*Math.PI),l.fill(),l.closePath()),this.alpha<1&&(l.globalAlpha=1)};var Xi=null;function Vi(){console.log("Disconnected!"),Ve.style.display="none",n.style.opacity=0,da(!1),Oe.style.visibility="visible",Oe.style.opacity="1",fa(),o=!1,a=!1,pt={},ct={},ut={},ht={},ft=[],zi.style.display="none",onDisconnect()}var qi=function(t){if(G)if(Dt){if(Dt&&!Ot&&Pa(Ne[Rt].cost,Ht)<=ce[Ht])if(ft.length<=Ri){et||(Dt=!1);var e=new ArrayBuffer(dt+mt+dt+dt+gt),i=new DataView(e,0);i.setUint8(0,be.build,!0),i.setUint16(dt,Et,!0),i.setUint8(dt+mt,Rt,!0),i.setUint8(dt+mt+dt,Ht,!0),i.setFloat32(dt+mt+dt+dt,Nt,!0),oo(e)}else La("You have built the maximum number of units",jt)}else _t=wa(t.clientX,t.clientY),$a()},Gi=!1;if(n.onmousedown=function(t){G&&!Dt&&ua(1,1)},n.onmouseup=function(t){ua(1,0)},mobile||(n.onclick=qi),document.addEventListener("mousemove",function(t){at=t.pageX,ot=t.pageY,o&&G&&null!=vt&&!m&&Ma(),Gi&&(ai.style.left=t.clientX,ai.style.top=t.clientY-10)},!0),mobile||(ri.onmouseleave=function(){ai.style.opacity="0",setTimeout(function(){"0"==ai.style.opacity&&(ai.style.display="none",Gi=!1)},200)}),window.oncontextmenu=function(t){},mobile){n.addEventListener("touchstart",function(t){for(var a=0;a<t.changedTouches.length;a++){var o=t.changedTouches[a],n=o.pageX,l=o.pageY;null==wa(n,l)&&(n<e/2?(S=!0,U={x:P=T=n,y:M=k=l}):(L=!0,C=n,D=l,R=0,H=0,E=0,N=0,O=0,_=0,at=e/2,ot=i/2,Dt||ua(1,1)))}return t.preventDefault(),!1},!1),n.addEventListener("touchmove",function(t){for(var i=0;i<t.changedTouches.length;i++){var a=t.changedTouches[i],o=a.pageX,n=a.pageY;o<e/2?S?($=Ha(T,k,P=o,M=n),I=Na(T,k,P,M),U=I>z?Ea(T,k,$,z):{x:P,y:M},(W=I/z)>1&&(W=1),Se.tutorialStage==Te.click&&(setTimeout(function(){La("Touch the right side of the screen, and move to adjust your target",jt)},ke),Se.tutorialStage++,Va())):(L=!1,ua(1,0)):L?(O=R,_=H,R=(o-C)*j,H=(n-D)*j):(S=!1,W=0)}return t.preventDefault(),!1},!1);var Ji=function(t){for(var i=0;i<t.changedTouches.length;i++){var a=t.changedTouches[i],o=a.pageX,n=a.pageY;o<e/2?(S=!1,$=0,W=0):(L=!1,ua(1,0))}return qi({clientX:o,clientY:n}),t.preventDefault(),!1};n.addEventListener("touchend",Ji,!1),n.addEventListener("touchcancel",Ji,!1),ri.style.overflowX="scroll",ri.onscroll=function(t){ee||(Zt=ri.scrollLeft,te=Zt),ee=!1},Xe.onclick=function(t){return Xe.value=prompt("Enter name"),t.preventDefault,!1};try{for(var Ki in document.styleSheets){var Qi=document.styleSheets[Ki];if(Qi.rules)for(var Zi=Qi.rules.length-1;Zi>=0;Zi--)Qi.rules[Zi].selectorText&&Qi.rules[Zi].selectorText.match(":hover")&&Qi.deleteRule(Zi)}}catch(t){}re*=Wt,Ke.style.display="none",Qe.style.fontSize="25px",Je.style.fontSize="25px",Ge.style.fontSize="25px",si.style.width="584px",ri.style.width="504px",app?Ze.style.display="none":(ja("app-android").style.height="54px",Ze.style.height="54px"),ti.style.position="fixed",ti.style.left="50%",ti.style.top="-200%",ti.style.transform="translate(-50%,-50%)",ti.style.zIndex="999",ti.style.width="374px",ti.style.height="294px",ti.style.fontSize="25px",ei.style.height="232px",ja("help-heading").style.fontSize="35px",ja("help-inner").innerHTML='Touch the left side of the screen, and move <span class="minor">to control your tank</span><br>Touch the right side of the screen, and move <span class="minor">to aim</span><br>Protect your core <span class="minor">to stay alive</span><br>Destroy shapes <span class="minor">to collect resources</span><br>Select a unit from the store <span class="minor">and tap to place it</span><br>Collect better resources <span class="minor">to build better units</span><br>Tap a unit in your tank <span class="minor">to upgrade or destroy it</span><br>Assemble your tank <span class="minor">to become powerful</span><br>Battle other players <span class="minor">and climb the leaderboard</span><div id="close-tutorial" style="width:100%;text-align:right"><a href="#">Close tutorial</a></div>',null!=ja("social-column")&&ja("social-column").remove(),$i.style.display="block",$i.onclick=function(){ei.scrollTop=0,ti.style.top="50%"},ja("close-tutorial").onclick=function(){ti.style.top="-200%"}}var ta=168;function ea(t){var e=ta;t<0&&(e*=-1),(Zt+=e)<0&&(Zt=0);var i=ri.scrollWidth-ri.clientWidth;Zt>i&&(Zt=i)}ri.onwheel=function(t){ea(t.deltaY)};var ia=!1,aa=!1,oa=250,na=function(){ia=!0,ea(-1),setTimeout(ca.bind(null,-1),oa)},la=function(){aa=!0,ea(1),setTimeout(ca.bind(null,1),oa)},sa=function(){ia=!1},ra=function(){aa=!1};function ca(t){-1==t?ia&&ha(t):1==t&&aa&&ha(t)}function ha(t){ea(t),setTimeout(ca.bind(null,t),oa)}function ua(t,e,i){var a=0;if(null!=tt[t]&&(a=tt[t]),tt[t]=e,17==t)et=e;else if(27==t)Dt=!1;else if(69==t&&0==e)(it=!it)?ua(1,1):ua(1,0,1);else if((1!=t||0!=e||!it)&&o&&Z.indexOf(t)>-1&&(i||e!=a)){Se.tutorialStage==Te.click&&1!=t&&2!=t?(setTimeout(function(){La("Left-mouse click to fire",jt)},ke),Se.tutorialStage++,Va()):Se.tutorialStage!=Te.shapes||1!=t&&2!=t||(setTimeout(function(){La("Destroy shapes to gather resources",jt)},ke),Se.tutorialStage++,Va());var n=new ArrayBuffer(dt+dt+dt),l=new DataView(n,0);l.setUint8(0,be.key,!0),l.setUint8(1,t,!0),l.setUint8(2,e,!0),oo(n)}}function pa(){io&&("app"!=parse_query_string(window.location.search.substring(1)).source&&"localhost"!=window.location.hostname&&(playCount-1)%3==0?(console.log("Calling video ad"),aiptag.cmd.player.push(function(){adplayer.startPreRoll()})):continueToPlay(),playCount++)}function fa(){G=!1,vt=null,!1,Q=0,ai.style.display="none",ai.style.opacity="0"}function da(t){_e.style.opacity="0",Ye.style["transition-timing-function"]="ease-in",Ye.style.top="-50%",ii.style.opacity=t?"1":"0",setTimeout(function(){G&&"0"==_e.style.opacity&&(_e.style.display="none")},1500)}function ma(){_e.style.display="block";_e.clientHeight;_e.style.opacity="1",Ye.style["transition-timing-function"]="ease-out",Ye.style.top="50%",ii.style.opacity="0"}mobile?(pi.ontouchstart=na,fi.ontouchstart=la,pi.ontouchend=sa,fi.ontouchend=ra,pi.ontouchcancel=sa,fi.ontouchcancel=ra):(pi.onmousedown=na,fi.onmousedown=la,pi.onmouseup=sa,fi.onmouseup=ra),document.onkeydown=function(t){G&&ua(t.keyCode,1)},document.onkeyup=function(t){G&&ua(t.keyCode,0)},continueToPlay=function(){Se.name=Xe.value,Va();var t=btoa(unescape(encodeURIComponent(Xe.value))).substring(0,22).split(""),e=new ArrayBuffer(dt+dt+dt+t.length),i=new DataView(e,0);i.setUint8(0,be.play,!0),i.setUint8(1,t.length,!0),i.setUint8(2,Se.socialButtons.length,!0);for(var a=dt+dt+dt,o=0;o<t.length;o++)i.setUint8(a+o,t[o].charCodeAt(0),!0);oo(e),void 0!==pt[J]&&(pt[J].name=Xa(Xe.value)),K=!0},l.lineCap="round",l.lineJoin="round",l.lineWidth=Vt*Pt;var ya=Date.now(),ga=1,ba=(Date.now(),function(){var t,o=Date.now()-ya;for(u in zt=(zt+o)/2,(ga=o/Di)>1&&(ga=1),ya=Date.now(),ct)ct[u].objUpdate(ga),ct[u].update(ga);null!=vt&&(t=Bt*(o/zt),xt=_a(xt,vt.$ox-vt.$x,t),St=_a(St,vt.$oy-vt.$y,t),Tt=vt.x+xt*Lt,kt=vt.y+St*Lt,Ut=_a(Ut,Mt,t),Li(),function(){te=_a(te,Zt,.1),Math.abs(ri.scrollLeft-te)>1&&(ri.scrollLeft=te,ee=!0);ri.scrollLeft<=1?hi.style.opacity=.3:hi.style.opacity=1;ri.scrollLeft>=ri.scrollWidth-ri.clientWidth-1?ui.style.opacity=.3:ui.style.opacity=1}()),y=_a(y,v,.1),g=_a(g,w,.1),function(){l.fillStyle="#f2f2f2",l.fillRect(0,0,e,i),l.strokeStyle="#dddddd",l.lineWidth=Jt*Pt;for(var t=Aa(Math.ceil((Tt-e/2/Pt)/Gt)*Gt),a=-1;a<e/(Gt*Pt)+2;a++)l.beginPath(),l.moveTo(t+a*Gt*Pt,0),l.lineTo(t+a*Gt*Pt,i),l.stroke(),l.closePath();for(var o=Fa(Math.ceil((kt-i/2/Pt)/Gt)*Gt),a=-1;a<i/(Gt*Pt)+2;a++)l.beginPath(),l.moveTo(0,o+a*Gt*Pt),l.lineTo(e,o+a*Gt*Pt),l.stroke(),l.closePath();l.lineWidth=Vt*Pt,l.fillStyle="#000000",l.globalAlpha=.2,l.fillRect(Aa(-y/2)-e,0,e,i),l.fillRect(Aa(y/2),0,e,i),l.fillRect(Aa(-y/2),Fa(-g/2)-i,y*Pt,i),l.fillRect(Aa(-y/2),Fa(g/2),y*Pt,i),l.globalAlpha=1}(),ye=_a(ye,de,.1);for(var c=0;c<ae;c++)ue[c]=_a(ue[c],ce[c],.1);for(p in Ta(),m||Ma(),pt)pt[p].update();for(f in ht)ht[f].objUpdate(ga),ht[f].update(ga),null!=ht[f]&&ka(ht[f])&&ht[f].render();for(u in ct)ct[u].renderBottom();for(b in ut)ut[b].objUpdate(ga),ut[b].update(),null==ut[b]||ut[b].firstFrame||ut[b].render();for(p in Dt?function(){for(var t=at,e=ot,i=0,a=-1,o=0,n=0;n<ft.length;n++)if(ft[n].buildable){var s=Na(at,ot,Aa(ft[n].x),Fa(ft[n].y));(a<0||s<a)&&(a=s,o=n)}if(void 0!==ft[o]){Et=ft[o].id,i=Ha(at,ot,Aa(ft[o].x),Fa(ft[o].y))+Math.PI,Nt=i;var r=Ne[ft[o].type].size*Pt*bt;Ne[Rt].shape==xe.circle?r+=Ne[Rt].size*Pt*bt:Ne[Rt].shape==xe.triangle&&(r+=Ne[Rt].size/2*Pt*bt);var c=Ea(Aa(ft[o].x),Fa(ft[o].y),i,r);t=c.x,e=c.y}Ot=!1;for(var h=Ht,n=0;n<ft.length;n++)if(n!=o&&Na(t,e,Aa(ft[n].x),Fa(ft[n].y))<(Ne[Rt].size*bt+ft[n].size)*Pt){Ot=!0,h=ae;break}l.globalAlpha=.8,Ne[Rt].bottom(l,t,e,Ne[Rt].size*Pt*bt,i-Math.PI/2,i-Math.PI/2+Math.PI,h),Ne[Rt].top(l,t,e,Ne[Rt].size*Pt*bt,i-Math.PI/2,i-Math.PI/2+Math.PI,h),l.globalAlpha=1}():wa(at,ot)?n.style.cursor="pointer":n.style.cursor="crosshair",ct)ct[p].renderTop();for(u in ct)ct[u].type==we.core&&ct[u].renderName();for(f in ht)ht[f].renderHealthBar();for(p in ct)ct[p].renderHealthBar();if(null!=vt&&(l.save(),l.translate(Aa(vt.x),Fa(vt.y)),l.rotate(wt),l.beginPath(),l.setLineDash([10*Pt,10*Pt]),l.strokeStyle="#000000",l.globalAlpha=.2,l.lineWidth=3*Pt,l.arc(0,0,(vt.size+25)*Pt,0,2*Math.PI),l.stroke(),l.closePath(),l.restore(),l.lineWidth=Vt*Pt,l.setLineDash([]),l.globalAlpha=1,wt+=.01,Ui.clearRect(0,0,V,V),Ui.fillStyle="#FFFFFF",Ui.beginPath(),Ui.arc(vt.x/y*(V-2*q)+V/2+q/4,vt.y/g*(V-2*q)+V/2+q/4,q,0,2*Math.PI),Ui.closePath(),Ui.fill()),mobile&&(S?(B+=.1)>1&&(B=1):(B-=.1)<0&&(B=0),L?(X+=.1)>1&&(X=1):(X-=.1)<0&&(X=0),B>0&&(l.globalAlpha=.25*B,l.fillStyle="#000",l.beginPath(),l.arc(T,k,z,0,2*Math.PI),l.fill(),l.closePath(),l.beginPath(),l.arc(U.x,U.y,z/2,0,2*Math.PI),l.fill(),l.closePath(),l.globalAlpha=1),X>0)){E=Oa(O,E,R,1/j),N=Oa(_,N,H,1/j),at=e/2+E,ot=i/2+N,l.lineCap="butt",l.globalAlpha=.5*X,l.strokeStyle="#000";var x=e/2+E,P=i/2+N;l.beginPath(),l.moveTo(x,P-Y),l.lineTo(x,P+Y),l.moveTo(x-Y,P),l.lineTo(x+Y,P),l.stroke(),l.closePath(),l.globalAlpha=1,l.lineCap="round"}if(s){l.fillStyle=Le,l.strokeStyle=Ce,l.lineWidth=2,l.textAlign="left",l.font="900 20px Ubuntu";x=5,P=20;var M="Data total: "+Da(r);l.strokeText(M,x,P),l.fillText(M,x,P),P+=20;var $="Data per second: "+Da(h);l.strokeText($,x,P),l.fillText($,x,P),P+=20;var I="Local FPS: "+d;l.strokeText(I,x,P),l.fillText(I,x,P),P+=20;var A="Server FPS: "+Math.round(1e3/Di);l.strokeText(A,x,P),l.fillText(A,x,P),l.lineWidth=Vt*Pt}a?va(ba):null!=io&&io.close()}),va=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame;function wa(t,e){for(var i=null,a=0;a<ft.length;a++)if(Na(t,e,Aa(ft[a].x),Fa(ft[a].y))<ft[a].size*Pt){i=ft[a];break}return i}!function(){!function(){var t=se+re;Ti.width=t,Ti.height=t,ki.lineWidth=re,ki.lineCap="round",ki.lineJoin="round";for(var e=0;e<ae;e++){ki.clearRect(0,0,t,t),ki.fillStyle=Me[e],ki.strokeStyle=Ya(Me[e],qt),ki.beginPath(),ki.moveTo(se/2+re/2,re),ki.lineTo(se,se),ki.lineTo(re,se),ki.lineTo(se/2+re/2,re),ki.closePath(),ki.fill(),ki.stroke();var i=Ti.toDataURL("image/png",1);ne[e]=i}}();for(var t="",e="",i=0;i<ae;i++){var a='<div id="so'+i+'" class="stash-item"><img src="'+ne[i]+'" width="'+le+'px" style="position:relative;top:1.5px;"> <span id="si'+i+'">0</span>';mobile||(a+=' <span class="minor">'+oe[i]+"</span>"),a+="</div>",i==ae-1?e+=a:t+=a}di.innerHTML=t,mi.innerHTML=e,yi.innerHTML='<div id="score-outer" class="stash-item"><span class="minor">Score</span> <span id="score-inner">0</span></div>'}(),ba(),je.onclick=pa,mouseInterval=setInterval(function(){G&&null!=vt&&(function(){if(nt=Math.round((at-Aa(vt.x))/Pt),lt=Math.round((ot-Fa(vt.y))/Pt),null!=vt&&st!=nt&&rt!=lt){var t=new ArrayBuffer(dt+yt+yt),e=new DataView(t,0);e.setUint8(0,be.mouse,!0),e.setInt32(dt,nt,!0),e.setInt32(dt+yt,lt,!0),oo(t),st=nt,rt=lt}}(),mobile&&function(){if(A!=$||F!=W){var t=new ArrayBuffer(dt+gt+gt),e=new DataView(t,0);e.setUint8(0,be.move,!0),e.setFloat32(dt,$,!0),e.setFloat32(dt+gt,W,!0),oo(t),A=$,F=W}}())},30),pingInterval=setInterval(function(){var t=new ArrayBuffer(dt);new DataView(t,0).setUint8(0,be.ping,!0),oo(t)},3e3),s&&(debugInterval=setInterval(function(){h=c,c=0,d=Math.round(1e3/zt)},1e3)),ni.onclick=function(){-1==si.style.transform.indexOf("150%")?(si.style.transform="translateX(-50%) translateY(150%) scale("+gameScale+")",li.style.top="12.5%",li.style.transform="scaleY(-1)"):(si.style.transform="translateX(-50%) translateY(0%) scale("+gameScale+")",li.style.top="37.5%",li.style.transform="scaleY(1)")};var xa=function(t){var e=this.id.split(":")[1].split(";");return Rt=Number(e[0]),Ht=Number(e[1]),Pa(Ne[Rt].cost,Ht)<=ce[Ht]&&ft.length<=Ri?(Dt=!0,mobile&&(S=!1,L=!1)):Pa(Ne[Rt].cost,Ht)>ce[Ht]?La("Gather "+(Pa(Ne[Rt].cost,Ht)-ce[Ht])+" more "+oe[Ht]+" first",jt):ft.length>=Ri&&La("You have built the maximum number of units",jt),!1};function Sa(t){var e=this.id.split(":")[1].split(";"),i=Number(e[0]),a=Number(e[1]);Gi=!0;var o=Ne[i].name+'<br><span class="minor">'+Ne[i].description+"<br>",n=Pa(Ne[i].cost,a)-ce[a];o+=n>0?"Gather</span> "+n+" "+oe[a]:"You have enough</span> "+oe[a],ai.innerHTML=o,ai.style.display="block";ai.clientHeight;ai.style.opacity="1"}function Ta(){for(var t=!1,e=0;e<ae;e++){var i=ja("so"+e);Ca(ue[e])!=Ca(pe[e])&&(ja("si"+e).innerText=Ca(ue[e])),Ca(ce[e])!=Ca(he[e])&&(i.style.animationName="pulse",setTimeout(function(t){t.style.animationName=""}.bind(null,i),1e3),t=!0),he[e]=ce[e],pe[e]=ue[e],0==ce[e]?mi.style.opacity=0:mi.style.opacity=1}t&&$a();i=ja("score-outer");Ca(ye)!=Ca(ge)&&(ja("score-inner").innerText=Ca(ye)),Ca(de)!=Ca(me)&&(i.style.animationName="pulse",setTimeout(function(t){t.style.animationName=""}.bind(null,i),1e3)),me=de,ge=ye}function ka(t){var a=Aa(t.x),o=Fa(t.y),n=t.size*Pt;return a>0-n-$t&&a<e+n+$t&&o>0-n-$t&&o<i+n+$t}function Pa(t,e){return t*(e+1)}function Ma(){for(var t=0;t<ft.length;t++)ft[t].mouse&&(ft[t].angle=Ha(Aa(ft[t].x),Fa(ft[t].y),at,ot)-Math.PI/2)}var Ua=null;function $a(){if(null!=_t){if(bi.innerHTML=Ne[_t.type].name+' <span class="minor">('+oe[_t.material]+")</span>",_t.material<ae-1){var t=Wa(_t);wi.innerHTML='<img style="height:22px;position:relative;top:4px;" src="'+ne[_t.material+1]+'"> Upgrade <span class="minor">-'+t+" "+oe[_t.material+1]+"</span>",t>ce[_t.material+1]||_t.material==ae-2&&_t.type==we.alchemyLab?wi.disabled=!0:wi.disabled=!1}else wi.innerHTML="Fully upgraded",wi.disabled=!0;_t.type!=we.core?(xi.style.display="inline-block",wi.style.width="calc(50% - 4px)",xi.innerHTML='<img style="height:22px;position:relative;top:4px;" src="'+ne[_t.material]+'"> Destroy <span class="minor">+'+_t.deleteAmount+" "+oe[_t.material]+"</span>"):(xi.style.display="none",wi.style.width="100%"),wi.disabled?wi.style.bottom="1px":wi.style.bottom="0px",clearTimeout(Ua),Ua=null,gi.style.display="block";gi.clientHeight;gi.style.opacity="1",ja("")}else Ia()}function Ia(){_t=null,gi.style.opacity="0",Ua=setTimeout(function(){gi.style.display="none"},500)}function Aa(t){return(t-Tt)*Pt+e/2}function Fa(t){return(t-kt)*Pt+i/2}function Wa(t){return Math.floor(Pa(Ne[t.type].cost,t.material+1)-Pa(Ne[t.type].cost,t.material)/4)}function za(){Pi.innerHTML=ft.length-1+'<span class="minor">/'+Ri+" units</span>"}wi.onclick=function(){if(Wa(_t)<=ce[_t.material+1]){var t=new ArrayBuffer(dt+mt),e=new DataView(t,0);e.setUint8(0,be.upgrade,!0),e.setUint16(dt,_t.id,!0),oo(t)}else _t.material<ae-1?La("Gather "+(Wa(_t)-ce[_t.material+1])+" more "+oe[_t.material+1]+" first",jt):La("This unit has been upgraded to the limit",jt);Ia()},xi.onclick=function(){if(null!=_t&&_t.type!=we.core){var t=new ArrayBuffer(dt+mt),e=new DataView(t,0);e.setUint8(0,be.delete,!0),e.setUint16(dt,_t.id,!0),oo(t)}Ia()},vi.onclick=function(){Ia()};var Ba=0;function La(t,e){oi.innerHTML+='<div class="alert" id="m'+Ba+'" style="opacity:0;margin-bottom:-24px;width:100%;"></div>';var i="m"+Ba,a=document.getElementById(i);a.clientHeight;a.innerText=t,a.style.opacity=1,a.style.marginBottom="0px",Ba++,setTimeout(function(){document.getElementById(i).style.opacity=0,setTimeout(function(){document.getElementById(i).remove()}.bind(null,i),500)}.bind(null,i),e)}function Ca(t){return(t=Math.round(t))>=1e3&&(t=(t/=1e3).toFixed(1),t+="k"),t}function Da(t){return t>=1e3&&t<1e6?(t/=1e3,t=Math.round(t),t+="KB"):t>=1e6&&t<1e9?(t/=1e6,t=Math.round(t),t+="MB"):t>=1e9&&(t/=1e9,t=Math.round(t),t+="GB"),t}function Ra(t){t=Math.round(t/1e3);var e,i=Math.floor(t/3600),a=Math.floor((t-3600*i)/60),o=t-3600*i-60*a,n=[];return i>0&&(e=" hour",1!=i&&(e+="s"),n.push(i+e)),a>0&&(e=" minute",1!=a&&(e+="s"),n.push(a+e)),e=" second",1!=o&&(e+="s"),n.push(o+e),1==n.length?n[0]:2==n.length?n[0]+" and "+n[1]:3==n.length?n[0]+", "+n[1]+" and "+n[2]:void 0}function Ha(t,e,i,a){return Math.atan2(a-e,i-t)}function Ea(t,e,i,a){return{x:Math.cos(i)*a+t,y:Math.sin(i)*a+e}}function Na(t,e,i,a){return Math.sqrt((t-i)*(t-i)+(e-a)*(e-a))}function Oa(t,e,i,a){var o=(Math.abs(i-t)>=Math.abs(i-e)?i-t:i-e)*a;return e==i||e<i&&e+o>i||e>i&&e+o<i?i:e+o}function _a(t,e,i){return t*(1-i)+e*i}function Ya(t,e){var i=parseInt(t.slice(1),16),a=e<0?0:255,o=e<0?-1*e:e,n=i>>16,l=i>>8&255,s=255&i;return"#"+(16777216+65536*(Math.round((a-n)*o)+n)+256*(Math.round((a-l)*o)+l)+(Math.round((a-s)*o)+s)).toString(16).slice(1)}function ja(t){return document.getElementById(t)}function Xa(t){return profanityFilter.clean(t)}function Va(){localStorage.data=JSON.stringify(Se)}localStorage.data?Se=JSON.parse(localStorage.data):Va(),Xe.value=Se.name,mobile||Xe.focus();var qa=function(){var t=btoa(unescape(encodeURIComponent(Xe.value))).substr(0,22);try{Xe.value=decodeURIComponent(escape(atob(t)))}catch(t){console.log("Error: "+t),Xe.value=Xe.value.substr(0,22)}};if(Xe.oninput=qa,Xe.onpaste=qa,Xe.onkeydown=function(t){"Enter"==t.key&&pa()},qe){function Ga(t,e,i){var a=Se.socialButtons.indexOf(t);e?-1==a&&Se.socialButtons.push(t):-1!=a&&Se.socialButtons.splice(a,1),Se.socialTotal=Se.socialButtons.length*He,Va(),0!=i&&Ja()}function Ja(){Se.socialTotal>0&&Se.socialTotal<Re*He?Ii.innerHTML="Increase your bonus by clicking other social media buttons":Se.socialTotal>=Re*He?Ii.innerHTML="Thanks for your support!":Se.socialTotal<=0&&(Ii.innerHTML="Start with extra resources by supporting us on social media"),Se.socialTotal>0&&(Fi.style.display="block",Wi.style.width=Se.socialTotal/(Re*He)*100+"%",Wi.innerText="+"+Se.socialTotal),Ii.onclick=null}function Ka(t){setTimeout(function(){Ii.innerHTML='<a href="#">Click to redeem</a>',Ii.onclick=function(){Ii.onclick=null,Ga(t,!0,!0)}.bind(null,t)},3e3)}function Qa(){"undefined"!=typeof FB&&(FB.Event.subscribe("edge.create",function(){Ga("facebook-like",!0,!0)}),FB.Event.subscribe("edge.remove",function(){Ga("facebook-like",!1,!0)})),"undefined"!=typeof twttr&&(twttr.events.bind("tweet",function(){Ka("twitter-tweet")}),twttr.events.bind("follow",function(){Ka("twitter-follow")}))}"undefined"==typeof FB||"undefined"==typeof twttr?window.addEventListener("load",function(){Qa()}):Qa(),Ai.onclick=function(){Ga("discord-join",!0,!0)};var Za=!1,to=ja("___ytsubscribe_0");null!=to&&(to.onmouseenter=function(){Za=!0},to.onmouseleave=function(){Za=!1});var eo=!1,ao=document.getElementsByClassName("fb-share-button")[0];ao.onmouseenter=function(){eo=!0},ao.onmouseleave=function(){eo=!1},Ja()}function oo(t){null!=io&&1==io.readyState&&io.send(t)}window.onbeforeunload=function(){if(null!=io&&(io.onclose=function(){},io.close()),qe&&Za&&Ga("youtube-subscribe",!0,!1),K&&"app"!=parse_query_string(window.location.search.substring(1)).source)return"Are you sure that you want to exit? You will lose your current progress in the game"},window.onblur=function(){qe&&eo&&Ka("facebook-share");for(var t=0;t<Z.length;t++)ua(Z[t],0)},document.onmouseout=function(){ua(1,0)},no=t,console.log("Setting up the network for "+no),window.WebSocket=window.WebSocket||window.MozWebSocket,null==io||io.readyState>2?(io=new WebSocket(no),io.binaryType="arraybuffer"):null!=io&&io.close(),io.onopen=function(){console.log("Connected!"),o=!0;var t=new ArrayBuffer(dt);new DataView(t,0).setUint8(0,be.ready,!0),oo(t)},io.onclose=Vi,io.onmessage=function(t){try{var e=t.data,i=new DataView(t.data),a=i.getUint8(0,!0),o=dt;switch(r+=e.byteLength,c+=e.byteLength,a){case ve.update:null!=Xi&&(Di=_a(Di,Date.now()-Xi,.1)),Xi=Date.now();var h=[],u=[],p=[],f=i.getUint16(o,!0);o+=mt;var d=i.getUint16(o,!0);o+=mt;var b=i.getUint16(o,!0);o+=mt;var S=i.getUint16(o,!0);o+=mt;for(var T=0;T<f;T++){var k=i.getUint16(o,!0);o+=mt;var P=i.getFloat32(o,!0);o+=gt;var M=i.getFloat32(o,!0);o+=gt;var U=i.getFloat32(o,!0);o+=gt;var $=i.getFloat32(o,!0);o+=gt;var I=i.getUint8(o,!0);o+=dt;var A=i.getUint8(o,!0);o+=dt;var F=i.getUint16(o,!0);o+=mt,(z=i.getFloat32(o,!0))<0&&(z=0),o+=gt;var W=i.getFloat32(o,!0);o+=gt,h.push(k),Object.keys(ct).indexOf(String(k))>-1?(ct[k].$ox=ct[k].$x,ct[k].$oy=ct[k].$y,ct[k].$x=P*bt,ct[k].$y=M*bt,!m&&ct[k].owner==J&&ct[k].mouse||(ct[k].$angle=$),ct[k].$orotation=ct[k].$rotation,ct[k].$rotation=W,ct[k].material!=A&&(ct[k].deleteAmount=Math.floor(Pa(Ne[ct[k].type].cost,A)/2)),ct[k].material=A,ct[k].$hp=z,ct[k].owner==J&&ct[k].type==we.core&&(vt=ct[k]),ct[k].dying=!1,ct[k].alpha=1,ct[k].scale=1):(ct[k]=new _i(k,P*bt,M*bt,U*bt,A,I,F,$,W,z),ct[k].owner==J&&(ft.push(ct[k]),Se.tutorialStage==Te.gotUnit&&ct[k].type!=we.core&&(Pe=!0,La("Awesome! You can now gather more resources to build your tank",jt),setTimeout(function(){var t="click";mobile&&(t="tap"),La("Also, you can "+t+" one of your units to upgrade or destroy it",jt),setTimeout(function(){La("Protect your core: if it gets destroyed, your whole tank will get demolished",jt),setTimeout(function(){La("Good luck!",jt)},ke)},jt+ke)},ke),Se.tutorialStage++,Va())),za())}for(T=0;T<d;T++){var z;k=i.getUint16(o,!0),o+=mt,u.push(k),P=i.getFloat32(o,!0),o+=gt,-1!=P?(M=i.getFloat32(o,!0),o+=gt,U=i.getFloat32(o,!0),o+=gt,W=i.getFloat32(o,!0),o+=gt,A=i.getUint8(o,!0),o+=dt,(z=i.getFloat32(o,!0))<0&&(z=0),o+=gt,Object.keys(ht).indexOf(String(k))>-1?(ht[k].$ox=ht[k].$x,ht[k].$oy=ht[k].$y,ht[k].$x=P*bt,ht[k].$y=M*bt,ht[k].$orotation=ht[k].$rotation,ht[k].$rotation=W,ht[k].$hp=z,ht[k].dying=!1,ht[k].alpha=1,ht[k].scale=1):ht[k]=new Yi(k,P*bt,M*bt,U*bt,A,W,z),ht[k].active=!0):ka(ht[k])?ht[k].dying=!0:delete ht[k]}for(T=0;T<b;T++)k=i.getUint16(o,!0),o+=mt,P=i.getFloat32(o,!0),o+=gt,M=i.getFloat32(o,!0),o+=gt,U=i.getFloat32(o,!0),o+=gt,A=i.getUint8(o,!0),o+=dt,p.push(k),Object.keys(ut).indexOf(String(k))>-1?(ut[k].$ox=ut[k].$x,ut[k].$oy=ut[k].$y,ut[k].$x=P*bt,ut[k].$y=M*bt,ut[k].dying=!1,ut[k].firstFrame=!1,ut[k].alpha=1,ut[k].scale=1):ut[k]=new ji(k,P*bt,M*bt,U*bt,A);for(T=0;T<S;T++){k=i.getUint16(o,!0),o+=mt;var B=i.getUint32(o,!0);o+=yt;var L=i.getUint8(o,!0);o+=dt;for(var C=[],D=0;D<L;D++)C.push(i.getInt8(o,!0)),o+=dt;var R=Ct;try{var H=String.fromCharCode.apply(null,C);R=decodeURIComponent(escape(atob(H)))}catch(t){}Object.keys(pt).indexOf(String(k))<0?pt[k]=new Ni(R,B):pt[k].$score=B}for(k in ct)if(h.indexOf(Number(k))<0)if(ct[k].owner==J&&za(),ka(ct[k]))ct[k].dying=!0;else{var E=ft.indexOf(ct[k]);E>-1&&ft.splice(E,1),delete ct[k]}for(k in ht)u.indexOf(Number(k))<0&&(ht[k].active=!1);for(k in ut)p.indexOf(Number(k))<0&&(ka(ut[k])?ut[k].dying=!0:delete ut[k]);break;case ve.joined:setTimeout(function(){actuallyHasPlayed=!0,removeBanner(),prepareInterstitial(),G=!0,De=Date.now(),Ta(),Xi=null,Ut=.5,Se.first=!1,Va(),n.style.opacity=1,da(!0),Se.tutorialStage==Te.wasd&&(setTimeout(function(){mobile?La("Touch the left side of the screen, and move to control your tank",jt):La("WASD or arrow keys to move",jt)},ke),Se.tutorialStage++,Va())},Ci);break;case ve.info:for(bt=i.getFloat32(o+gt+gt,!0),Vt=Xt*bt,l.lineWidth=Vt*Pt,v=i.getFloat32(o,!0)*bt,o+=gt,w=i.getFloat32(o,!0)*bt,Tt=(y=v)/2,kt=(g=w)/2,o+=gt+gt,J=i.getUint16(o,!0),o+=mt,Ci=i.getFloat32(o,!0),Di=Ci,o+=gt,Ri=i.getUint32(o,!0),o+=yt,Hi=i.getFloat32(o,!0),o+=gt,Ei=i.getUint8(o,!0),o+=dt,T=0;T<Ne.length;T++)Ne[T].cost=i.getInt32(o,!0),o+=yt;!function(){Ee=[];for(var t=0;t<Ne.length;t++)Ee[t]=t;Ee.sort(function(t,e){return Ne[t].cost-Ne[e].cost})}(),pt[J]=new Ni(Xe.value,0),function(){Ti.width=Qt+ie,Ti.height=Qt+ie,ki.lineWidth=Vt*(Qt/(Ne[we.basicUnit].size*bt*2)),ki.lineCap="round",ki.lineJoin="round",ri.innerHTML="";var t=Pt;Pt=1;for(var e=0;e<ae-1;e++)for(var i=0;i<Ee.length;i++)if(Ee[i]!=we.core&&Ee[i]!=we.boosterUnit){var a="u:"+Ee[i]+";"+e;ki.clearRect(0,0,Ti.width,Ti.height),Ne[Ee[i]].bottom(ki,Ti.width/2,Ti.height/2,Qt/2,.75*Math.PI,0,e),Ne[Ee[i]].top(ki,Ti.width/2,Ti.height/2,Qt/2,.75*Math.PI,0,e);var o=Ti.toDataURL("image/png",1);ri.innerHTML+='<div id="'+a+'" class="item"><div class="item-inner"><img src="'+o+'" class="store-image" draggable="false" width="'+(Kt+ie)+'px"><br>'+Ne[Ee[i]].name+'<br><img style="height:18px;position:relative;top:2px;" src="'+ne[e]+'"> '+Pa(Ne[Ee[i]].cost,e)+' <span class="minor">'+oe[e]+"</span></div></div>"}Pt=t;for(var n=document.getElementsByClassName("item"),e=0;e<n.length;e++)n[e].onclick=xa,mobile||(n[e].onmouseenter=Sa),n[e].children[0].children[0].draggable=!1,n[e].ondragstart=xa}(),console.log("Showing menu"),Oe.style.opacity="0",setTimeout(function(){Oe.style.visibility="hidden"},1500),ma(),Xi=null;break;case ve.stash:var N=i.getUint8(o);for(N&&(N=!Pe,Pe=!1),o+=dt,T=0;T<ae;T++){var O=ce[T];if(ce[T]=i.getInt32(o+yt*T,!0),ce[T]!=O){if(N){var _=ce[T]-O;La(_<0?Ca(_)+" "+oe[T]:"+"+Ca(_)+" "+oe[T],Yt)}Se.tutorialStage==Te.saveUp&&(La("Well done! Next, save up some Wood",jt),setTimeout(function(){La("Soon, you'll be able to start building units",jt),Pe=!0},ke),Se.tutorialStage++,Va())}}de=i.getInt32(o+yt*T,!0),function(){for(var t=0;t<ae;t++)for(var e=0;e<Ne.length;e++)if(e!=we.core&&e!=we.boosterUnit){var i=ja("u:"+e+";"+t).getElementsByClassName("item-inner")[0].getElementsByClassName("store-image")[0];Pa(Ne[e].cost,t)<=ce[t]?(i.style.opacity=1,Se.tutorialStage==Te.firstUnit&&(La("Nice! You can now build your first unit",jt),setTimeout(function(){mobile?La("Tap on the icon in the store, and use your target to place it",jt):La("Click on the icon in the store, and click again where you want to place it",jt)},ke),Se.tutorialStage++,Va())):i.style.opacity=.4}}();break;case ve.scale:Mt=i.getFloat32(o,!0);case ve.leaderboard:var Y="<table>",j=i.getInt32(o,!0);o+=yt;var X=mt+yt+dt;for(mobile&&j>x&&(j=x),T=0;T<j;T++){for(k=i.getUint16(o,!0),B=i.getInt32(o+mt,!0),L=i.getUint8(o+mt+yt,!0),C=[],D=0;D<L;D++)C.push(i.getInt8(o+mt+yt+dt+D,!0));R=Ct;try{H=String.fromCharCode.apply(null,C),R=decodeURIComponent(escape(atob(H)))}catch(t){}""==R&&(R=Ct),o+=X+L,Y+="<tr",k==J&&(Y+=' class="me"'),Y+='><td class="left"><div class="truncate">'+(T+1)+". "+Xa(R)+'</div></td><td class="right">'+Ca(B)+"</td></tr>"}Y+="</table>",Si.innerHTML=Y,Si.style.opacity="1";break;case ve.die:for(showInterstitial(),createBanner(),s||"app"==parse_query_string(window.location.search.substring(1)).source||aiptag.cmd.display.push(function(){aipDisplayTag.refresh("tanksmith-io_300x250")}),L=i.getUint8(o,!0),o+=dt,C=[],D=0;D<L;D++)C.push(i.getInt8(o+D,!0));R=Ct;try{H=String.fromCharCode.apply(null,C),R=decodeURIComponent(escape(atob(H)))}catch(t){}""==R&&(R=Ct);var V="players";1==Q&&(V="player"),zi.innerHTML="<h3>Destroyed by "+R+'</h3><span class="minor">You achieved a </span>score of '+Ca(de)+'<span class="minor"> and </span>destroyed '+Q+" "+V+' <span class="minor">in </span>'+Ra(Date.now()-De)+'<span class="minor">.</span>',mobile||(zi.innerHTML+=' <a class="twitter-share-button" href="https://twitter.com/intent/tweet?original_referer=http%3A%2F%2Ftanksmith.io%2F&ref_src=twsrc%5Etfw&text=I%20played%20Tanksmith.io:%20achieved%20a%20score%20of%20'+Ca(de)+"%20and%20destroyed%20"+Q+"%20"+V+"%20in%20"+Ra(Date.now()-De)+'%20%23tanksmithio%20%23ioninja%20%23iogames%20via%20%40ioninja14">Tweet</a> this.');var q=[];for(T=0;T<ce.length;T++)if(ce[T]>0){var K=0,Z=Math.floor(Se.socialButtons.length*He/Math.pow(2,T));(K=ce[T]<=Z?Z:Math.floor((ce[T]-Z)/2)+Z)>0&&q.push(Ca(K)+'&nbsp;<span class="minor">'+oe[T]+"</span>")}if(0==q.length)Ve.style.display="none";else{Ve.style.display="block";var tt='<span class="minor">Respawn with</span> ';if(1==q.length)tt+=q[0];else if(2==q.length)tt+=q.join(' <span class="minor">and</span> ');else{var et=q.splice(q.length-1,1);tt+=q.join('<span class="minor">, </span>'),tt+=' <span class="minor">and</span> '+et}Ve.innerHTML=tt}fa(),ma();break;case ve.shake:break;case ve.kill:for(L=i.getUint8(o,!0),o+=dt,C=[],D=0;D<L;D++)C.push(i.getInt8(o+D,!0));R=Ct;try{H=String.fromCharCode.apply(null,C),R=decodeURIComponent(escape(atob(H)))}catch(t){}""==R&&(R=Ct),Q++,La("You destroyed "+R,Yt);break;case ve.resize:v=i.getFloat32(o,!0)*bt,w=i.getFloat32(o+gt,!0)*bt}}catch(t){}}}catch(t){throw setTimeout(function(){null!=io&&io.close()},1e3),t}var no};ready();