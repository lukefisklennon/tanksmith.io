scriptActive=!0,print=null;var go=function(t,e){try{console.log("Game mode: "+e);var i,a,n=!0,o=!1,l=document.getElementById("canvas"),s=l.getContext("2d"),r="localhost"==window.location.hostname&&!1,c=0,h=0,d=0,m=0,y=!1,g=0,v=0,w=0,x=0;if(mobile){var S=5;zt=window.devicePixelRatio||1;var T=!1,k=0,P=0,M=k,U=P,$={x:k,y:P},I=0,A=0,F=0,W=0,z=0,B=60*gameScale,L=0,C=!1,R=0,D=0,H=0,E=0,N=0,O=0,_=0,Y=0,j=20*gameScale,X=1.5,V=0}for(var q=100,G=3,J=!1,K=null,Q=!1,Z=0,tt=[87,38,65,37,83,40,68,39,1,2],et={},it=!1,at=!1,nt=0,ot=0,lt=0,st=0,rt=nt,ct=ot,ht={},ut={},pt={},ft={},dt=[],mt=1,yt=2,gt=4,bt=4,vt=1,wt=null,xt=0,St=0,Tt=0,kt=g/2,Pt=v/2,Mt=1,Ut=1,$t=Ut,It=50,At=1040,Ft=590,Wt=At/Ft,zt=1,Bt=15,Lt=.1,Ct=4,Rt="Unknown",Dt=!1,Ht=0,Et=0,Nt=0,Ot=0,_t=!1,Yt=null,jt=4e3,Xt=8e3,Vt=.13,qt=Vt*vt,Gt=-.3,Jt=20,Kt=.5,Qt=70,Zt=Qt,te=0,ee=0,ie=!1,ae=15,ne=6,oe=["Wood","Iron","Gold","Diamond","Amethyst","Onyx"],le=[],se=22,re=se,ce=4,he=[],ue=[],pe=[],fe=[],de=0;de<ne;de++)he[de]=0,ue[de]=0,pe[de]=0,fe[de]=0;var me=0,ye=0,ge=0,be=0,ve=1,we=null;try{1==performance.navigation.type&&(playCount=1)}catch(t){}var xe={ready:1,key:2,play:3,mouse:4,build:5,upgrade:6,delete:7,move:8,ping:9},Se={update:1,joined:2,info:3,stash:4,scale:5,leaderboard:6,die:7,kick:8,shake:9,kill:10,resize:11,brState:12,brRank:13},Te={core:0,basicUnit:1,basicTurret:2,sniperTurret:3,twinTurret:4,cannonTurret:5,healingUnit:6,alchemyLab:7,boosterUnit:8,octaTurret:9,spike:10},ke={circle:0,triangle:1},Pe={name:"",tutorialStage:0,socialTotal:0,socialButtons:[]},Me={wasd:0,click:1,shapes:2,saveUp:3,firstUnit:4,gotUnit:5},Ue=2e3,$e=!1,Ie=["#790000","#888888","#efc000","#1bebff","#9400c0","#333333","#ff0000"],Ae="#bfbfbf",Fe="#fa0028",We="#73eeff",ze=Ae,Be=40,Le=2,Ce="#595959",Re="#05d400",De="#ffffff",He="#111111",Ee=0,Ne=6,Oe=3,_e=[],Ye=[{name:"Core",cost:0,size:1.2,mouse:!0,buildable:!0,shape:ke.circle,description:"",top:function(t,e,i,a,n,o,l){Ye[Te.basicTurret].top(t,e,i,a,n,o,l)},bottom:function(t,e,i,a,n,o,l){Ye[Te.basicUnit].bottom(t,e,i,a,n,o,l)}},{name:"Basic Unit",cost:0,size:1,mouse:!1,buildable:!0,shape:ke.circle,description:"A simple unit which can protect your core",top:function(t,e,i,a,n,o,l){},bottom:function(t,e,i,a,n,o,l){t.fillStyle=Ie[l],t.strokeStyle=Va(Ie[l],Gt),t.beginPath(),t.arc(e,i,a-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()}},{name:"Basic Turret",cost:0,size:1,mouse:!0,buildable:!0,shape:ke.circle,description:"A regular turret with a single gun",top:function(t,e,i,a,n,o,l){var s=.6*a;t.beginPath(),t.fillStyle=Ae,t.strokeStyle=Va(Ae,Gt),t.save(),t.translate(e,i),t.rotate(n),t.fillRect(-s/2,0,s,2*s),t.strokeRect(-s/2,0,s,2*s),t.restore(),t.arc(e,i,a/2-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},bottom:function(t,e,i,a,n,o,l){Ye[Te.basicUnit].bottom(t,e,i,a,n,o,l)}},{name:"Sniper Turret",cost:0,size:1,mouse:!0,buildable:!0,shape:ke.circle,description:"A long-range gunner which shoots fast projectiles",top:function(t,e,i,a,n,o,l){var s=.4*a,r=3.5*s;t.beginPath(),t.fillStyle=Ae,t.strokeStyle=Va(Ae,Gt),t.save(),t.translate(e,i),t.rotate(n),t.fillRect(-s/2,0,s,r),t.strokeRect(-s/2,0,s,r),t.restore(),t.arc(e,i,a/2-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},bottom:function(t,e,i,a,n,o,l){Ye[Te.basicUnit].bottom(t,e,i,a,n,o,l)}},{name:"Twin Turret",cost:0,size:1,mouse:!0,buildable:!0,shape:ke.circle,description:"A turret with two guns, which fire small bullets",top:function(t,e,i,a,n,o,l){var s=a/2-t.lineWidth,r=.6*a*2;t.beginPath(),t.fillStyle=Ae,t.strokeStyle=Va(Ae,Gt),t.save(),t.translate(e,i),t.rotate(n),t.fillRect(-s,0,s,r),t.strokeRect(-s,0,s,r),t.fillRect(0,0,s,r),t.strokeRect(0,0,s,r),t.restore(),t.arc(e,i,a/2-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},bottom:function(t,e,i,a,n,o,l){Ye[Te.basicUnit].bottom(t,e,i,a,n,o,l)}},{name:"Cannon Turret",cost:0,size:1,mouse:!0,buildable:!0,shape:ke.circle,description:"A slow, but powerful gun capable of dealing hefty damage",top:function(t,e,i,a,n,o,l){var s=.6*a*1.4,r=.6*a*2;t.beginPath(),t.fillStyle=Ae,t.strokeStyle=Va(Ae,Gt),t.save(),t.translate(e,i),t.rotate(n),t.fillRect(-s/2,0,s,r),t.strokeRect(-s/2,0,s,r),t.restore(),t.arc(e,i,a/2-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},bottom:function(t,e,i,a,n,o,l){Ye[Te.basicUnit].bottom(t,e,i,a,n,o,l)}},{name:"Healing Unit",cost:0,size:1,mouse:!1,buildable:!0,shape:ke.circle,description:"A support unit which heals connected units over time",top:function(t,e,i,a,n,o,l){},bottom:function(t,e,i,a,n,o,l){Ye[Te.basicUnit].bottom(t,e,i,a,n,o,l);var s=a-.35*a,r=.7*s/2;t.fillStyle=Fe,t.strokeStyle=Va(Fe,Gt),t.beginPath(),t.save(),t.translate(e,i),t.rotate(o),t.moveTo(-r,-s),t.lineTo(r,-s),t.lineTo(r,-r),t.lineTo(s,-r),t.lineTo(s,r),t.lineTo(r,r),t.lineTo(r,s),t.lineTo(-r,s),t.lineTo(-r,r),t.lineTo(-s,r),t.lineTo(-s,-r),t.lineTo(-r,-r),t.lineTo(-r,-s),t.restore(),t.closePath(),t.fill(),t.stroke()}},{name:"Alchemy Lab",cost:0,size:1,mouse:!1,buildable:!0,shape:ke.circle,description:"An experimental unit which converts one resource to another",top:function(t,e,i,a,n,o,l){},bottom:function(t,e,i,a,n,o,l){Ye[Te.basicUnit].bottom(t,e,i,a,n,o,l),t.fillStyle=We,t.strokeStyle=Va(We,Gt),t.save(),t.translate(e,i),t.rotate(o);for(var s=0;s<3;s++){t.beginPath();var r=_a(0,0,2*Math.PI/3*s,.45*a);t.arc(r.x,r.y,a/3-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()}t.restore()}},{name:"Booster Unit",cost:0,size:1,mouse:!1,buildable:!0,shape:ke.circle,description:"A unit which increases your overall speed",top:function(t,e,i,a,n,o,l){},bottom:function(t,e,i,a,n,o,l){Ye[Te.basicUnit].bottom(t,e,i,a,n,o,l);var s=.8*a;t.fillStyle=ze,t.strokeStyle=Va(ze,Gt),t.save(),t.translate(e,i),t.rotate(n+o),t.beginPath(),t.arc(0,0,s/3-t.lineWidth/2,0,2*Math.PI),t.moveTo(s-t.lineWidth/2,0);for(var r=2*Math.PI/10,c=0;c<10;c++){var h=0;c%2!=0&&(h=.2*a),t.arc(0,0,s-t.lineWidth/2-h,r*c,r*(c+1))}_a(0,0,r,s-t.lineWidth/2-h);t.lineTo(s-t.lineWidth/2,0),t.fill(),t.stroke(),t.closePath(),t.fillStyle=Ie[l],t.beginPath(),t.arc(0,0,s/3-t.lineWidth,0,2*Math.PI),t.fill(),t.closePath(),t.restore()}},{name:"Octa Turret",cost:0,size:1,mouse:!0,buildable:!0,shape:ke.circle,description:"A turret with eight guns, that fire slowly but in every direction",top:function(t,e,i,a,n,o,l){var s=.6*a;t.beginPath(),t.fillStyle=Ae,t.strokeStyle=Va(Ae,Gt);for(var r=0;r<8;r++)t.save(),t.translate(e,i),t.rotate(n+2*Math.PI/8*r),t.fillRect(-s/4,0,s/2,2*s),t.strokeRect(-s/4,0,s/2,2*s),t.restore();t.arc(e,i,a/2-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},bottom:function(t,e,i,a,n,o,l){Ye[Te.basicUnit].bottom(t,e,i,a,n,o,l)}},{name:"Spike",cost:0,size:.5,mouse:!1,buildable:!1,shape:ke.triangle,description:"A small appendage which deals significant collision damage",top:function(){},bottom:function(t,e,i,a,n,o,l){a*=.8,t.fillStyle=Ie[l],t.strokeStyle=Va(Ie[l],Gt),t.save(),t.translate(e,i),t.rotate(o),t.beginPath(),t.moveTo(0,qt/2-a),t.lineTo(qt/2-a,a-qt/2),t.lineTo(a-qt/2,a-qt/2),t.lineTo(0,qt/2-a),t.closePath(),t.fill(),t.stroke(),t.restore()}}],je=qa("loading"),Xe=qa("menu"),Ve=qa("middle-container"),qe=(qa("overlay"),qa("main"),qa("title"),qa("play")),Ge=qa("name"),Je=qa("respawn-info"),Ke=qa("social"),Qe=qa("count"),Ze=qa("version"),ti=qa("links"),ei=qa("party"),ii=qa("apps"),ai=qa("help"),ni=qa("help-inner"),oi=qa("hud"),li=qa("tip"),si=qa("alerts"),ri=qa("store-toggle"),ci=qa("toggle-arrow-wrapper"),hi=qa("store"),ui=qa("store-scroll"),pi=qa("stash"),fi=qa("arrow-left"),di=qa("arrow-right"),mi=qa("arrow-left-wrapper"),yi=qa("arrow-right-wrapper"),gi=qa("stash-main"),bi=qa("stash-special"),vi=qa("score"),wi=qa("options"),xi=qa("options-heading"),Si=qa("options-close"),Ti=qa("upgrade-button"),ki=qa("destroy-button"),Pi=qa("leaderboard"),Mi=qa("scanner"),Ui=Mi.getContext("2d"),$i=qa("units"),Ii=qa("minimap");Ii.width=q,Ii.height=q;var Ai=Ii.getContext("2d"),Fi=qa("tutorial-mobile"),Wi=qa("share-message"),zi=qa("discord"),Bi=qa("share-progress-outer"),Li=qa("share-progress-inner"),Ci=qa("death"),Ri=function(){zt=window.devicePixelRatio||1,l.style.width=window.innerWidth+"px",l.style.height=window.innerHeight+"px",l.width=window.innerWidth*zt,l.height=window.innerHeight*zt,s.scale(zt,zt),Zt=Qt*zt,re=se*zt,i=window.innerWidth,a=window.innerHeight,Di(),function(){calculateScale(),Ve.style.transform="translate(-50%, -50%) scale("+gameScale+")",ii.style.transform="scale("+gameScale+")",ii.style.margin=8*gameScale+"px",mobile?ii.style.bottom=92*gameScale+10*gameScale+"px":ii.style.bottom=92*gameScale+"px";ei.style.transform="scale("+gameScale+")",ei.style.margin=8*gameScale+"px",ei.style.bottom=8*gameScale+"px",Qe.style.transform="scale("+gameScale+")",Qe.style.margin=8*gameScale+"px",Ze.style.transform="scale("+gameScale+")",Ze.style.margin=8*gameScale+"px",hi.style.transform="translateX(-50%) scale("+gameScale+")",hi.style.margin=8*gameScale+"px",ri.style.transform="translateX(-100%) scale("+gameScale+")",ri.style.margin=8*gameScale+"px",mobile?ri.style.left="calc(50% - "+292*gameScale+"px - "+8*gameScale+"px)":ri.style.left="calc(50% - "+460*gameScale+"px - "+8*gameScale+"px)";if(pi.style.transform="scale("+gameScale+")",pi.style.margin=8*gameScale+"px",gi.style.margin="0px",bi.style.margin="0px",bi.style.marginBottom="8px",$i.style.transform="scale("+gameScale+")",$i.style.margin=8*gameScale+"px",Pi.style.transform="scale("+gameScale+")",Pi.style.margin=8*gameScale+"px",vi.style.transform="scale("+gameScale+")",vi.style.margin=8*gameScale+"px",si.style.transform="translateX(-50%) scale("+gameScale+")",si.style.bottom=156*gameScale+"px",wi.style.top=8*gameScale+"px",wi.style.transform="translateX(-50%) scale("+gameScale+")",ti.style.transform="scale("+gameScale+")",ti.style.margin=8*gameScale+"px",ti.style.bottom=8*gameScale+"px",ti.style.maxWidth="calc(50% - "+200*gameScale+"px)",Ii.style.transform="scale("+gameScale+")",Ii.style.margin=8*gameScale+"px",Ii.style.bottom=46*gameScale+"px","app"!=parse_query_string(window.location.search.substring(1)).source){if(mobile)qa("tanksmith-io_300x250").style.transform="scale("+gameScale+")",qa("tanksmith-io_300x250").style.left="auto",qa("tanksmith-io_300x250").style.right=8*gameScale+"px",qa("tanksmith-io_300x250").style.transformOrigin="100% 100%";else{var t=gameScale;window.innerHeight>800&&(gameScale=1),qa("tanksmith-io_300x250").style.transform="translateX(-50%) scale("+gameScale+")",gameScale=t}qa("tanksmith-io_300x250").style.bottom=8*gameScale+"px"}}(),s.lineCap="round",s.lineJoin="round",s.lineWidth=qt*Mt};oi.children;function Di(){Mt=i/a>=Wt?i/At:a/Ft,Mt*=$t}window.onresize=Ri,Ri();Date.now();var Hi=50,Ei=Hi,Ni=1/0,Oi=0,_i=1,Yi=function(t,e){this.name=Ga(t),this.$score=e,this.score=e};Yi.prototype.update=function(){this.score=Xa(this.score,this.$score,.1)};var ji=function(t,e,i,a,n){this.id=t,this.$x=e,this.$ox=e,this.x=e,this.$y=i,this.$oy=i,this.y=i,this.size=a,this.material=n,this.dying=!1,this.alpha=1,this.scale=1};ji.prototype.objUpdate=function(t){this.dying?(this.alpha-=.1,this.scale+=.2,this.x-=(this.$ox-this.$x)*t,this.y-=(this.$oy-this.$y)*t):(this.x=ja(this.$ox,this.x,this.$x,t),this.y=ja(this.$oy,this.y,this.$y,t))},ji.prototype.renderHealthBar=function(){var t=0;this.hp<1&&(t=1),this.hpAlpha=Xa(this.hpAlpha,t,.2),this.hpAlpha>.01&&function(t,e,i,a){a<1&&(s.globalAlpha=a);s.lineWidth=(qt+Le)*Mt,s.beginPath(),s.strokeStyle=Ce,s.moveTo(t-Be*Mt/2,e),s.lineTo(t+Be*Mt/2,e),s.stroke(),s.closePath(),s.beginPath(),s.lineWidth=qt*Mt,s.strokeStyle=Re,s.moveTo(t-Be*Mt/2,e),i*=2,i-=1,i*=Be*Mt/2,s.lineTo(t+i,e),s.stroke(),s.closePath(),a<1&&(s.globalAlpha=1)}(za(this.x),Ba(this.y)+(this.size+12)*Mt,this.hp,this.alpha*this.hpAlpha)};var Xi=function(t,e,i,a,n,o,l,s,r,c){ji.call(this,t,e,i,a,n),this.type=o,this.owner=l,this.$angle=s,this.angle=s,this.$orotation=r,this.$rotation=r,this.rotation=r,this.$hp=c,this.hp=c,this.hpAlpha=0,this.mouse=Ye[this.type].mouse,this.buildable=Ye[this.type].buildable,this.deleteAmount=Math.floor($a(Ye[this.type].cost,this.material)/2)};Xi.prototype=new ji,Xi.prototype.update=function(t){!y&&this.owner==K&&this.mouse||(Math.abs(this.$angle-this.angle)>Math.PI&&(this.$angle>this.angle?this.angle+=2*Math.PI:this.angle-=2*Math.PI),this.angle=Xa(this.angle,this.$angle,t));if(this.rotation=ja(this.$orotation,this.rotation,this.$rotation,t),this.hp=Xa(this.hp,this.$hp,.1),this.alpha<=0){var e=dt.indexOf(ht[this.id]);e>-1&&dt.splice(e,1),delete ht[this.id]}},Xi.prototype.renderBottom=function(){this.alpha<1&&(s.globalAlpha=this.alpha),Ye[this.type].bottom(s,za(this.x),Ba(this.y),this.size*this.scale*Mt,this.angle,this.rotation,this.material),this.alpha<1&&(s.globalAlpha=1)},Xi.prototype.renderTop=function(){this.alpha<1&&(s.globalAlpha=this.alpha),Ye[this.type].top(s,za(this.x),Ba(this.y),this.size*this.scale*Mt,this.angle,this.rotation,this.material),this.alpha<1&&(s.globalAlpha=1),r&&(s.fillStyle="#f00",s.beginPath(),s.arc(za(this.$x),Ba(this.$y),10*Mt,0,2*Math.PI),s.fill(),s.closePath())},Xi.prototype.renderName=function(){var t=!0;if(this.owner==K){var e=Date.now()-Ee;e<4e3?e>2e3&&(s.globalAlpha=1-(e-2e3)/2e3):t=!1}else this.alpha<1&&(this.alpha>.01?s.globalAlpha=this.alpha:t=!1);if(t&&ft[this.owner]){s.fillStyle=De,s.strokeStyle=He,s.lineWidth=2*Mt,s.textAlign="center",s.font="900 "+20*Mt+"px Ubuntu";var i=za(this.x),a=Ba(this.y)-(this.size+15)*Mt;s.strokeText(ft[this.owner].name,i,a),s.fillText(ft[this.owner].name,i,a),s.font="900 "+10*Mt+"px Ubuntu",a+=10*Mt;var n=Ha(ft[this.owner].score);s.strokeText(n,i,a),s.fillText(n,i,a),s.lineWidth=qt*Mt,s.globalAlpha=1}};var Vi=function(t,e,i,a,n,o,l){ji.call(this,t,e,i,a,n),this.$orotation=o,this.$rotation=o,this.rotation=o,this.$hp=l,this.hp=l,this.hpAlpha=0,this.active=!1};Vi.prototype=new ji,Vi.prototype.update=function(t){this.alpha<=0?delete ut[this.id]:this.$x<-w/2||this.$x>w/2||this.$y<-x/2||this.$y>x/2?this.dying=!0:(this.rotation=ja(this.$orotation,this.rotation,this.$rotation,t),this.active||this.$hp<1&&(this.$hp+=Oi*(Bt/Hi)*_i),this.hp=Xa(this.hp,this.$hp,.1))},Vi.prototype.render=function(){this.alpha<1&&(s.globalAlpha=this.alpha),s.fillStyle=Ie[this.material],s.strokeStyle=Va(Ie[this.material],Gt),s.save(),s.translate(za(this.x),Ba(this.y)),s.rotate(this.rotation),s.beginPath(),s.moveTo(0,-this.size*this.scale*Mt+qt*Mt/2),s.lineTo(-this.size*this.scale*Mt+qt*Mt/2,this.size*this.scale*Mt-qt*Mt/2),s.lineTo(this.size*this.scale*Mt-qt*Mt/2,this.size*this.scale*Mt-qt*Mt/2),s.lineTo(0,-this.size*this.scale*Mt+qt*Mt/2),s.closePath(),s.fill(),s.stroke(),s.restore(),r&&(this.active?s.fillStyle="#f00":s.fillStyle="#00f",s.beginPath(),s.arc(za(this.$x),Ba(this.$y),10*Mt,0,2*Math.PI),s.fill(),s.closePath()),this.alpha<1&&(s.globalAlpha=1)};var qi=function(t,e,i,a,n){ji.call(this,t,e,i,a,n),this.firstFrame=!0};qi.prototype=new ji,qi.prototype.update=function(){this.alpha<=0&&delete pt[this.id]},qi.prototype.render=function(){this.alpha<1&&(s.globalAlpha=this.alpha),s.fillStyle=Ie[this.material],s.strokeStyle=Va(Ie[this.material],Gt),s.beginPath(),s.arc(za(this.x),Ba(this.y),this.size*this.scale*Mt-s.lineWidth/2,0,2*Math.PI),s.closePath(),s.fill(),s.stroke(),r&&(s.fillStyle="#f00",s.beginPath(),s.arc(za(this.$x),Ba(this.$y),10*Mt,0,2*Math.PI),s.fill(),s.closePath()),this.alpha<1&&(s.globalAlpha=1)};var Gi=null;function Ji(){console.log("Disconnected!"),Je.style.display="none",l.style.opacity=0,ga(!1),je.style.visibility="visible",je.style.opacity="1",ya(),o=!1,n=!1,ft={},ht={},pt={},ut={},dt=[],Ci.style.display="none",onDisconnect()}var Ki=function(t){if(J)if(Dt){if(Dt&&!_t&&$a(Ye[Ht].cost,Et)<=he[Et])if(dt.length<=Ni){it||(Dt=!1);var e=new ArrayBuffer(mt+yt+mt+mt+bt),i=new DataView(e,0);i.setUint8(0,xe.build,!0),i.setUint16(mt,Nt,!0),i.setUint8(mt+yt,Ht,!0),i.setUint8(mt+yt+mt,Et,!0),i.setFloat32(mt+yt+mt+mt,Ot,!0),sn(e)}else Da("You have built the maximum number of units",Xt)}else Yt=Ta(t.clientX,t.clientY),Fa()},Qi=!1;if(l.onmousedown=function(t){J&&!Dt&&da(1,1)},l.onmouseup=function(t){da(1,0)},mobile||(l.onclick=Ki),document.addEventListener("mousemove",function(t){nt=t.pageX,ot=t.pageY,o&&J&&null!=wt&&!y&&Ia(),Qi&&(li.style.left=t.clientX,li.style.top=t.clientY-10)},!0),mobile||(ui.onmouseleave=function(){li.style.opacity="0",setTimeout(function(){"0"==li.style.opacity&&(li.style.display="none",Qi=!1)},200)}),window.oncontextmenu=function(t){},mobile){l.addEventListener("touchstart",function(t){for(var e=0;e<t.changedTouches.length;e++){var n=t.changedTouches[e],o=n.pageX,l=n.pageY;null==Ta(o,l)&&(o<i/2?(T=!0,$={x:M=k=o,y:U=P=l}):(C=!0,R=o,D=l,H=0,E=0,N=0,O=0,_=0,Y=0,nt=i/2,ot=a/2,Dt||da(1,1)))}return t.preventDefault(),!1},!1),l.addEventListener("touchmove",function(t){for(var e=0;e<t.changedTouches.length;e++){var a=t.changedTouches[e],n=a.pageX,o=a.pageY;n<i/2?T?(I=Oa(k,P,M=n,U=o),A=Ya(k,P,M,U),$=A>B?_a(k,P,I,B):{x:M,y:U},(z=A/B)>1&&(z=1),Pe.tutorialStage==Me.click&&(setTimeout(function(){Da("Touch the right side of the screen, and move to adjust your target",Xt)},Ue),Pe.tutorialStage++,Ja())):(C=!1,da(1,0)):C?(_=H,Y=E,H=(n-R)*X,E=(o-D)*X):(T=!1,z=0)}return t.preventDefault(),!1},!1);var Zi=function(t){for(var e=0;e<t.changedTouches.length;e++){var a=t.changedTouches[e],n=a.pageX,o=a.pageY;n<i/2?(T=!1,I=0,z=0):(C=!1,da(1,0))}return Ki({clientX:n,clientY:o}),t.preventDefault(),!1};l.addEventListener("touchend",Zi,!1),l.addEventListener("touchcancel",Zi,!1),ui.style.overflowX="scroll",ui.onscroll=function(t){ie||(te=ui.scrollLeft,ee=te),ie=!1},Ge.onclick=function(t){return Ge.value=prompt("Enter name"),t.preventDefault,!1};try{for(var ta in document.styleSheets){var ea=document.styleSheets[ta];if(ea.rules)for(var ia=ea.rules.length-1;ia>=0;ia--)ea.rules[ia].selectorText&&ea.rules[ia].selectorText.match(":hover")&&ea.deleteRule(ia)}}catch(t){}ce*=zt,ti.style.display="none",ei.style.fontSize="25px",Ze.style.fontSize="25px",Qe.style.fontSize="25px",hi.style.width="584px",ui.style.width="504px",app?ii.style.display="none":(qa("app-android").style.height="54px",ii.style.height="54px"),ai.style.position="fixed",ai.style.left="50%",ai.style.top="-200%",ai.style.transform="translate(-50%,-50%)",ai.style.zIndex="999",ai.style.width="374px",ai.style.height="294px",ai.style.fontSize="25px",ni.style.height="232px",qa("help-heading").style.fontSize="35px",qa("help-inner").innerHTML='Touch the left side of the screen, and move <span class="minor">to control your tank</span><br>Touch the right side of the screen, and move <span class="minor">to aim</span><br>Protect your core <span class="minor">to stay alive</span><br>Destroy shapes <span class="minor">to collect resources</span><br>Select a unit from the store <span class="minor">and tap to place it</span><br>Collect better resources <span class="minor">to build better units</span><br>Tap a unit in your tank <span class="minor">to upgrade or destroy it</span><br>Assemble your tank <span class="minor">to become powerful</span><br>Battle other players <span class="minor">and climb the leaderboard</span><div id="close-tutorial" style="width:100%;text-align:right"><a href="#">Close tutorial</a></div>',null!=qa("social-column")&&qa("social-column").remove(),Fi.style.display="block",Fi.onclick=function(){ni.scrollTop=0,ai.style.top="50%"},qa("close-tutorial").onclick=function(){ai.style.top="-200%"}}var aa=168;function na(t){var e=aa;t<0&&(e*=-1),(te+=e)<0&&(te=0);var i=ui.scrollWidth-ui.clientWidth;te>i&&(te=i)}ui.onwheel=function(t){na(t.deltaY)};var oa=!1,la=!1,sa=250,ra=function(){oa=!0,na(-1),setTimeout(pa.bind(null,-1),sa)},ca=function(){la=!0,na(1),setTimeout(pa.bind(null,1),sa)},ha=function(){oa=!1},ua=function(){la=!1};function pa(t){-1==t?oa&&fa(t):1==t&&la&&fa(t)}function fa(t){na(t),setTimeout(pa.bind(null,t),sa)}function da(t,e,i){var a=0;if(null!=et[t]&&(a=et[t]),et[t]=e,17==t)it=e;else if(27==t)Dt=!1;else if(69==t&&0==e)(at=!at)?da(1,1):da(1,0,1);else if((1!=t||0!=e||!at)&&o&&tt.indexOf(t)>-1&&(i||e!=a)){Pe.tutorialStage==Me.click&&1!=t&&2!=t?(setTimeout(function(){Da("Left-mouse click to fire",Xt)},Ue),Pe.tutorialStage++,Ja()):Pe.tutorialStage!=Me.shapes||1!=t&&2!=t||(setTimeout(function(){Da("Destroy shapes to gather resources",Xt)},Ue),Pe.tutorialStage++,Ja());var n=new ArrayBuffer(mt+mt+mt),l=new DataView(n,0);l.setUint8(0,xe.key,!0),l.setUint8(1,t,!0),l.setUint8(2,e,!0),sn(n)}}function ma(){io&&("app"!=parse_query_string(window.location.search.substring(1)).source&&"localhost"!=window.location.hostname&&(playCount-1)%3==0?(console.log("Calling video ad"),aiptag.cmd.player.push(function(){adplayer.startPreRoll()})):continueToPlay(),playCount++)}function ya(){J=!1,wt=null,!1,Z=0,li.style.display="none",li.style.opacity="0"}function ga(t){Xe.style.opacity="0",Ve.style["transition-timing-function"]="ease-in",Ve.style.top="-50%",oi.style.opacity=t?"1":"0",setTimeout(function(){J&&"0"==Xe.style.opacity&&(Xe.style.display="none")},1500)}function ba(){Xe.style.display="block";Xe.clientHeight;Xe.style.opacity="1",Ve.style["transition-timing-function"]="ease-out",Ve.style.top="50%",oi.style.opacity="0",setTimeout(function(){qa("loading").innerHTML="Connecting..."},3e3)}mobile?(mi.ontouchstart=ra,yi.ontouchstart=ca,mi.ontouchend=ha,yi.ontouchend=ua,mi.ontouchcancel=ha,yi.ontouchcancel=ua):(mi.onmousedown=ra,yi.onmousedown=ca,mi.onmouseup=ha,yi.onmouseup=ua),document.onkeydown=function(t){J&&da(t.keyCode,1)},document.onkeyup=function(t){J&&da(t.keyCode,0)},continueToPlay=function(){Pe.name=Ge.value,Ja();var t=btoa(unescape(encodeURIComponent(Ge.value))).substring(0,22).split(""),e=new ArrayBuffer(mt+mt+mt+t.length),i=new DataView(e,0);i.setUint8(0,xe.play,!0),i.setUint8(1,t.length,!0),i.setUint8(2,Pe.socialButtons.length,!0);for(var a=mt+mt+mt,n=0;n<t.length;n++)i.setUint8(a+n,t[n].charCodeAt(0),!0);sn(e),void 0!==ft[K]&&(ft[K].name=Ga(Ge.value)),Q=!0},s.lineCap="round",s.lineJoin="round",s.lineWidth=qt*Mt;var va=Date.now(),wa=1,xa=function(){var t,o=Date.now()-va;for(u in Bt=(Bt+o)/2,(wa=o/Ei)>1&&(wa=1),va=Date.now(),ht)ht[u].objUpdate(wa),ht[u].update(wa);null!=wt&&(t=Lt*(o/Bt),St=Xa(St,wt.$ox-wt.$x,t),Tt=Xa(Tt,wt.$oy-wt.$y,t),kt=wt.x+St*Ct,Pt=wt.y+Tt*Ct,$t=Xa($t,Ut,t),Di(),function(){ee=Xa(ee,te,.1),Math.abs(ui.scrollLeft-ee)>1&&(ui.scrollLeft=ee,ie=!0);ui.scrollLeft<=1?fi.style.opacity=.3:fi.style.opacity=1;ui.scrollLeft>=ui.scrollWidth-ui.clientWidth-1?di.style.opacity=.3:di.style.opacity=1}()),g=Xa(g,w,.1),v=Xa(v,x,.1),function(){s.fillStyle="#f2f2f2",s.fillRect(0,0,i,a),s.strokeStyle="#dddddd",s.lineWidth=Kt*Mt;for(var t=za(Math.ceil((kt-i/2/Mt)/Jt)*Jt),e=-1;e<i/(Jt*Mt)+2;e++)s.beginPath(),s.moveTo(t+e*Jt*Mt,0),s.lineTo(t+e*Jt*Mt,a),s.stroke(),s.closePath();for(var n=Ba(Math.ceil((Pt-a/2/Mt)/Jt)*Jt),e=-1;e<a/(Jt*Mt)+2;e++)s.beginPath(),s.moveTo(0,n+e*Jt*Mt),s.lineTo(i,n+e*Jt*Mt),s.stroke(),s.closePath();s.lineWidth=qt*Mt}(),ge=Xa(ge,me,.1);for(var h=0;h<ne;h++)pe[h]=Xa(pe[h],he[h],.1);for(p in Ma(),y||Ia(),ft)ft[p].update();for(f in ut)ut[f].objUpdate(wa),ut[f].update(wa),null!=ut[f]&&Ua(ut[f])&&ut[f].render();for(u in ht)ht[u].renderBottom();for(b in pt)pt[b].objUpdate(wa),pt[b].update(),null==pt[b]||pt[b].firstFrame||pt[b].render();for(p in Dt?function(){for(var t=nt,e=ot,i=0,a=-1,n=0,o=0;o<dt.length;o++)if(dt[o].buildable){var l=Ya(nt,ot,za(dt[o].x),Ba(dt[o].y));(a<0||l<a)&&(a=l,n=o)}if(void 0!==dt[n]){Nt=dt[n].id,i=Oa(nt,ot,za(dt[n].x),Ba(dt[n].y))+Math.PI,Ot=i;var r=Ye[dt[n].type].size*Mt*vt;Ye[Ht].shape==ke.circle?r+=Ye[Ht].size*Mt*vt:Ye[Ht].shape==ke.triangle&&(r+=Ye[Ht].size/2*Mt*vt);var c=_a(za(dt[n].x),Ba(dt[n].y),i,r);t=c.x,e=c.y}_t=!1;for(var h=Et,o=0;o<dt.length;o++)if(o!=n&&Ya(t,e,za(dt[o].x),Ba(dt[o].y))<(Ye[Ht].size*vt+dt[o].size)*Mt){_t=!0,h=ne;break}s.globalAlpha=.8,Ye[Ht].bottom(s,t,e,Ye[Ht].size*Mt*vt,i-Math.PI/2,i-Math.PI/2+Math.PI,h),Ye[Ht].top(s,t,e,Ye[Ht].size*Mt*vt,i-Math.PI/2,i-Math.PI/2+Math.PI,h),s.globalAlpha=1}():Ta(nt,ot)?l.style.cursor="pointer":l.style.cursor="crosshair",ht)ht[p].renderTop();for(u in ht)ht[u].type==Te.core&&ht[u].renderName();for(f in ut)ut[f].renderHealthBar();for(p in ht)ht[p].renderHealthBar();if(null!=wt&&(s.save(),s.translate(za(wt.x),Ba(wt.y)),s.rotate(xt),s.beginPath(),s.setLineDash([10*Mt,10*Mt]),s.strokeStyle="#000000",s.globalAlpha=.2,s.lineWidth=3*Mt,s.arc(0,0,(wt.size+25)*Mt,0,2*Math.PI),s.stroke(),s.closePath(),s.restore(),s.lineWidth=qt*Mt,s.setLineDash([]),s.globalAlpha=1,xt+=.01,Ai.clearRect(0,0,q,q),Ai.fillStyle="#FFFFFF",Ai.beginPath(),Ai.arc(wt.x/g*(q-2*G)+q/2+G/4,wt.y/v*(q-2*G)+q/2+G/4,G,0,2*Math.PI),Ai.closePath(),Ai.fill()),function(){"ffa"==e?s.fillStyle="#000000":"br"==e&&(s.fillStyle="#ff0000");s.globalAlpha=.2,s.fillRect(za(-g/2)-i,0,i,a),s.fillRect(za(g/2),0,i,a),s.fillRect(za(-g/2),Ba(-v/2)-a,g*Mt,a),s.fillRect(za(-g/2),Ba(v/2),g*Mt,a),s.globalAlpha=1}(),mobile&&(T?(L+=.1)>1&&(L=1):(L-=.1)<0&&(L=0),C?(V+=.1)>1&&(V=1):(V-=.1)<0&&(V=0),L>0&&(s.globalAlpha=.25*L,s.fillStyle="#000",s.beginPath(),s.arc(k,P,B,0,2*Math.PI),s.fill(),s.closePath(),s.beginPath(),s.arc($.x,$.y,B/2,0,2*Math.PI),s.fill(),s.closePath(),s.globalAlpha=1),V>0)){N=ja(_,N,H,1/X),O=ja(Y,O,E,1/X),nt=i/2+N,ot=a/2+O,s.lineCap="butt",s.globalAlpha=.5*V,s.strokeStyle="#000";var S=i/2+N,M=a/2+O;s.beginPath(),s.moveTo(S,M-j),s.lineTo(S,M+j),s.moveTo(S-j,M),s.lineTo(S+j,M),s.stroke(),s.closePath(),s.globalAlpha=1,s.lineCap="round"}if(r){s.fillStyle=De,s.strokeStyle=He,s.lineWidth=2,s.textAlign="left",s.font="900 20px Ubuntu";S=5,M=20;var U="Data total: "+Ea(c);s.strokeText(U,S,M),s.fillText(U,S,M),M+=20;var I="Data per second: "+Ea(d);s.strokeText(I,S,M),s.fillText(I,S,M),M+=20;var A="Local FPS: "+m;s.strokeText(A,S,M),s.fillText(A,S,M),M+=20;var F="Server FPS: "+Math.round(1e3/Ei);s.strokeText(F,S,M),s.fillText(F,S,M),s.lineWidth=qt*Mt}n?Sa(xa):null!=io&&io.close()},Sa=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame;function Ta(t,e){for(var i=null,a=0;a<dt.length;a++)if(Ya(t,e,za(dt[a].x),Ba(dt[a].y))<dt[a].size*Mt){i=dt[a];break}return i}!function(){!function(){var t=re+ce;Mi.width=t,Mi.height=t,Ui.lineWidth=ce,Ui.lineCap="round",Ui.lineJoin="round";for(var e=0;e<ne;e++){Ui.clearRect(0,0,t,t),Ui.fillStyle=Ie[e],Ui.strokeStyle=Va(Ie[e],Gt),Ui.beginPath(),Ui.moveTo(re/2+ce/2,ce),Ui.lineTo(re,re),Ui.lineTo(ce,re),Ui.lineTo(re/2+ce/2,ce),Ui.closePath(),Ui.fill(),Ui.stroke();var i=Mi.toDataURL("image/png",1);le[e]=i}}();for(var t="",e="",i=0;i<ne;i++){var a='<div id="so'+i+'" class="stash-item"><img src="'+le[i]+'" width="'+se+'px" style="position:relative;top:1.5px;"> <span id="si'+i+'">0</span>';mobile||(a+=' <span class="minor">'+oe[i]+"</span>"),a+="</div>",i==ne-1?e+=a:t+=a}gi.innerHTML=t,bi.innerHTML=e,vi.innerHTML='<div id="score-outer" class="stash-item"><span class="minor">Score</span> <span id="score-inner">0</span></div>'}(),xa(),qe.onclick=ma,mouseInterval=setInterval(function(){J&&null!=wt&&(function(){if(lt=Math.round((nt-za(wt.x))/Mt),st=Math.round((ot-Ba(wt.y))/Mt),null!=wt&&rt!=lt&&ct!=st){var t=new ArrayBuffer(mt+gt+gt),e=new DataView(t,0);e.setUint8(0,xe.mouse,!0),e.setInt32(mt,lt,!0),e.setInt32(mt+gt,st,!0),sn(t),rt=lt,ct=st}}(),mobile&&function(){if(F!=I||W!=z){var t=new ArrayBuffer(mt+bt+bt),e=new DataView(t,0);e.setUint8(0,xe.move,!0),e.setFloat32(mt,I,!0),e.setFloat32(mt+bt,z,!0),sn(t),F=I,W=z}}())},30),pingInterval=setInterval(function(){var t=new ArrayBuffer(mt);new DataView(t,0).setUint8(0,xe.ping,!0),sn(t)},3e3),r&&(debugInterval=setInterval(function(){d=h,h=0,m=Math.round(1e3/Bt)},1e3)),ri.onclick=function(){-1==hi.style.transform.indexOf("150%")?(hi.style.transform="translateX(-50%) translateY(150%) scale("+gameScale+")",ci.style.top="12.5%",ci.style.transform="scaleY(-1)"):(hi.style.transform="translateX(-50%) translateY(0%) scale("+gameScale+")",ci.style.top="37.5%",ci.style.transform="scaleY(1)")};var ka=function(t){var i=this.id.split(":")[1].split(";");return Ht=Number(i[0]),Et=Number(i[1]),("ffa"==e||ve<=0)&&$a(Ye[Ht].cost,Et)<=he[Et]&&dt.length<=Ni?(Dt=!0,mobile&&(T=!1,C=!1)):$a(Ye[Ht].cost,Et)>he[Et]?Da("Gather "+($a(Ye[Ht].cost,Et)-he[Et])+" more "+oe[Et]+" first",Xt):dt.length>=Ni&&Da("You have built the maximum number of units",Xt),!1};function Pa(t){var e=this.id.split(":")[1].split(";"),i=Number(e[0]),a=Number(e[1]);Qi=!0;var n=Ye[i].name+'<br><span class="minor">'+Ye[i].description+"<br>",o=$a(Ye[i].cost,a)-he[a];n+=o>0?"Gather</span> "+o+" "+oe[a]:"You have enough</span> "+oe[a],li.innerHTML=n,li.style.display="block";li.clientHeight;li.style.opacity="1"}function Ma(){for(var t=!1,e=0;e<ne;e++){var i=qa("so"+e);Ha(pe[e])!=Ha(fe[e])&&(qa("si"+e).innerText=Ha(pe[e])),Ha(he[e])!=Ha(ue[e])&&(i.style.animationName="pulse",setTimeout(function(t){t.style.animationName=""}.bind(null,i),1e3),t=!0),ue[e]=he[e],fe[e]=pe[e],0==he[e]?bi.style.opacity=0:bi.style.opacity=1}t&&Fa();i=qa("score-outer");Ha(ge)!=Ha(be)&&(qa("score-inner").innerText=Ha(ge)),Ha(me)!=Ha(ye)&&(i.style.animationName="pulse",setTimeout(function(t){t.style.animationName=""}.bind(null,i),1e3)),ye=me,be=ge}function Ua(t){var e=za(t.x),n=Ba(t.y),o=t.size*Mt;return e>0-o-It&&e<i+o+It&&n>0-o-It&&n<a+o+It}function $a(t,e){return t*(e+1)}function Ia(){for(var t=0;t<dt.length;t++)dt[t].mouse&&(dt[t].angle=Oa(za(dt[t].x),Ba(dt[t].y),nt,ot)-Math.PI/2)}var Aa=null;function Fa(){if(null!=Yt){if(xi.innerHTML=Ye[Yt.type].name+' <span class="minor">('+oe[Yt.material]+")</span>",Yt.material<ne-1){var t=La(Yt);Ti.innerHTML='<img style="height:22px;position:relative;top:4px;" src="'+le[Yt.material+1]+'"> Upgrade <span class="minor">-'+t+" "+oe[Yt.material+1]+"</span>",t>he[Yt.material+1]||Yt.material==ne-2&&Yt.type==Te.alchemyLab?Ti.disabled=!0:Ti.disabled=!1}else Ti.innerHTML="Fully upgraded",Ti.disabled=!0;Yt.type!=Te.core?(ki.style.display="inline-block",Ti.style.width="calc(50% - 4px)",ki.innerHTML='<img style="height:22px;position:relative;top:4px;" src="'+le[Yt.material]+'"> Destroy <span class="minor">+'+Yt.deleteAmount+" "+oe[Yt.material]+"</span>"):(ki.style.display="none",Ti.style.width="100%"),Ti.disabled?Ti.style.bottom="1px":Ti.style.bottom="0px",clearTimeout(Aa),Aa=null,wi.style.display="block";wi.clientHeight;wi.style.opacity="1",qa("")}else Wa()}function Wa(){Yt=null,wi.style.opacity="0",Aa=setTimeout(function(){wi.style.display="none"},500)}function za(t){return(t-kt)*Mt+i/2}function Ba(t){return(t-Pt)*Mt+a/2}function La(t){return null!=t?Math.floor($a(Ye[t.type].cost,t.material+1)-$a(Ye[t.type].cost,t.material)/4):0}function Ca(){$i.innerHTML=dt.length-1+'<span class="minor">/'+Ni+" units</span>"}Ti.onclick=function(){if(null!=Yt){if(La(Yt)<=he[Yt.material+1]){var t=new ArrayBuffer(mt+yt),e=new DataView(t,0);e.setUint8(0,xe.upgrade,!0),e.setUint16(mt,Yt.id,!0),sn(t)}else Yt.material<ne-1?Da("Gather "+(La(Yt)-he[Yt.material+1])+" more "+oe[Yt.material+1]+" first",Xt):Da("This unit has been upgraded to the limit",Xt);Wa()}},ki.onclick=function(){if(null!=Yt&&Yt.type!=Te.core){var t=new ArrayBuffer(mt+yt),e=new DataView(t,0);e.setUint8(0,xe.delete,!0),e.setUint16(mt,Yt.id,!0),sn(t)}Wa()},Si.onclick=function(){Wa()};var Ra=0;function Da(t,e){si.innerHTML+='<div class="alert" id="m'+Ra+'" style="opacity:0;margin-bottom:-24px;width:100%;"></div>';var i="m"+Ra,a=document.getElementById(i);a.clientHeight;a.innerText=t,a.style.opacity=1,a.style.marginBottom="0px",Ra++;var n=function(t){var e=this.id,i=document.getElementById(e);t?i.innerText=t:(i.style.opacity=0,setTimeout(function(t){document.getElementById(t).remove()}.bind(null,e),500))}.bind({id:i});if(!e)return n;setTimeout(n,e)}function Ha(t){return(t=Math.round(t))>=1e3&&(t=(t/=1e3).toFixed(1),t+="k"),t}function Ea(t){return t>=1e3&&t<1e6?(t/=1e3,t=Math.round(t),t+="KB"):t>=1e6&&t<1e9?(t/=1e6,t=Math.round(t),t+="MB"):t>=1e9&&(t/=1e9,t=Math.round(t),t+="GB"),t}function Na(t){t=Math.round(t/1e3);var e,i=Math.floor(t/3600),a=Math.floor((t-3600*i)/60),n=t-3600*i-60*a,o=[];return i>0&&(e=" hour",1!=i&&(e+="s"),o.push(i+e)),a>0&&(e=" minute",1!=a&&(e+="s"),o.push(a+e)),e=" second",1!=n&&(e+="s"),o.push(n+e),1==o.length?o[0]:2==o.length?o[0]+" and "+o[1]:3==o.length?o[0]+", "+o[1]+" and "+o[2]:void 0}function Oa(t,e,i,a){return Math.atan2(a-e,i-t)}function _a(t,e,i,a){return{x:Math.cos(i)*a+t,y:Math.sin(i)*a+e}}function Ya(t,e,i,a){return Math.sqrt((t-i)*(t-i)+(e-a)*(e-a))}function ja(t,e,i,a){var n=(Math.abs(i-t)>=Math.abs(i-e)?i-t:i-e)*a;return e==i||e<i&&e+n>i||e>i&&e+n<i?i:e+n}function Xa(t,e,i){return t*(1-i)+e*i}function Va(t,e){var i=parseInt(t.slice(1),16),a=e<0?0:255,n=e<0?-1*e:e,o=i>>16,l=i>>8&255,s=255&i;return"#"+(16777216+65536*(Math.round((a-o)*n)+o)+256*(Math.round((a-l)*n)+l)+(Math.round((a-s)*n)+s)).toString(16).slice(1)}function qa(t){return document.getElementById(t)}function Ga(t){return profanityFilter.clean(t)}function Ja(){localStorage.data=JSON.stringify(Pe)}print=Da,localStorage.data?Pe=JSON.parse(localStorage.data):Ja(),Ge.value=Pe.name,mobile||Ge.focus();var Ka=function(){var t=btoa(unescape(encodeURIComponent(Ge.value))).substr(0,22);try{Ge.value=decodeURIComponent(escape(atob(t)))}catch(t){console.log("Error: "+t),Ge.value=Ge.value.substr(0,22)}};if(Ge.oninput=Ka,Ge.onpaste=Ka,Ge.onkeydown=function(t){"Enter"==t.key&&ma()},Ke){function Qa(t,e,i){var a=Pe.socialButtons.indexOf(t);e?-1==a&&Pe.socialButtons.push(t):-1!=a&&Pe.socialButtons.splice(a,1),Pe.socialTotal=Pe.socialButtons.length*Oe,Ja(),0!=i&&Za()}function Za(){Pe.socialTotal>0&&Pe.socialTotal<Ne*Oe?Wi.innerHTML="Increase your bonus by clicking other social media buttons":Pe.socialTotal>=Ne*Oe?Wi.innerHTML="Thanks for your support!":Pe.socialTotal<=0&&(Wi.innerHTML="Start with extra resources by supporting us on social media"),Pe.socialTotal>0&&(Bi.style.display="block",Li.style.width=Pe.socialTotal/(Ne*Oe)*100+"%",Li.innerText="+"+Pe.socialTotal),Wi.onclick=null}function tn(t){setTimeout(function(){Wi.innerHTML='<a href="#">Click to redeem</a>',Wi.onclick=function(){Wi.onclick=null,Qa(t,!0,!0)}.bind(null,t)},3e3)}function en(){"undefined"!=typeof FB&&(FB.Event.subscribe("edge.create",function(){Qa("facebook-like",!0,!0)}),FB.Event.subscribe("edge.remove",function(){Qa("facebook-like",!1,!0)})),"undefined"!=typeof twttr&&(twttr.events.bind("tweet",function(){tn("twitter-tweet")}),twttr.events.bind("follow",function(){tn("twitter-follow")}))}"undefined"==typeof FB||"undefined"==typeof twttr?window.addEventListener("load",function(){en()}):en(),zi.onclick=function(){Qa("discord-join",!0,!0)};var an=!1,nn=qa("___ytsubscribe_0");null!=nn&&(nn.onmouseenter=function(){an=!0},nn.onmouseleave=function(){an=!1});var on=!1,ln=document.getElementsByClassName("fb-share-button")[0];ln.onmouseenter=function(){on=!0},ln.onmouseleave=function(){on=!1},Za()}function sn(t){null!=io&&1==io.readyState&&io.send(t)}window.onbeforeunload=function(){if(null!=io&&(io.onclose=function(){},io.close()),Ke&&an&&Qa("youtube-subscribe",!0,!1),Q&&"app"!=parse_query_string(window.location.search.substring(1)).source)return"Are you sure that you want to exit? You will lose your current progress in the game"},window.onblur=function(){Ke&&on&&tn("facebook-share");for(var t=0;t<tt.length;t++)da(tt[t],0)},document.onmouseout=function(){da(1,0)},rn=t,console.log("Setting up the network for "+rn),window.WebSocket=window.WebSocket||window.MozWebSocket,null==io||io.readyState>2?(io=new WebSocket(rn),io.binaryType="arraybuffer"):null!=io&&io.close(),io.onopen=function(){console.log("Connected!"),o=!0;var t=new ArrayBuffer(mt);new DataView(t,0).setUint8(0,xe.ready,!0),sn(t)},io.onclose=Ji,io.onmessage=function(t){try{var i=t.data,a=new DataView(t.data),n=a.getUint8(0,!0),o=mt;switch(c+=i.byteLength,h+=i.byteLength,n){case Se.update:null!=Gi&&(Ei=Xa(Ei,Date.now()-Gi,.1)),Gi=Date.now();var u=[],p=[],f=[],d=a.getUint16(o,!0);o+=yt;var m=a.getUint16(o,!0);o+=yt;var b=a.getUint16(o,!0);o+=yt;var T=a.getUint16(o,!0);o+=yt,"br"==e&&(w=a.getFloat32(o,!0)*vt,o+=bt,x=a.getFloat32(o,!0)*vt,o+=bt);for(var k=0;k<d;k++){var P=a.getUint16(o,!0);o+=yt;var M=a.getFloat32(o,!0);o+=bt;var U=a.getFloat32(o,!0);o+=bt;var $=a.getFloat32(o,!0);o+=bt;var I=a.getFloat32(o,!0);o+=bt;var A=a.getUint8(o,!0);o+=mt;var F=a.getUint8(o,!0);o+=mt;var W=a.getUint16(o,!0);o+=yt,(B=a.getFloat32(o,!0))<0&&(B=0),o+=bt;var z=a.getFloat32(o,!0);o+=bt,u.push(P),Object.keys(ht).indexOf(String(P))>-1?(ht[P].$ox=ht[P].$x,ht[P].$oy=ht[P].$y,ht[P].$x=M*vt,ht[P].$y=U*vt,!y&&ht[P].owner==K&&ht[P].mouse||(ht[P].$angle=I),ht[P].$orotation=ht[P].$rotation,ht[P].$rotation=z,ht[P].material!=F&&(ht[P].deleteAmount=Math.floor($a(Ye[ht[P].type].cost,F)/2)),ht[P].material=F,ht[P].$hp=B,ht[P].owner==K&&ht[P].type==Te.core&&(wt=ht[P]),ht[P].dying=!1,ht[P].alpha=1,ht[P].scale=1):(ht[P]=new Xi(P,M*vt,U*vt,$*vt,F,A,W,I,z,B),ht[P].owner==K&&(dt.push(ht[P]),Pe.tutorialStage==Me.gotUnit&&ht[P].type!=Te.core&&($e=!0,Da("Awesome! You can now gather more resources to build your tank",Xt),setTimeout(function(){var t="click";mobile&&(t="tap"),Da("Also, you can "+t+" one of your units to upgrade or destroy it",Xt),setTimeout(function(){Da("Protect your core: if it gets destroyed, your whole tank will get demolished",Xt),setTimeout(function(){Da("Good luck!",Xt)},Ue)},Xt+Ue)},Ue),Pe.tutorialStage++,Ja())),Ca())}for(k=0;k<m;k++){var B;P=a.getUint16(o,!0),o+=yt,p.push(P),M=a.getFloat32(o,!0),o+=bt,-1!=M?(U=a.getFloat32(o,!0),o+=bt,$=a.getFloat32(o,!0),o+=bt,z=a.getFloat32(o,!0),o+=bt,F=a.getUint8(o,!0),o+=mt,(B=a.getFloat32(o,!0))<0&&(B=0),o+=bt,Object.keys(ut).indexOf(String(P))>-1?(ut[P].$ox=ut[P].$x,ut[P].$oy=ut[P].$y,ut[P].$x=M*vt,ut[P].$y=U*vt,ut[P].$orotation=ut[P].$rotation,ut[P].$rotation=z,ut[P].$hp=B,ut[P].dying=!1,ut[P].alpha=1,ut[P].scale=1):ut[P]=new Vi(P,M*vt,U*vt,$*vt,F,z,B),ut[P].active=!0):Ua(ut[P])?ut[P].dying=!0:delete ut[P]}for(k=0;k<b;k++)P=a.getUint16(o,!0),o+=yt,M=a.getFloat32(o,!0),o+=bt,U=a.getFloat32(o,!0),o+=bt,$=a.getFloat32(o,!0),o+=bt,F=a.getUint8(o,!0),o+=mt,f.push(P),Object.keys(pt).indexOf(String(P))>-1?(pt[P].$ox=pt[P].$x,pt[P].$oy=pt[P].$y,pt[P].$x=M*vt,pt[P].$y=U*vt,pt[P].dying=!1,pt[P].firstFrame=!1,pt[P].alpha=1,pt[P].scale=1):pt[P]=new qi(P,M*vt,U*vt,$*vt,F);for(k=0;k<T;k++){P=a.getUint16(o,!0),o+=yt;var L=a.getUint32(o,!0);o+=gt;var C=a.getUint8(o,!0);o+=mt;for(var R=[],D=0;D<C;D++)R.push(a.getInt8(o,!0)),o+=mt;var H=Rt;try{var E=String.fromCharCode.apply(null,R);H=decodeURIComponent(escape(atob(E)))}catch(t){}Object.keys(ft).indexOf(String(P))<0?ft[P]=new Yi(H,L):ft[P].$score=L}for(P in ht)if(u.indexOf(Number(P))<0)if(ht[P].owner==K&&Ca(),Ua(ht[P]))ht[P].dying=!0;else{var N=dt.indexOf(ht[P]);N>-1&&dt.splice(N,1),delete ht[P]}for(P in ut)p.indexOf(Number(P))<0&&(ut[P].active=!1);for(P in pt)f.indexOf(Number(P))<0&&(Ua(pt[P])?pt[P].dying=!0:delete pt[P]);break;case Se.joined:setTimeout(function(){actuallyHasPlayed=!0,removeBanner(),prepareInterstitial(),J=!0,Ee=Date.now(),Ma(),Gi=null,$t=.5,Pe.first=!1,Ja(),l.style.opacity=1,ga(!0),Pe.tutorialStage==Me.wasd&&(setTimeout(function(){mobile?Da("Touch the left side of the screen, and move to control your tank",Xt):Da("WASD or arrow keys to move",Xt)},Ue),Pe.tutorialStage++,Ja())},Hi);break;case Se.info:for(vt=a.getFloat32(o+bt+bt,!0),qt=Vt*vt,s.lineWidth=qt*Mt,w=a.getFloat32(o,!0)*vt,o+=bt,x=a.getFloat32(o,!0)*vt,kt=(g=w)/2,Pt=(v=x)/2,o+=bt+bt,K=a.getUint16(o,!0),o+=yt,Hi=a.getFloat32(o,!0),Ei=Hi,o+=bt,Ni=a.getUint32(o,!0),o+=gt,Oi=a.getFloat32(o,!0),o+=bt,_i=a.getUint8(o,!0),o+=mt,k=0;k<Ye.length;k++)Ye[k].cost=a.getInt32(o,!0),o+=gt;!function(){_e=[];for(var t=0;t<Ye.length;t++)_e[t]=t;_e.sort(function(t,e){return Ye[t].cost-Ye[e].cost})}(),ft[K]=new Yi(Ge.value,0),function(){Mi.width=Zt+ae,Mi.height=Zt+ae,Ui.lineWidth=qt*(Zt/(Ye[Te.basicUnit].size*vt*2)),Ui.lineCap="round",Ui.lineJoin="round",ui.innerHTML="";var t=Mt;Mt=1;for(var e=0;e<ne-1;e++)for(var i=0;i<_e.length;i++)if(_e[i]!=Te.core&&_e[i]!=Te.boosterUnit){var a="u:"+_e[i]+";"+e;Ui.clearRect(0,0,Mi.width,Mi.height),Ye[_e[i]].bottom(Ui,Mi.width/2,Mi.height/2,Zt/2,.75*Math.PI,0,e),Ye[_e[i]].top(Ui,Mi.width/2,Mi.height/2,Zt/2,.75*Math.PI,0,e);var n=Mi.toDataURL("image/png",1);ui.innerHTML+='<div id="'+a+'" class="item"><div class="item-inner"><img src="'+n+'" class="store-image" draggable="false" width="'+(Qt+ae)+'px"><br>'+Ye[_e[i]].name+'<br><img style="height:18px;position:relative;top:2px;" src="'+le[e]+'"> '+$a(Ye[_e[i]].cost,e)+' <span class="minor">'+oe[e]+"</span></div></div>"}Mt=t;for(var o=document.getElementsByClassName("item"),e=0;e<o.length;e++)o[e].onclick=ka,mobile||(o[e].onmouseenter=Pa),o[e].children[0].children[0].draggable=!1,o[e].ondragstart=ka}(),console.log("Showing menu"),je.style.opacity="0",setTimeout(function(){je.style.visibility="hidden"},1500),ba(),Gi=null;break;case Se.stash:var O=a.getUint8(o);for(O&&(O=!$e,$e=!1),o+=mt,k=0;k<ne;k++){var _=he[k];if(he[k]=a.getInt32(o+gt*k,!0),he[k]!=_){if(O){var Y=he[k]-_;Da(Y<0?Ha(Y)+" "+oe[k]:"+"+Ha(Y)+" "+oe[k],jt)}Pe.tutorialStage==Me.saveUp&&(Da("Well done! Next, save up some Wood",Xt),setTimeout(function(){Da("Soon, you'll be able to start building units",Xt),$e=!0},Ue),Pe.tutorialStage++,Ja())}}me=a.getInt32(o+gt*k,!0),function(){for(var t=0;t<ne;t++)for(var i=0;i<Ye.length;i++)if(i!=Te.core&&i!=Te.boosterUnit){var a=qa("u:"+i+";"+t).getElementsByClassName("item-inner")[0].getElementsByClassName("store-image")[0];("ffa"==e||ve<=0)&&$a(Ye[i].cost,t)<=he[t]?(a.style.opacity=1,Pe.tutorialStage==Me.firstUnit&&(Da("Nice! You can now build your first unit",Xt),setTimeout(function(){mobile?Da("Tap on the icon in the store, and use your target to place it",Xt):Da("Click on the icon in the store, and click again where you want to place it",Xt)},Ue),Pe.tutorialStage++,Ja())):a.style.opacity=.4}}();break;case Se.scale:Ut=a.getFloat32(o,!0);case Se.leaderboard:var j="<table>",X=a.getInt32(o,!0);o+=gt;var V=yt+gt+mt;for(mobile&&X>S&&(X=S),k=0;k<X;k++){for(P=a.getUint16(o,!0),L=a.getInt32(o+yt,!0),C=a.getUint8(o+yt+gt,!0),R=[],D=0;D<C;D++)R.push(a.getInt8(o+yt+gt+mt+D,!0));H=Rt;try{E=String.fromCharCode.apply(null,R),H=decodeURIComponent(escape(atob(E)))}catch(t){}""==H&&(H=Rt),o+=V+C,j+="<tr",P==K&&(j+=' class="me"'),j+='><td class="left"><div class="truncate">'+(k+1)+". "+Ga(H)+'</div></td><td class="right">'+Ha(L)+"</td></tr>"}j+="</table>",Pi.innerHTML=j,Pi.style.opacity="1";break;case Se.die:for(showInterstitial(),createBanner(),r||"app"==parse_query_string(window.location.search.substring(1)).source||aiptag.cmd.display.push(function(){aipDisplayTag.refresh("tanksmith-io_300x250")}),C=a.getUint8(o,!0),o+=mt,R=[],D=0;D<C;D++)R.push(a.getInt8(o,!0)),o++;H=Rt;try{E=String.fromCharCode.apply(null,R),H=decodeURIComponent(escape(atob(E)))}catch(t){}""==H&&(H=Rt);var q="players";1==Z&&(q="player"),Ci.innerHTML="<h3>Destroyed by "+H+'</h3><span class="minor">You achieved a </span>score of '+Ha(me)+'<span class="minor"> and </span>destroyed '+Z+" "+q+' <span class="minor">in </span>'+Na(Date.now()-Ee)+'<span class="minor">.</span>',mobile||(Ci.innerHTML+=' <a class="twitter-share-button" href="https://twitter.com/intent/tweet?original_referer=http%3A%2F%2Ftanksmith.io%2F&ref_src=twsrc%5Etfw&text=I%20played%20Tanksmith.io:%20achieved%20a%20score%20of%20'+Ha(me)+"%20and%20destroyed%20"+Z+"%20"+q+"%20in%20"+Na(Date.now()-Ee)+'%20%23tanksmithio%20%23ioninja%20%23iogames%20via%20%40ioninja14">Tweet</a> this.');var G=[];for(k=0;k<he.length;k++)if(he[k]>0){var Q=0,tt=Math.floor(Pe.socialButtons.length*Oe/Math.pow(2,k));(Q=he[k]<=tt?tt:Math.floor((he[k]-tt)/2)+tt)>0&&G.push(Ha(Q)+'&nbsp;<span class="minor">'+oe[k]+"</span>")}if(0==G.length)Je.style.display="none";else{Je.style.display="block";var et='<span class="minor">Respawn with</span> ';if(1==G.length)et+=G[0];else if(2==G.length)et+=G.join(' <span class="minor">and</span> ');else{var it=G.splice(G.length-1,1);et+=G.join('<span class="minor">, </span>'),et+=' <span class="minor">and</span> '+it}Je.innerHTML=et}ya(),ba();break;case Se.shake:break;case Se.kill:for(C=a.getUint8(o,!0),o+=mt,R=[],D=0;D<C;D++)R.push(a.getInt8(o+D,!0));H=Rt;try{E=String.fromCharCode.apply(null,R),H=decodeURIComponent(escape(atob(E)))}catch(t){}""==H&&(H=Rt),Z++,Da("You destroyed "+H,jt);break;case Se.resize:w=a.getFloat32(o,!0)*vt,x=a.getFloat32(o+bt,!0)*vt;break;case Se.brState:ve=a.getInt32(o,!0),function(){if(ve<=0)null!=we&&we(),Da("The battle has started",Xt),setTimeout(function(){Da("Stay in the safe zone, be the last tank standing, win the battle",Xt)},Ue);else{var t="Waiting for "+ve+" more player";1!=ve&&(t+="s"),null!=we?we(t):we=Da(t)}}();break;case Se.brRank:var at=a.getInt32(o,!0);console.log("Rank: "+at),je.innerHTML=1==at?"Victory royale!":"Rank #"+at}}catch(t){}}}catch(t){setTimeout(function(){null!=io&&io.close(),"undefined"!=typeof Raven&&Raven.captureException(t),window.location.reload(!0)},1e3)}var rn};ready();