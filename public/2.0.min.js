io=null;var go=function(t){try{var e,i,o=!0,n=!1,a=document.getElementById("canvas"),l=a.getContext("2d"),s="localhost"==window.location.hostname,r=0,c=0,h=0,d=0,y=!1,m=22,g=0,v=0,w=0,x=0;if(mobile){var T=5;Lt=window.devicePixelRatio||1;var k=!1,S=0,P=0,M=S,U=P,$={x:S,y:P},A=0,I=0,F=0,W=0,L=0,z=60*mobileScale,B=0,D=!1,C=0,R=0,H=0,E=0,N=0,O=0,Y=0,j=0,X=20*mobileScale,V=1.5,_=0}for(var q=100,G=3,J=!1,K=null,Q=!1,Z=0,tt=[87,38,65,37,83,40,68,39,1,2],et={},it=!1,ot=!1,nt=0,at=0,lt=0,st=0,rt=nt,ct=at,ht={},ut={},pt={},ft={},dt=[],yt=1,mt=2,gt=4,bt=4,vt=1,wt=null,xt=0,Tt=0,kt=0,St=g/2,Pt=v/2,Mt=1,Ut=1,$t=Ut,At=50,It=1040,Ft=590,Wt=It/Ft,Lt=1,zt=15,Bt=.1,Dt=4,Ct="Unknown",Rt=!1,Ht=0,Et=0,Nt=0,Ot=0,Yt=!1,jt=null,Xt=4e3,Vt=8e3,_t=.13,qt=_t*vt,Gt=-.3,Jt=20,Kt=.5,Qt=70,Zt=Qt,te=0,ee=0,ie=!1,oe=15,ne=6,ae=["Wood","Iron","Gold","Diamond","Amethyst","Onyx"],le=[],se=22,re=se,ce=4,he=[],ue=[],pe=[],fe=[],de=0;de<ne;de++)he[de]=0,ue[de]=0,pe[de]=0,fe[de]=0;var ye=0,me=0,ge=0,be=0;try{1==performance.navigation.type&&1}catch(t){}var ve={ready:1,key:2,play:3,mouse:4,build:5,upgrade:6,delete:7,move:8},we={update:1,joined:2,info:3,stash:4,scale:5,leaderboard:6,die:7,kick:8,shake:9,kill:10,resize:11},xe={core:0,basicUnit:1,basicTurret:2,sniperTurret:3,twinTurret:4,cannonTurret:5,healingUnit:6,alchemyLab:7,boosterUnit:8,octaTurret:9,spike:10},Te={circle:0,triangle:1},ke={name:"",tutorialStage:0,socialTotal:0,socialButtons:[]},Se={wasd:0,click:1,shapes:2,saveUp:3,firstUnit:4,gotUnit:5},Pe=2e3,Me=!1,Ue=["#790000","#888888","#efc000","#1bebff","#9400c0","#333333","#ff0000"],$e="#bfbfbf",Ae="#fa0028",Ie="#73eeff",Fe=$e,We=40,Le=2,ze="#595959",Be="#05d400",De="#ffffff",Ce="#111111",Re=0,He=6,Ee=3,Ne=[],Oe=[{name:"Core",cost:0,size:1.2,mouse:!0,buildable:!0,shape:Te.circle,description:"",top:function(t,e,i,o,n,a,l){Oe[xe.basicTurret].top(t,e,i,o,n,a,l)},bottom:function(t,e,i,o,n,a,l){Oe[xe.basicUnit].bottom(t,e,i,o,n,a,l)}},{name:"Basic Unit",cost:0,size:1,mouse:!1,buildable:!0,shape:Te.circle,description:"A simple unit which can protect your core",top:function(t,e,i,o,n,a,l){},bottom:function(t,e,i,o,n,a,l){t.fillStyle=Ue[l],t.strokeStyle=_o(Ue[l],Gt),t.beginPath(),t.arc(e,i,o-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()}},{name:"Basic Turret",cost:0,size:1,mouse:!0,buildable:!0,shape:Te.circle,description:"A regular turret with a single gun",top:function(t,e,i,o,n,a,l){var s=.6*o;t.beginPath(),t.fillStyle=$e,t.strokeStyle=_o($e,Gt),t.save(),t.translate(e,i),t.rotate(n),t.fillRect(-s/2,0,s,2*s),t.strokeRect(-s/2,0,s,2*s),t.restore(),t.arc(e,i,o/2-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},bottom:function(t,e,i,o,n,a,l){Oe[xe.basicUnit].bottom(t,e,i,o,n,a,l)}},{name:"Sniper Turret",cost:0,size:1,mouse:!0,buildable:!0,shape:Te.circle,description:"A long-range gunner which shoots fast projectiles",top:function(t,e,i,o,n,a,l){var s=.4*o,r=3.5*s;t.beginPath(),t.fillStyle=$e,t.strokeStyle=_o($e,Gt),t.save(),t.translate(e,i),t.rotate(n),t.fillRect(-s/2,0,s,r),t.strokeRect(-s/2,0,s,r),t.restore(),t.arc(e,i,o/2-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},bottom:function(t,e,i,o,n,a,l){Oe[xe.basicUnit].bottom(t,e,i,o,n,a,l)}},{name:"Twin Turret",cost:0,size:1,mouse:!0,buildable:!0,shape:Te.circle,description:"A turret with two guns, which fire small bullets",top:function(t,e,i,o,n,a,l){var s=o/2-t.lineWidth,r=.6*o*2;t.beginPath(),t.fillStyle=$e,t.strokeStyle=_o($e,Gt),t.save(),t.translate(e,i),t.rotate(n),t.fillRect(-s,0,s,r),t.strokeRect(-s,0,s,r),t.fillRect(0,0,s,r),t.strokeRect(0,0,s,r),t.restore(),t.arc(e,i,o/2-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},bottom:function(t,e,i,o,n,a,l){Oe[xe.basicUnit].bottom(t,e,i,o,n,a,l)}},{name:"Cannon Turret",cost:0,size:1,mouse:!0,buildable:!0,shape:Te.circle,description:"A slow, but powerful gun capable of dealing hefty damage",top:function(t,e,i,o,n,a,l){var s=.6*o*1.4,r=.6*o*2;t.beginPath(),t.fillStyle=$e,t.strokeStyle=_o($e,Gt),t.save(),t.translate(e,i),t.rotate(n),t.fillRect(-s/2,0,s,r),t.strokeRect(-s/2,0,s,r),t.restore(),t.arc(e,i,o/2-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},bottom:function(t,e,i,o,n,a,l){Oe[xe.basicUnit].bottom(t,e,i,o,n,a,l)}},{name:"Healing Unit",cost:0,size:1,mouse:!1,buildable:!0,shape:Te.circle,description:"A support unit which heals connected units over time",top:function(t,e,i,o,n,a,l){},bottom:function(t,e,i,o,n,a,l){Oe[xe.basicUnit].bottom(t,e,i,o,n,a,l);var s=o-.35*o,r=.7*s/2;t.fillStyle=Ae,t.strokeStyle=_o(Ae,Gt),t.beginPath(),t.save(),t.translate(e,i),t.rotate(a),t.moveTo(-r,-s),t.lineTo(r,-s),t.lineTo(r,-r),t.lineTo(s,-r),t.lineTo(s,r),t.lineTo(r,r),t.lineTo(r,s),t.lineTo(-r,s),t.lineTo(-r,r),t.lineTo(-s,r),t.lineTo(-s,-r),t.lineTo(-r,-r),t.lineTo(-r,-s),t.restore(),t.closePath(),t.fill(),t.stroke()}},{name:"Alchemy Lab",cost:0,size:1,mouse:!1,buildable:!0,shape:Te.circle,description:"An experimental unit which converts one resource to another",top:function(t,e,i,o,n,a,l){},bottom:function(t,e,i,o,n,a,l){Oe[xe.basicUnit].bottom(t,e,i,o,n,a,l),t.fillStyle=Ie,t.strokeStyle=_o(Ie,Gt),t.save(),t.translate(e,i),t.rotate(a);for(var s=0;s<3;s++){t.beginPath();var r=Yo(0,0,2*Math.PI/3*s,.45*o);t.arc(r.x,r.y,o/3-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()}t.restore()}},{name:"Booster Unit",cost:0,size:1,mouse:!1,buildable:!0,shape:Te.circle,description:"A unit which increases your overall speed",top:function(t,e,i,o,n,a,l){},bottom:function(t,e,i,o,n,a,l){Oe[xe.basicUnit].bottom(t,e,i,o,n,a,l);var s=.8*o;t.fillStyle=Fe,t.strokeStyle=_o(Fe,Gt),t.save(),t.translate(e,i),t.rotate(n+a),t.beginPath(),t.arc(0,0,s/3-t.lineWidth/2,0,2*Math.PI),t.moveTo(s-t.lineWidth/2,0);for(var r=2*Math.PI/10,c=0;c<10;c++){var h=0;c%2!=0&&(h=.2*o),t.arc(0,0,s-t.lineWidth/2-h,r*c,r*(c+1))}Yo(0,0,r,s-t.lineWidth/2-h);t.lineTo(s-t.lineWidth/2,0),t.fill(),t.stroke(),t.closePath(),t.fillStyle=Ue[l],t.beginPath(),t.arc(0,0,s/3-t.lineWidth,0,2*Math.PI),t.fill(),t.closePath(),t.restore()}},{name:"Octa Turret",cost:0,size:1,mouse:!0,buildable:!0,shape:Te.circle,description:"A turret with eight guns, that fire slowly but in every direction",top:function(t,e,i,o,n,a,l){var s=.6*o;t.beginPath(),t.fillStyle=$e,t.strokeStyle=_o($e,Gt);for(var r=0;r<8;r++)t.save(),t.translate(e,i),t.rotate(n+2*Math.PI/8*r),t.fillRect(-s/4,0,s/2,2*s),t.strokeRect(-s/4,0,s/2,2*s),t.restore();t.arc(e,i,o/2-t.lineWidth/2,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},bottom:function(t,e,i,o,n,a,l){Oe[xe.basicUnit].bottom(t,e,i,o,n,a,l)}},{name:"Spike",cost:0,size:.5,mouse:!1,buildable:!1,shape:Te.triangle,description:"A small appendage which deals significant collision damage",top:function(){},bottom:function(t,e,i,o,n,a,l){o/=2,t.fillStyle=Ue[l],t.strokeStyle=_o(Ue[l],Gt),t.save(),t.translate(e,i),t.rotate(a),t.beginPath(),t.moveTo(0,-o*Mt+qt*Mt/2),t.lineTo(-o*Mt+qt*Mt/2,o*Mt-qt*Mt/2),t.lineTo(o*Mt-qt*Mt/2,o*Mt-qt*Mt/2),t.lineTo(0,-o*Mt+qt*Mt/2),t.closePath(),t.fill(),t.stroke(),t.restore()}}],Ye=qo("loading"),je=qo("menu"),Xe=qo("middle-container"),Ve=(qo("overlay"),qo("main"),qo("title"),qo("play")),_e=qo("name"),qe=qo("respawn-info"),Ge=qo("social"),Je=qo("count"),Ke=qo("version"),Qe=qo("links"),Ze=qo("party"),ti=qo("help"),ei=qo("help-inner"),ii=(qo("ad"),qo("hud")),oi=qo("tip"),ni=qo("alerts"),ai=qo("store-toggle"),li=qo("toggle-arrow-wrapper"),si=qo("store"),ri=qo("store-scroll"),ci=qo("stash"),hi=qo("arrow-left"),ui=qo("arrow-right"),pi=qo("arrow-left-wrapper"),fi=qo("arrow-right-wrapper"),di=qo("stash-main"),yi=qo("stash-special"),mi=qo("score"),gi=qo("options"),bi=qo("options-heading"),vi=qo("options-close"),wi=qo("upgrade-button"),xi=qo("destroy-button"),Ti=qo("leaderboard"),ki=qo("scanner"),Si=ki.getContext("2d"),Pi=qo("units"),Mi=qo("minimap");Mi.width=q,Mi.height=q;var Ui=Mi.getContext("2d"),$i=qo("tutorial-mobile"),Ai=qo("share-message"),Ii=qo("discord"),Fi=qo("share-progress-outer"),Wi=qo("share-progress-inner"),Li=qo("death"),zi=function(){Lt=window.devicePixelRatio||1,a.style.width=window.innerWidth+"px",a.style.height=window.innerHeight+"px",a.width=window.innerWidth*Lt,a.height=window.innerHeight*Lt,l.scale(Lt,Lt),Zt=Qt*Lt,re=se*Lt,e=window.innerWidth,i=window.innerHeight,Bi(),l.lineCap="round",l.lineJoin="round",l.lineWidth=qt*Mt};ii.children;function Bi(){Mt=e/i>=Wt?e/It:i/Ft,Mt*=$t}window.onresize=zi,zi();Date.now();var Di=50,Ci=Di,Ri=1/0,Hi=0,Ei=1,Ni=function(t,e){this.name=Go(t),this.$score=e,this.score=e};Ni.prototype.update=function(){this.score=Vo(this.score,this.$score,.1)};var Oi=function(t,e,i,o,n){this.id=t,this.$x=e,this.$ox=e,this.x=e,this.$y=i,this.$oy=i,this.y=i,this.size=o,this.material=n,this.dying=!1,this.alpha=1,this.scale=1};Oi.prototype.objUpdate=function(t){this.dying?(this.alpha-=.1,this.scale+=.2,this.x-=(this.$ox-this.$x)*t,this.y-=(this.$oy-this.$y)*t):(this.x=Xo(this.$ox,this.x,this.$x,t),this.y=Xo(this.$oy,this.y,this.$y,t))},Oi.prototype.renderHealthBar=function(){var t=0;this.hp<1&&(t=1),this.hpAlpha=Vo(this.hpAlpha,t,.2),this.hpAlpha>.01&&function(t,e,i,o){o<1&&(l.globalAlpha=o);l.lineWidth=(qt+Le)*Mt,l.beginPath(),l.strokeStyle=ze,l.moveTo(t-We*Mt/2,e),l.lineTo(t+We*Mt/2,e),l.stroke(),l.closePath(),l.beginPath(),l.lineWidth=qt*Mt,l.strokeStyle=Be,l.moveTo(t-We*Mt/2,e),i*=2,i-=1,i*=We*Mt/2,l.lineTo(t+i,e),l.stroke(),l.closePath(),o<1&&(l.globalAlpha=1)}(Lo(this.x),zo(this.y)+(this.size+12)*Mt,this.hp,this.alpha*this.hpAlpha)};var Yi=function(t,e,i,o,n,a,l,s,r,c){Oi.call(this,t,e,i,o,n),this.type=a,this.owner=l,this.$angle=s,this.angle=s,this.$orotation=r,this.$rotation=r,this.rotation=r,this.$hp=c,this.hp=c,this.hpAlpha=0,this.mouse=Oe[this.type].mouse,this.buildable=Oe[this.type].buildable,this.deleteAmount=Math.floor($o(Oe[this.type].cost,this.material)/2)};Yi.prototype=new Oi,Yi.prototype.update=function(t){!y&&this.owner==K&&this.mouse||(Math.abs(this.$angle-this.angle)>Math.PI&&(this.$angle>this.angle?this.angle+=2*Math.PI:this.angle-=2*Math.PI),this.angle=Vo(this.angle,this.$angle,t));if(this.rotation=Xo(this.$orotation,this.rotation,this.$rotation,t),this.hp=Vo(this.hp,this.$hp,.1),this.alpha<=0){var e=dt.indexOf(ht[this.id]);e>-1&&dt.splice(e,1),delete ht[this.id]}},Yi.prototype.renderBottom=function(){this.alpha<1&&(l.globalAlpha=this.alpha),Oe[this.type].bottom(l,Lo(this.x),zo(this.y),this.size*this.scale*Mt,this.angle,this.rotation,this.material),this.alpha<1&&(l.globalAlpha=1)},Yi.prototype.renderTop=function(){this.alpha<1&&(l.globalAlpha=this.alpha),Oe[this.type].top(l,Lo(this.x),zo(this.y),this.size*this.scale*Mt,this.angle,this.rotation,this.material),this.alpha<1&&(l.globalAlpha=1),s&&(l.fillStyle="#f00",l.beginPath(),l.arc(Lo(this.$x),zo(this.$y),10,0,2*Math.PI),l.fill(),l.closePath())},Yi.prototype.renderName=function(){var t=!0;if(this.owner==K){var e=Date.now()-Re;e<4e3?e>2e3&&(l.globalAlpha=1-(e-2e3)/2e3):t=!1}else this.alpha<1&&(this.alpha>.01?l.globalAlpha=this.alpha:t=!1);if(t&&ft[this.owner]){l.fillStyle=De,l.strokeStyle=Ce,l.lineWidth=2*Mt,l.textAlign="center",l.font="900 "+20*Mt+"px Ubuntu";var i=Lo(this.x),o=zo(this.y)-(this.size+15)*Mt;l.strokeText(ft[this.owner].name,i,o),l.fillText(ft[this.owner].name,i,o),l.font="900 "+10*Mt+"px Ubuntu",o+=10*Mt;var n=Ho(ft[this.owner].score);l.strokeText(n,i,o),l.fillText(n,i,o),l.lineWidth=qt*Mt,l.globalAlpha=1}};var ji=function(t,e,i,o,n,a,l){Oi.call(this,t,e,i,o,n),this.$orotation=a,this.$rotation=a,this.rotation=a,this.$hp=l,this.hp=l,this.hpAlpha=0,this.active=!1};ji.prototype=new Oi,ji.prototype.update=function(t){this.alpha<=0?delete ut[this.id]:this.$x<-w/2||this.$x>w/2||this.$y<-x/2||this.$y>x/2?this.dying=!0:(this.rotation=Xo(this.$orotation,this.rotation,this.$rotation,t),this.active||this.$hp<1&&(this.$hp+=Hi*(zt/Di)*Ei),this.hp=Vo(this.hp,this.$hp,.1))},ji.prototype.render=function(){this.alpha<1&&(l.globalAlpha=this.alpha),l.fillStyle=Ue[this.material],l.strokeStyle=_o(Ue[this.material],Gt),l.save(),l.translate(Lo(this.x),zo(this.y)),l.rotate(this.rotation),l.beginPath(),l.moveTo(0,-this.size*this.scale*Mt+qt*Mt/2),l.lineTo(-this.size*this.scale*Mt+qt*Mt/2,this.size*this.scale*Mt-qt*Mt/2),l.lineTo(this.size*this.scale*Mt-qt*Mt/2,this.size*this.scale*Mt-qt*Mt/2),l.lineTo(0,-this.size*this.scale*Mt+qt*Mt/2),l.closePath(),l.fill(),l.stroke(),l.restore(),s&&(this.active?l.fillStyle="#f00":l.fillStyle="#00f",l.beginPath(),l.arc(Lo(this.$x),zo(this.$y),10,0,2*Math.PI),l.fill(),l.closePath()),this.alpha<1&&(l.globalAlpha=1)};var Xi=function(t,e,i,o,n){Oi.call(this,t,e,i,o,n),this.firstFrame=!0};Xi.prototype=new Oi,Xi.prototype.update=function(){this.alpha<=0&&delete pt[this.id]},Xi.prototype.render=function(){this.alpha<1&&(l.globalAlpha=this.alpha),l.fillStyle=Ue[this.material],l.strokeStyle=_o(Ue[this.material],Gt),l.beginPath(),l.arc(Lo(this.x),zo(this.y),this.size*this.scale*Mt-l.lineWidth/2,0,2*Math.PI),l.closePath(),l.fill(),l.stroke(),s&&(l.fillStyle="#f00",l.beginPath(),l.arc(Lo(this.$x),zo(this.$y),10,0,2*Math.PI),l.fill(),l.closePath()),this.alpha<1&&(l.globalAlpha=1)};var Vi=null;function _i(){console.log("Disconnected!"),qe.style.display="none",a.style.opacity=0,go(!1),Ye.style.visibility="visible",Ye.style.opacity="1",mo(),io=null,n=!1,o=!1,ft={},ht={},pt={},ut={},dt=[],Li.style.display="none",onDisconnect()}var qi=function(t){if(J)if(Rt){if(Rt&&!Yt&&dt.length<=Ri&&$o(Oe[Ht].cost,Et)<=he[Et])if(dt.length<=Ri){it||(Rt=!1);var e=new ArrayBuffer(yt+mt+yt+yt+bt),i=new DataView(e,0);i.setUint8(0,ve.build,!0),i.setUint16(yt,Nt,!0),i.setUint8(yt+mt,Ht,!0),i.setUint8(yt+mt+yt,Et,!0),i.setFloat32(yt+mt+yt+yt,Ot,!0),io.send(e)}else Ro("You have built the maximum number of units",Vt),Ro("Delete existing units with the K key to build more",Vt)}else jt=ko(t.clientX,t.clientY),Fo()},Gi=!1;if(a.onmousedown=function(t){J&&!Rt&&fo(1,1)},a.onmouseup=function(t){fo(1,0)},mobile||(a.onclick=qi),document.addEventListener("mousemove",function(t){nt=t.pageX,at=t.pageY,n&&J&&null!=wt&&!y&&Ao(),Gi&&(oi.style.left=t.clientX,oi.style.top=t.clientY-10)},!0),mobile||(ri.onmouseleave=function(){oi.style.opacity="0",setTimeout(function(){"0"==oi.style.opacity&&(oi.style.display="none",Gi=!1)},200)}),window.oncontextmenu=function(t){},mobile){a.addEventListener("touchstart",function(t){for(var o=0;o<t.changedTouches.length;o++){var n=t.changedTouches[o],a=n.pageX,l=n.pageY;null==ko(a,l)&&(a<e/2?(k=!0,$={x:M=S=a,y:U=P=l}):(D=!0,C=a,R=l,H=0,E=0,N=0,O=0,Y=0,j=0,nt=e/2,at=i/2,Rt||fo(1,1)))}return t.preventDefault(),!1},!1),a.addEventListener("touchmove",function(t){for(var i=0;i<t.changedTouches.length;i++){var o=t.changedTouches[i],n=o.pageX,a=o.pageY;n<e/2?k?(A=Oo(S,P,M=n,U=a),I=jo(S,P,M,U),$=I>z?Yo(S,P,A,z):{x:M,y:U},(L=I/z)>1&&(L=1),ke.tutorialStage==Se.click&&(setTimeout(function(){Ro("Touch the right side of the screen, and move to adjust your target",Vt)},Pe),ke.tutorialStage++,Jo())):(D=!1,fo(1,0)):D?(Y=H,j=E,H=(n-C)*V,E=(a-R)*V):(k=!1,L=0)}return t.preventDefault(),!1},!1);var Ji=function(t){for(var i=0;i<t.changedTouches.length;i++){var o=t.changedTouches[i],n=o.pageX,a=o.pageY;n<e/2?(k=!1,A=0,L=0):(D=!1,fo(1,0))}return qi({clientX:n,clientY:a}),t.preventDefault(),!1};a.addEventListener("touchend",Ji,!1),a.addEventListener("touchcancel",Ji,!1),ri.style.overflowX="scroll",ri.onscroll=function(t){ie||(te=ri.scrollLeft,ee=te),ie=!1},_e.onclick=function(t){return _e.value=prompt("Enter name"),t.preventDefault,!1};try{for(var Ki in document.styleSheets){var Qi=document.styleSheets[Ki];if(Qi.rules)for(var Zi=Qi.rules.length-1;Zi>=0;Zi--)Qi.rules[Zi].selectorText&&Qi.rules[Zi].selectorText.match(":hover")&&Qi.deleteRule(Zi)}}catch(t){}ce*=Lt,Qe.style.display="none",Ze.style.fontSize="25px",Ke.style.fontSize="25px",Je.style.fontSize="25px";var to=qo("apps");"app"==parse_query_string(window.location.search.substring(1)).source?to.style.display="none":(qo("app-android").style.height="54px",to.style.height="54px"),Xe.style.transform="translate(-50%, -50%) scale("+mobileScale+")",to.style.transform="scale("+mobileScale+")",to.style.margin=8*mobileScale+"px",to.style.bottom=92*mobileScale+8*mobileScale+"px",Ze.style.transform="scale("+mobileScale+")",Ze.style.margin=8*mobileScale+"px",Ze.style.bottom=8*mobileScale+"px",Je.style.transform="scale("+mobileScale+")",Je.style.margin=8*mobileScale+"px",Ke.style.transform="scale("+mobileScale+")",Ke.style.margin=8*mobileScale+"px",si.style.width="584px",si.style.transform="translateX(-50%) scale("+mobileScale+")",si.style.margin=8*mobileScale+"px",ri.style.width="504px",ai.style.transform="translateX(-100%) scale("+mobileScale+")",ai.style.margin=8*mobileScale+"px",ai.style.left="calc(50% - "+292*mobileScale+"px - "+8*mobileScale+"px)",ci.style.transform="scale("+mobileScale+")",ci.style.margin=8*mobileScale+"px",di.style.margin="0px",yi.style.margin="0px",yi.style.marginBottom="8px",Pi.style.transform="scale("+mobileScale+")",Pi.style.margin=8*mobileScale+"px",Ti.style.transform="scale("+mobileScale+")",Ti.style.margin=8*mobileScale+"px",mi.style.transform="scale("+mobileScale+")",mi.style.margin=8*mobileScale+"px",ni.style.transform="translateX(-50%) scale("+mobileScale+")",ni.style.bottom=156*mobileScale+"px",gi.style.top=8*mobileScale+"px",gi.style.transform="translateX(-50%) scale("+mobileScale+")",ti.style.position="fixed",ti.style.left="50%",ti.style.top="-200%",ti.style.transform="translate(-50%, -50%) scale("+1.5*mobileScale+")",qo("help-inner").innerHTML='Touch the left side of the screen, and move <span class="minor">to control your tank</span><br>Touch the right side of the screen, and move <span class="minor">to aim</span><br>Protect your core <span class="minor">to stay alive</span><br>Destroy shapes <span class="minor">to collect resources</span><br>Select a unit from the store <span class="minor">and tap to place it</span><br>Collect better resources <span class="minor">to build better units</span><br>Tap a unit in your tank <span class="minor">to upgrade or destroy it</span><br>Assemble your tank <span class="minor">to become powerful</span><br>Battle other players <span class="minor">and climb the leaderboard</span><div id="close-tutorial" style="width:100%;text-align:right"><a href="#">Close tutorial</a></div>',$i.style.display="block",$i.onclick=function(){ei.scrollTop=0,ti.style.top="50%"},qo("close-tutorial").onclick=function(){ti.style.top="-200%"}}var eo=168;function oo(t){var e=eo;t<0&&(e*=-1),(te+=e)<0&&(te=0);var i=ri.scrollWidth-ri.clientWidth;te>i&&(te=i)}ri.onwheel=function(t){oo(t.deltaY)};var no=!1,ao=!1,lo=250,so=function(){no=!0,oo(-1),setTimeout(uo.bind(null,-1),lo)},ro=function(){ao=!0,oo(1),setTimeout(uo.bind(null,1),lo)},co=function(){no=!1},ho=function(){ao=!1};function uo(t){-1==t?no&&po(t):1==t&&ao&&po(t)}function po(t){oo(t),setTimeout(uo.bind(null,t),lo)}function fo(t,e,i){var o=0;if(null!=et[t]&&(o=et[t]),et[t]=e,17==t)it=e;else if(27==t)Rt=!1;else if(69==t&&0==e)(ot=!ot)?fo(1,1):fo(1,0,1);else if((1!=t||0!=e||!ot)&&n&&tt.indexOf(t)>-1&&(i||e!=o)){ke.tutorialStage==Se.click&&1!=t&&2!=t?(setTimeout(function(){Ro("Left-mouse click to fire",Vt)},Pe),ke.tutorialStage++,Jo()):ke.tutorialStage!=Se.shapes||1!=t&&2!=t||(setTimeout(function(){Ro("Destroy shapes to gather resources",Vt)},Pe),ke.tutorialStage++,Jo());var a=new ArrayBuffer(yt+yt+yt),l=new DataView(a,0);l.setUint8(0,ve.key,!0),l.setUint8(1,t,!0),l.setUint8(2,e,!0),io.send(a)}}function yo(){io&&function(){ke.name=_e.value,Jo();var t=btoa(unescape(encodeURIComponent(_e.value))).substring(0,m).split(""),e=new ArrayBuffer(yt+yt+yt+t.length),i=new DataView(e,0);i.setUint8(0,ve.play,!0),i.setUint8(1,t.length,!0),i.setUint8(2,ke.socialButtons.length,!0);for(var o=yt+yt+yt,n=0;n<t.length;n++)i.setUint8(o+n,t[n].charCodeAt(0),!0);io.send(e),ft[K].name=Go(_e.value),Q=!0}()}function mo(){J=!1,wt=null,!1,Z=0,oi.style.display="none",oi.style.opacity="0"}function go(t){je.style.opacity="0",Xe.style["transition-timing-function"]="ease-in",Xe.style.top="-50%",ii.style.opacity=t?"1":"0",setTimeout(function(){J&&"0"==je.style.opacity&&(je.style.display="none")},1500)}function bo(){je.style.display="block";je.clientHeight;je.style.opacity="1",Xe.style["transition-timing-function"]="ease-out",Xe.style.top="50%",ii.style.opacity="0"}mobile?(pi.ontouchstart=so,fi.ontouchstart=ro,pi.ontouchend=co,fi.ontouchend=ho,pi.ontouchcancel=co,fi.ontouchcancel=ho):(pi.onmousedown=so,fi.onmousedown=ro,pi.onmouseup=co,fi.onmouseup=ho),document.onkeydown=function(t){J&&fo(t.keyCode,1)},document.onkeyup=function(t){J&&fo(t.keyCode,0)},l.lineCap="round",l.lineJoin="round",l.lineWidth=qt*Mt;var vo=Date.now(),wo=1,xo=(Date.now(),function(){var t,n=Date.now()-vo;for(u in zt=(zt+n)/2,(wo=n/Ci)>1&&(wo=1),vo=Date.now(),ht)ht[u].objUpdate(wo),ht[u].update(wo);null!=wt&&(t=Bt*(n/zt),Tt=Vo(Tt,wt.$ox-wt.$x,t),kt=Vo(kt,wt.$oy-wt.$y,t),St=wt.x+Tt*Dt,Pt=wt.y+kt*Dt,$t=Vo($t,Ut,t),Bi(),function(){ee=Vo(ee,te,.1),Math.abs(ri.scrollLeft-ee)>1&&(ri.scrollLeft=ee,ie=!0);ri.scrollLeft<=1?hi.style.opacity=.3:hi.style.opacity=1;ri.scrollLeft>=ri.scrollWidth-ri.clientWidth-1?ui.style.opacity=.3:ui.style.opacity=1}()),g=Vo(g,w,.1),v=Vo(v,x,.1),function(){l.fillStyle="#f2f2f2",l.fillRect(0,0,e,i),l.strokeStyle="#dddddd",l.lineWidth=Kt;for(var t=Lo(Math.ceil((St-e/2/Mt)/Jt)*Jt),o=-1;o<e/(Jt*Mt)+2;o++)l.beginPath(),l.moveTo(t+o*Jt*Mt,0),l.lineTo(t+o*Jt*Mt,i),l.stroke(),l.closePath();for(var n=zo(Math.ceil((Pt-i/2/Mt)/Jt)*Jt),o=-1;o<i/(Jt*Mt)+2;o++)l.beginPath(),l.moveTo(0,n+o*Jt*Mt),l.lineTo(e,n+o*Jt*Mt),l.stroke(),l.closePath();l.lineWidth=qt*Mt,l.fillStyle="#000000",l.globalAlpha=.2,l.fillRect(Lo(-g/2)-e,0,e,i),l.fillRect(Lo(g/2),0,e,i),l.fillRect(Lo(-g/2),zo(-v/2)-i,g*Mt,i),l.fillRect(Lo(-g/2),zo(v/2),g*Mt,i),l.globalAlpha=1}(),ge=Vo(ge,ye,.1);for(var c=0;c<ne;c++)pe[c]=Vo(pe[c],he[c],.1);for(p in Mo(),y||Ao(),ft)ft[p].update();for(f in ut)ut[f].objUpdate(wo),ut[f].update(wo),null!=ut[f]&&Uo(ut[f])&&ut[f].render();for(u in ht)ht[u].renderBottom();for(b in pt)pt[b].objUpdate(wo),pt[b].update(),null==pt[b]||pt[b].firstFrame||pt[b].render();for(p in Rt?function(){for(var t=nt,e=at,i=0,o=-1,n=0,a=0;a<dt.length;a++)if(dt[a].buildable){var s=jo(nt,at,Lo(dt[a].x),zo(dt[a].y));(o<0||s<o)&&(o=s,n=a)}Nt=dt[n].id,i=Oo(nt,at,Lo(dt[n].x),zo(dt[n].y))+Math.PI,Ot=i;var r=Oe[dt[n].type].size*Mt*vt;Oe[Ht].shape==Te.circle?r+=Oe[Ht].size*Mt*vt:Oe[Ht].shape==Te.triangle&&(r+=Oe[Ht].size/2*Mt*vt);var c=Yo(Lo(dt[n].x),zo(dt[n].y),i,r);t=c.x,e=c.y,Yt=!1;for(var h=Et,a=0;a<dt.length;a++)if(a!=n&&jo(t,e,Lo(dt[a].x),zo(dt[a].y))<(Oe[Ht].size*vt+dt[a].size)*Mt){Yt=!0,h=ne;break}l.globalAlpha=.8,Oe[Ht].bottom(l,t,e,Oe[Ht].size*Mt*vt,i-Math.PI/2,i-Math.PI/2+Math.PI,h),Oe[Ht].top(l,t,e,Oe[Ht].size*Mt*vt,i-Math.PI/2,i-Math.PI/2+Math.PI,h),l.globalAlpha=1}():ko(nt,at)?a.style.cursor="pointer":a.style.cursor="crosshair",ht)ht[p].renderTop();for(u in ht)ht[u].type==xe.core&&ht[u].renderName();for(f in ut)ut[f].renderHealthBar();for(p in ht)ht[p].renderHealthBar();if(null!=wt&&(l.save(),l.translate(Lo(wt.x),zo(wt.y)),l.rotate(xt),l.beginPath(),l.setLineDash([10*Mt,10*Mt]),l.strokeStyle="#000000",l.globalAlpha=.2,l.lineWidth=3*Mt,l.arc(0,0,(wt.size+25)*Mt,0,2*Math.PI),l.stroke(),l.closePath(),l.restore(),l.lineWidth=qt*Mt,l.setLineDash([]),l.globalAlpha=1,xt+=.01,Ui.clearRect(0,0,q,q),Ui.fillStyle="#FFFFFF",Ui.beginPath(),Ui.arc(wt.x/g*(q-2*G)+q/2+G/4,wt.y/v*(q-2*G)+q/2+G/4,G,0,2*Math.PI),Ui.closePath(),Ui.fill()),mobile&&(k?(B+=.1)>1&&(B=1):(B-=.1)<0&&(B=0),D?(_+=.1)>1&&(_=1):(_-=.1)<0&&(_=0),B>0&&(l.globalAlpha=.25*B,l.fillStyle="#000",l.beginPath(),l.arc(S,P,z,0,2*Math.PI),l.fill(),l.closePath(),l.beginPath(),l.arc($.x,$.y,z/2,0,2*Math.PI),l.fill(),l.closePath(),l.globalAlpha=1),_>0)){N=Xo(Y,N,H,1/V),O=Xo(j,O,E,1/V),nt=e/2+N,at=i/2+O,l.lineCap="butt",l.globalAlpha=.5*_,l.strokeStyle="#000";var m=e/2+N,T=i/2+O;l.beginPath(),l.moveTo(m,T-X),l.lineTo(m,T+X),l.moveTo(m-X,T),l.lineTo(m+X,T),l.stroke(),l.closePath(),l.globalAlpha=1,l.lineCap="round"}if(s){l.fillStyle=De,l.strokeStyle=Ce,l.lineWidth=2,l.textAlign="left",l.font="900 20px Ubuntu";m=5,T=20;var M="Data total: "+Eo(r);l.strokeText(M,m,T),l.fillText(M,m,T),T+=20;var U="Data per second: "+Eo(h);l.strokeText(U,m,T),l.fillText(U,m,T),T+=20;var A="Local FPS: "+d;l.strokeText(A,m,T),l.fillText(A,m,T),T+=20;var I="Server FPS: "+Math.round(1e3/Ci);l.strokeText(I,m,T),l.fillText(I,m,T),l.lineWidth=qt*Mt,l.fillStyle="#f00",l.beginPath(),l.arc(Lo(0),zo(0),10,0,2*Math.PI),l.fill(),l.closePath()}o&&To(xo)}),To=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame;function ko(t,e){for(var i=null,o=0;o<dt.length;o++)if(jo(t,e,Lo(dt[o].x),zo(dt[o].y))<dt[o].size*Mt){i=dt[o];break}return i}!function(){!function(){var t=re+ce;ki.width=t,ki.height=t,Si.lineWidth=ce,Si.lineCap="round",Si.lineJoin="round";for(var e=0;e<ne;e++){Si.clearRect(0,0,t,t),Si.fillStyle=Ue[e],Si.strokeStyle=_o(Ue[e],Gt),Si.beginPath(),Si.moveTo(re/2+ce/2,ce),Si.lineTo(re,re),Si.lineTo(ce,re),Si.lineTo(re/2+ce/2,ce),Si.closePath(),Si.fill(),Si.stroke();var i=ki.toDataURL("image/png",1);le[e]=i}}();for(var t="",e="",i=0;i<ne;i++){var o='<div id="so'+i+'" class="stash-item"><img src="'+le[i]+'" width="'+se+'px" style="position:relative;top:1.5px;"> <span id="si'+i+'">0</span>';mobile||(o+=' <span class="minor">'+ae[i]+"</span>"),o+="</div>",i==ne-1?e+=o:t+=o}di.innerHTML=t,yi.innerHTML=e,mi.innerHTML='<div id="score-outer" class="stash-item"><span class="minor">Score</span> <span id="score-inner">0</span></div>'}(),xo(),Ve.onclick=yo,mouseInterval=setInterval(function(){J&&null!=wt&&(function(){if(lt=Math.round((nt-Lo(wt.x))/Mt),st=Math.round((at-zo(wt.y))/Mt),null!=wt&&rt!=lt&&ct!=st){var t=new ArrayBuffer(yt+gt+gt),e=new DataView(t,0);e.setUint8(0,ve.mouse,!0),e.setInt32(yt,lt,!0),e.setInt32(yt+gt,st,!0),io.send(t),rt=lt,ct=st}}(),mobile&&function(){if(F!=A||W!=L){var t=new ArrayBuffer(yt+bt+bt),e=new DataView(t,0);e.setUint8(0,ve.move,!0),e.setFloat32(yt,A,!0),e.setFloat32(yt+bt,L,!0),io.send(t),F=A,W=L}}())},30),s&&(debugInterval=setInterval(function(){h=c,c=0,d=Math.round(1e3/zt)},1e3)),ai.onclick=function(){var t=1;mobile&&(t=mobileScale),-1==si.style.transform.indexOf("150%")?(si.style.transform="translateX(-50%) translateY(150%) scale("+t+")",li.style.top="12.5%",li.style.transform="scaleY(-1)"):(si.style.transform="translateX(-50%) translateY(0%) scale("+t+")",li.style.top="37.5%",li.style.transform="scaleY(1)")};var So=function(t){var e=this.id.split(":")[1].split(";");return Ht=Number(e[0]),Et=Number(e[1]),$o(Oe[Ht].cost,Et)<=he[Et]?(Rt=!0,mobile&&(k=!1,D=!1)):Ro("Gather "+($o(Oe[Ht].cost,Et)-he[Et])+" more "+ae[Et]+" first",Vt),!1};function Po(t){var e=this.id.split(":")[1].split(";"),i=Number(e[0]),o=Number(e[1]);Gi=!0;var n=Oe[i].name+'<br><span class="minor">'+Oe[i].description+"<br>",a=$o(Oe[i].cost,o)-he[o];n+=a>0?"Gather</span> "+a+" "+ae[o]:"You have enough</span> "+ae[o],oi.innerHTML=n,oi.style.display="block";oi.clientHeight;oi.style.opacity="1"}function Mo(){for(var t=!1,e=0;e<ne;e++){var i=qo("so"+e);Ho(pe[e])!=Ho(fe[e])&&(qo("si"+e).innerText=Ho(pe[e])),Ho(he[e])!=Ho(ue[e])&&(i.style.animationName="pulse",setTimeout(function(t){t.style.animationName=""}.bind(null,i),1e3),t=!0),ue[e]=he[e],fe[e]=pe[e],0==he[e]?yi.style.opacity=0:yi.style.opacity=1}t&&Fo();i=qo("score-outer");Ho(ge)!=Ho(be)&&(qo("score-inner").innerText=Ho(ge)),Ho(ye)!=Ho(me)&&(i.style.animationName="pulse",setTimeout(function(t){t.style.animationName=""}.bind(null,i),1e3)),me=ye,be=ge}function Uo(t){var o=Lo(t.x),n=zo(t.y),a=t.size*Mt;return o>0-a-At&&o<e+a+At&&n>0-a-At&&n<i+a+At}function $o(t,e){return t*(e+1)}function Ao(){for(var t=0;t<dt.length;t++)dt[t].mouse&&(dt[t].angle=Oo(Lo(dt[t].x),zo(dt[t].y),nt,at)-Math.PI/2)}var Io=null;function Fo(){if(null!=jt){if(bi.innerHTML=Oe[jt.type].name+' <span class="minor">('+ae[jt.material]+")</span>",jt.material<ne-1){var t=Bo(jt);wi.innerHTML='<img style="height:22px;position:relative;top:4px;" src="'+le[jt.material+1]+'"> Upgrade <span class="minor">-'+t+" "+ae[jt.material+1]+"</span>",t>he[jt.material+1]||jt.material==ne-2&&jt.type==xe.alchemyLab?wi.disabled=!0:wi.disabled=!1}else wi.innerHTML="Fully upgraded",wi.disabled=!0;jt.type!=xe.core?(xi.style.display="inline-block",wi.style.width="calc(50% - 4px)",xi.innerHTML='<img style="height:22px;position:relative;top:4px;" src="'+le[jt.material]+'"> Destroy <span class="minor">+'+jt.deleteAmount+" "+ae[jt.material]+"</span>"):(xi.style.display="none",wi.style.width="100%"),wi.disabled?wi.style.bottom="1px":wi.style.bottom="0px",clearTimeout(Io),Io=null,gi.style.display="block";gi.clientHeight;gi.style.opacity="1",qo("")}else Wo()}function Wo(){jt=null,gi.style.opacity="0",Io=setTimeout(function(){gi.style.display="none"},500)}function Lo(t){return(t-St)*Mt+e/2}function zo(t){return(t-Pt)*Mt+i/2}function Bo(t){return Math.floor($o(Oe[t.type].cost,t.material+1)-$o(Oe[t.type].cost,t.material)/4)}function Do(){Pi.innerHTML=dt.length-1+'<span class="minor">/'+Ri+" units</span>"}wi.onclick=function(){if(Bo(jt)<=he[jt.material+1]){var t=new ArrayBuffer(yt+mt),e=new DataView(t,0);e.setUint8(0,ve.upgrade,!0),e.setUint16(yt,jt.id,!0),io.send(t)}else jt.material<ne-1?Ro("Gather "+(Bo(jt)-he[jt.material+1])+" more "+ae[jt.material+1]+" first",Vt):Ro("This unit has been upgraded to the limit",Vt);Wo()},xi.onclick=function(){if(jt.type!=xe.core){var t=new ArrayBuffer(yt+mt),e=new DataView(t,0);e.setUint8(0,ve.delete,!0),e.setUint16(yt,jt.id,!0),io.send(t)}Wo()},vi.onclick=function(){Wo()};var Co=0;function Ro(t,e){ni.innerHTML+='<div class="alert" id="m'+Co+'" style="opacity:0;margin-bottom:-24px;width:100%;"></div>';var i="m"+Co,o=document.getElementById(i);o.clientHeight;o.innerText=t,o.style.opacity=1,o.style.marginBottom="0px",Co++,setTimeout(function(){document.getElementById(i).style.opacity=0,setTimeout(function(){document.getElementById(i).remove()}.bind(null,i),500)}.bind(null,i),e)}function Ho(t){return(t=Math.round(t))>=1e3&&(t=(t/=1e3).toFixed(1),t+="k"),t}function Eo(t){return t>=1e3&&t<1e6?(t/=1e3,t=Math.round(t),t+="KB"):t>=1e6&&t<1e9?(t/=1e6,t=Math.round(t),t+="MB"):t>=1e9&&(t/=1e9,t=Math.round(t),t+="GB"),t}function No(t){t=Math.round(t/1e3);var e,i=Math.floor(t/3600),o=Math.floor((t-3600*i)/60),n=t-3600*i-60*o,a=[];return i>0&&(e=" hour",1!=i&&(e+="s"),a.push(i+e)),o>0&&(e=" minute",1!=o&&(e+="s"),a.push(o+e)),e=" second",1!=n&&(e+="s"),a.push(n+e),1==a.length?a[0]:2==a.length?a[0]+" and "+a[1]:3==a.length?a[0]+", "+a[1]+" and "+a[2]:void 0}function Oo(t,e,i,o){return Math.atan2(o-e,i-t)}function Yo(t,e,i,o){return{x:Math.cos(i)*o+t,y:Math.sin(i)*o+e}}function jo(t,e,i,o){return Math.sqrt((t-i)*(t-i)+(e-o)*(e-o))}function Xo(t,e,i,o){var n=(Math.abs(i-t)>=Math.abs(i-e)?i-t:i-e)*o;return e==i||e<i&&e+n>i||e>i&&e+n<i?i:e+n}function Vo(t,e,i){return t*(1-i)+e*i}function _o(t,e){var i=parseInt(t.slice(1),16),o=e<0?0:255,n=e<0?-1*e:e,a=i>>16,l=i>>8&255,s=255&i;return"#"+(16777216+65536*(Math.round((o-a)*n)+a)+256*(Math.round((o-l)*n)+l)+(Math.round((o-s)*n)+s)).toString(16).slice(1)}function qo(t){return document.getElementById(t)}function Go(t){return profanityFilter.clean(t)}function Jo(){localStorage.data=JSON.stringify(ke)}localStorage.data?ke=JSON.parse(localStorage.data):Jo(),_e.value=ke.name,mobile||_e.focus();var Ko=function(){var t=btoa(unescape(encodeURIComponent(_e.value))).substr(0,m);try{_e.value=decodeURIComponent(escape(atob(t)))}catch(t){console.log("Error: "+t),_e.value=_e.value.substr(0,m)}};if(_e.oninput=Ko,_e.onpaste=Ko,_e.onkeydown=function(t){"Enter"==t.key&&yo()},Ge){function Qo(t,e,i){var o=ke.socialButtons.indexOf(t);e?-1==o&&ke.socialButtons.push(t):-1!=o&&ke.socialButtons.splice(o,1),ke.socialTotal=ke.socialButtons.length*Ee,Jo(),0!=i&&Zo()}function Zo(){ke.socialTotal>0&&ke.socialTotal<He*Ee?Ai.innerHTML="Increase your bonus by clicking other social media buttons":ke.socialTotal>=He*Ee?Ai.innerHTML="Thanks for your support!":ke.socialTotal<=0&&(Ai.innerHTML="Start with extra resources by supporting us on social media"),ke.socialTotal>0&&(Fi.style.display="block",Wi.style.width=ke.socialTotal/(He*Ee)*100+"%",Wi.innerText="+"+ke.socialTotal),Ai.onclick=null}function tn(t){setTimeout(function(){Ai.innerHTML='<a href="#">Click to redeem</a>',Ai.onclick=function(){Ai.onclick=null,Qo(t,!0,!0)}.bind(null,t)},3e3)}function en(){FB.Event.subscribe("edge.create",function(){Qo("facebook-like",!0,!0)}),FB.Event.subscribe("edge.remove",function(){Qo("facebook-like",!1,!0)}),twttr.events.bind("tweet",function(){tn("twitter-tweet")}),twttr.events.bind("follow",function(){tn("twitter-follow")})}"undefined"==typeof FB||"undefined"==typeof twttr?window.addEventListener("load",function(){en()}):en(),Ii.onclick=function(){Qo("discord-join",!0,!0)};var on=!1,nn=qo("___ytsubscribe_0");nn.onmouseenter=function(){on=!0},nn.onmouseleave=function(){on=!1};var an=!1,ln=document.getElementsByClassName("fb-share-button")[0];ln.onmouseenter=function(){an=!0},ln.onmouseleave=function(){an=!1},Zo()}window.onbeforeunload=function(){if(Ge&&on&&Qo("youtube-subscribe",!0,!1),Q)return"Are you sure that you want to exit? You will lose your current progress in the game"},window.onblur=function(){Ge&&an&&tn("facebook-share");for(var t=0;t<tt.length;t++)fo(tt[t],0)},document.onmouseout=function(){fo(1,0)},sn=t,console.log("Setting up the network for "+sn),window.WebSocket=window.WebSocket||window.MozWebSocket,io=new WebSocket(sn),io.binaryType="arraybuffer",io.onopen=function(){console.log("Connected!"),n=!0;var t=new ArrayBuffer(yt);new DataView(t,0).setUint8(0,ve.ready,!0),io.send(t)},io.onclose=_i,io.onerror=_i,io.onmessage=function(t){try{var e=t.data,i=new DataView(t.data),o=i.getUint8(0,!0),n=yt;switch(r+=e.byteLength,c+=e.byteLength,o){case we.update:null!=Vi&&(Ci=Vo(Ci,Date.now()-Vi,.1)),Vi=Date.now();var s=[],h=[],u=[],p=i.getUint16(n,!0);n+=mt;var f=i.getUint16(n,!0);n+=mt;var d=i.getUint16(n,!0);n+=mt;var m=i.getUint16(n,!0);n+=mt;for(var b=0;b<p;b++){var k=i.getUint16(n,!0);n+=mt;var S=i.getFloat32(n,!0);n+=bt;var P=i.getFloat32(n,!0);n+=bt;var M=i.getFloat32(n,!0);n+=bt;var U=i.getFloat32(n,!0);n+=bt;var $=i.getUint8(n,!0);n+=yt;var A=i.getUint8(n,!0);n+=yt;var I=i.getUint16(n,!0);n+=mt,(W=i.getFloat32(n,!0))<0&&(W=0),n+=bt;var F=i.getFloat32(n,!0);n+=bt,s.push(k),Object.keys(ht).indexOf(String(k))>-1?(ht[k].$ox=ht[k].$x,ht[k].$oy=ht[k].$y,ht[k].$x=S*vt,ht[k].$y=P*vt,!y&&ht[k].owner==K&&ht[k].mouse||(ht[k].$angle=U),ht[k].$orotation=ht[k].$rotation,ht[k].$rotation=F,ht[k].material!=A&&(ht[k].deleteAmount=Math.floor($o(Oe[ht[k].type].cost,A)/2)),ht[k].material=A,ht[k].$hp=W,ht[k].owner==K&&ht[k].type==xe.core&&(wt=ht[k]),ht[k].dying=!1,ht[k].alpha=1,ht[k].scale=1):(ht[k]=new Yi(k,S*vt,P*vt,M*vt,A,$,I,U,F,W),ht[k].owner==K&&(dt.push(ht[k]),ke.tutorialStage==Se.gotUnit&&ht[k].type!=xe.core&&(Me=!0,Ro("Awesome! You can now gather more resources to build your tank",Vt),setTimeout(function(){var t="click";mobile&&(t="tap"),Ro("Also, you can "+t+" one of your units to upgrade or destroy it",Vt),setTimeout(function(){Ro("Protect your core: if it gets destroyed, your whole tank will get demolished",Vt),setTimeout(function(){Ro("Good luck!",Vt)},Pe)},Vt+Pe)},Pe),ke.tutorialStage++,Jo())),Do())}for(b=0;b<f;b++){var W;k=i.getUint16(n,!0),n+=mt,h.push(k),S=i.getFloat32(n,!0),n+=bt,-1!=S?(P=i.getFloat32(n,!0),n+=bt,M=i.getFloat32(n,!0),n+=bt,F=i.getFloat32(n,!0),n+=bt,A=i.getUint8(n,!0),n+=yt,(W=i.getFloat32(n,!0))<0&&(W=0),n+=bt,Object.keys(ut).indexOf(String(k))>-1?(ut[k].$ox=ut[k].$x,ut[k].$oy=ut[k].$y,ut[k].$x=S*vt,ut[k].$y=P*vt,ut[k].$orotation=ut[k].$rotation,ut[k].$rotation=F,ut[k].$hp=W,ut[k].dying=!1,ut[k].alpha=1,ut[k].scale=1):ut[k]=new ji(k,S*vt,P*vt,M*vt,A,F,W),ut[k].active=!0):Uo(ut[k])?ut[k].dying=!0:delete ut[k]}for(b=0;b<d;b++)k=i.getUint16(n,!0),n+=mt,S=i.getFloat32(n,!0),n+=bt,P=i.getFloat32(n,!0),n+=bt,M=i.getFloat32(n,!0),n+=bt,A=i.getUint8(n,!0),n+=yt,u.push(k),Object.keys(pt).indexOf(String(k))>-1?(pt[k].$ox=pt[k].$x,pt[k].$oy=pt[k].$y,pt[k].$x=S*vt,pt[k].$y=P*vt,pt[k].dying=!1,pt[k].firstFrame=!1,pt[k].alpha=1,pt[k].scale=1):pt[k]=new Xi(k,S*vt,P*vt,M*vt,A);for(b=0;b<m;b++){k=i.getUint16(n,!0),n+=mt;var L=i.getUint32(n,!0);n+=gt;var z=i.getUint8(n,!0);n+=yt;for(var B=[],D=0;D<z;D++)B.push(i.getInt8(n,!0)),n+=yt;var C=Ct;try{var R=String.fromCharCode.apply(null,B);C=decodeURIComponent(escape(atob(R)))}catch(t){}Object.keys(ft).indexOf(String(k))<0?ft[k]=new Ni(C,L):ft[k].$score=L}for(k in ht)if(s.indexOf(Number(k))<0)if(ht[k].owner==K&&Do(),Uo(ht[k]))ht[k].dying=!0;else{var H=dt.indexOf(ht[k]);H>-1&&dt.splice(H,1),delete ht[k]}for(k in ut)h.indexOf(Number(k))<0&&(ut[k].active=!1);for(k in pt)u.indexOf(Number(k))<0&&(Uo(pt[k])?pt[k].dying=!0:delete pt[k]);break;case we.joined:setTimeout(function(){J=!0,Re=Date.now(),Mo(),Vi=null,$t=.5,ke.first=!1,Jo(),a.style.opacity=1,go(!0),ke.tutorialStage==Se.wasd&&(setTimeout(function(){mobile?Ro("Touch the left side of the screen, and move to control your tank",Vt):Ro("WASD or arrow keys to move",Vt)},Pe),ke.tutorialStage++,Jo())},Di);break;case we.info:for(vt=i.getFloat32(n+bt+bt,!0),qt=_t*vt,l.lineWidth=qt*Mt,w=i.getFloat32(n,!0)*vt,n+=bt,x=i.getFloat32(n,!0)*vt,St=(g=w)/2,Pt=(v=x)/2,n+=bt+bt,K=i.getUint16(n,!0),n+=mt,Di=i.getFloat32(n,!0),Ci=Di,n+=bt,Ri=i.getUint32(n,!0),n+=gt,Hi=i.getFloat32(n,!0),n+=bt,Ei=i.getUint8(n,!0),n+=yt,b=0;b<Oe.length;b++)Oe[b].cost=i.getInt32(n,!0),n+=gt;!function(){Ne=[];for(var t=0;t<Oe.length;t++)Ne[t]=t;Ne.sort(function(t,e){return Oe[t].cost-Oe[e].cost})}(),ft[K]=new Ni(_e.value,0),function(){ki.width=Zt+oe,ki.height=Zt+oe,Si.lineWidth=qt*(Zt/(Oe[xe.basicUnit].size*vt*2)),Si.lineCap="round",Si.lineJoin="round",ri.innerHTML="";var t=Mt;Mt=1;for(var e=0;e<ne-1;e++)for(var i=0;i<Ne.length;i++)if(Ne[i]!=xe.core){var o="u:"+Ne[i]+";"+e;Si.clearRect(0,0,ki.width,ki.height),Oe[Ne[i]].bottom(Si,ki.width/2,ki.height/2,Zt/2,.75*Math.PI,0,e),Oe[Ne[i]].top(Si,ki.width/2,ki.height/2,Zt/2,.75*Math.PI,0,e);var n=ki.toDataURL("image/png",1);ri.innerHTML+='<div id="'+o+'" class="item"><div class="item-inner"><img src="'+n+'" class="store-image" draggable="false" width="'+(Qt+oe)+'px"><br>'+Oe[Ne[i]].name+'<br><img style="height:18px;position:relative;top:2px;" src="'+le[e]+'"> '+$o(Oe[Ne[i]].cost,e)+' <span class="minor">'+ae[e]+"</span></div></div>"}Mt=t;for(var a=document.getElementsByClassName("item"),e=0;e<a.length;e++)a[e].onclick=So,mobile||(a[e].onmouseenter=Po),a[e].children[0].children[0].draggable=!1,a[e].ondragstart=So}(),console.log("Showing menu"),Ye.style.opacity="0",setTimeout(function(){Ye.style.visibility="hidden"},1500),bo(),Vi=null;break;case we.stash:var E=i.getUint8(n);for(E&&(E=!Me,Me=!1),n+=yt,b=0;b<ne;b++){var N=he[b];if(he[b]=i.getInt32(n+gt*b,!0),he[b]!=N){if(E){var O=he[b]-N;Ro(O<0?Ho(O)+" "+ae[b]:"+"+Ho(O)+" "+ae[b],Xt)}ke.tutorialStage==Se.saveUp&&(Ro("Well done! Next, save up some Wood",Vt),setTimeout(function(){Ro("Soon, you'll be able to start building units",Vt),Me=!0},Pe),ke.tutorialStage++,Jo())}}ye=i.getInt32(n+gt*b,!0),function(){for(var t=0;t<ne;t++)for(var e=1;e<Oe.length;e++){var i=qo("u:"+e+";"+t).getElementsByClassName("item-inner")[0].getElementsByClassName("store-image")[0];$o(Oe[e].cost,t)<=he[t]?(i.style.opacity=1,ke.tutorialStage==Se.firstUnit&&(Ro("Nice! You can now build your first unit",Vt),setTimeout(function(){mobile?Ro("Tap on the icon in the store, and use your target to place it",Vt):Ro("Click on the icon in the store, and click again where you want to place it",Vt)},Pe),ke.tutorialStage++,Jo())):i.style.opacity=.4}}();break;case we.scale:Ut=i.getFloat32(n,!0);case we.leaderboard:var Y="<table>",j=i.getInt32(n,!0);n+=gt;var X=mt+gt+yt;for(mobile&&j>T&&(j=T),b=0;b<j;b++){for(k=i.getUint16(n,!0),L=i.getInt32(n+mt,!0),z=i.getUint8(n+mt+gt,!0),B=[],D=0;D<z;D++)B.push(i.getInt8(n+mt+gt+yt+D,!0));C=Ct;try{R=String.fromCharCode.apply(null,B),C=decodeURIComponent(escape(atob(R)))}catch(t){}""==C&&(C=Ct),n+=X+z,Y+="<tr",k==K&&(Y+=' class="me"'),Y+='><td class="left"><div class="truncate">'+(b+1)+". "+Go(C)+'</div></td><td class="right">'+Ho(L)+"</td></tr>"}Y+="</table>",Ti.innerHTML=Y,Ti.style.opacity="1";break;case we.die:for(z=i.getUint8(n,!0),n+=yt,B=[],D=0;D<z;D++)B.push(i.getInt8(n+D,!0));C=Ct;try{R=String.fromCharCode.apply(null,B),C=decodeURIComponent(escape(atob(R)))}catch(t){}""==C&&(C=Ct);var V="players";1==Z&&(V="player"),Li.style.display="block",Li.innerHTML="<h3>Destroyed by "+C+'</h3><span class="minor">You achieved a </span>score of '+Ho(ye)+'<span class="minor"> and </span>destroyed '+Z+" "+V+' <span class="minor">in </span>'+No(Date.now()-Re)+'<span class="minor">.</span>',mobile||(Li.innerHTML+=' <a class="twitter-share-button" href="https://twitter.com/intent/tweet?original_referer=http%3A%2F%2Ftanksmith.io%2F&ref_src=twsrc%5Etfw&text=I%20played%20Tanksmith.io:%20achieved%20a%20score%20of%20'+Ho(ye)+"%20and%20destroyed%20"+Z+"%20"+V+"%20in%20"+No(Date.now()-Re)+'%20%23tanksmithio%20%23ioninja%20%23iogames%20via%20%40ioninja14">Tweet</a> this.');var _=[];for(b=0;b<he.length;b++)if(he[b]>0){var q=0,G=Math.floor(ke.socialButtons.length*Ee/Math.pow(2,b));(q=he[b]<=G?G:Math.floor((he[b]-G)/2)+G)>0&&_.push(Ho(q)+'&nbsp;<span class="minor">'+ae[b]+"</span>")}if(0==_.length)qe.style.display="none";else{qe.style.display="block";var Q='<span class="minor">Respawn with</span> ';if(1==_.length)Q+=_[0];else if(2==_.length)Q+=_.join(' <span class="minor">and</span> ');else{var tt=_.splice(_.length-1,1);Q+=_.join('<span class="minor">, </span>'),Q+=' <span class="minor">and</span> '+tt}qe.innerHTML=Q}mo(),bo();break;case we.shake:break;case we.kill:for(z=i.getUint8(n,!0),n+=yt,B=[],D=0;D<z;D++)B.push(i.getInt8(n+D,!0));C=Ct;try{R=String.fromCharCode.apply(null,B),C=decodeURIComponent(escape(atob(R)))}catch(t){}""==C&&(C=Ct),Z++,Ro("You destroyed "+C,Xt);break;case we.resize:w=i.getFloat32(n,!0)*vt,x=i.getFloat32(n+bt,!0)*vt}}catch(t){}}}catch(t){console.log(t),setTimeout(function(){onDisconnect()},1e3)}var sn};ready();